
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>SNW_MP_PARAM Organizes and Sets Various Model Input Scalar and Array Parameters</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-06-27"><meta name="DC.source" content="snw_mp_param.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>SNW_MP_PARAM Organizes and Sets Various Model Input Scalar and Array Parameters</h1><!--introduction--><pre>  SNW_MP_PARAM sets several main default parameter structures. There are
  four types of parameters: scalar (pref, tech, prices), state space
  arrays, Transition Matrixes (Exogenous), Permanent Type (Life-cycle
  Arrays)</pre><pre>  ST_PARAM_GROUP options:</pre><pre>  * "default_base": Main
  * "default_small": Quick Testing
  * "default_tiny": Quicker Testing</pre><pre>  Pref, Technology, and prices SCALARS:</pre><pre>  * BETA discount
  * THETA total factor productivity normalizer
  * R interest rate</pre><pre>  Vectorized State Space ARRAYS:</pre><pre>  * AGRID asset grid
  * ETA_GRID productivity shock grid</pre><pre>  Transition Matrixes ARRAYS:</pre><pre>  * PI_ETA shock productivity transition
  * PI_KIDS shock kids count transition
  * PSI shock survival probability</pre><pre>  Permanent Education Type Heterogeneity ARRAYS:</pre><pre>  * EPSILON perfect-foresight education type transition
  * SS Social Security</pre><pre>  MP_PARAMS = SNW_MP_PARAM() get default parameters all in the same
  container map</pre><pre>  MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters
  for the type ST_PARAM_GROUP. ST_PARAM_GROUP groups include:
  "default_base", "default_small", etc.</pre><pre>  MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS) generates
  default parameters for the type ST_PARAM_GROUP, display parameter map
  details if BL_PRINT_MP_PARAMS is true.</pre><pre>  MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS,
  IT_ROW_N_KEEP, IT_COL_N_KEEP) Control for output matrixes how many
  rows and columns to print out.</pre><pre>  [MP_PARAMS, MP_PARAMS_PREFTECHPRICEGOV, MP_PARAMS_STATESGRID,
  MP_PARAMS_EXOTRANS, MP_PARAMS_TYPELIFE, MP_PARAMS_INTLEN] =
  SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters for the type
  ST_PARAM_GROUP, and output all parameters in one MP_PARAMS, but also
  parameters oraganized in submaps by parameter types</pre><pre>  See also SNWX_MP_PARAM</pre><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Parse Main Inputs and Set Defaults</a></li><li><a href="#3">Parametesr Grid Points</a></li><li><a href="#4">Preferences, Technologies, etc.</a></li><li><a href="#5">PARAM Mortality</a></li><li><a href="#6">PARAM Productivity by Education Types</a></li><li><a href="#7">PARAM Kids Transition</a></li><li><a href="#8">PARAM Specifying asset grid (use non-linear spacing with minimum value of 0)</a></li><li><a href="#9">PARAM Derive transition probabilities and stationary distribution for productivity shock</a></li><li><a href="#10">Initial conditions for marital status, college attainment, and number of kids</a></li><li><a href="#11">Population distribution</a></li><li><a href="#12">Set Parameter Maps</a></li><li><a href="#13">Combine Maps</a></li><li><a href="#14">Print</a></li><li><a href="#15">Return</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> varargout = snw_mp_param(varargin)
</pre><h2 id="2">Parse Main Inputs and Set Defaults</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(varargin))

    [it_row_n_keep, it_col_n_keep] = deal(8, 8);

    <span class="keyword">if</span> (length(varargin)==1)
        st_param_group = varargin{:};
        bl_print_mp_params = false;
    <span class="keyword">elseif</span> (length(varargin)==2)
        [st_param_group, bl_print_mp_params] = varargin{:};
    <span class="keyword">elseif</span> (length(varargin)==4)
        [st_param_group, bl_print_mp_params, it_row_n_keep, it_col_n_keep] = varargin{:};
    <span class="keyword">end</span>

<span class="keyword">else</span>

<span class="comment">%     st_param_group = 'default_base';</span>
    st_param_group = <span class="string">'default_dense'</span>;
<span class="comment">%     st_param_group = 'default_tiny';</span>
    bl_print_mp_params = true;
    [it_row_n_keep, it_col_n_keep] = deal(8, 8);

<span class="keyword">end</span>
</pre><h2 id="3">Parametesr Grid Points</h2><p>Number of grid points</p><pre class="codeinput">n_educgrid=2; <span class="comment">% No. of grid points for educational attainment (college vs. non-college)</span>
n_marriedgrid=2; <span class="comment">% No. of grid points for marital status</span>
n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 5+ children)</span>
<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_dense"</span>))
    n_jgrid  =83; <span class="comment">% Age runs from 18 to 100 (a period is 2 years)</span>
    jret     =49;
    n_agrid  =55; <span class="comment">% No. of grid points for assets</span>
    n_etagrid =9; <span class="comment">% No. of grid points for persistent labor productivity shocks</span>
    n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 4+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_base"</span>))
    n_jgrid  =42; <span class="comment">% Age runs from 18 to 100 (a period is 2 years)</span>
    jret=25;
    n_agrid  =40; <span class="comment">% No. of grid points for assets</span>
    n_etagrid =7; <span class="comment">% No. of grid points for persistent labor productivity shocks</span>
    n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 4+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_tiny"</span>))
    n_jgrid   =7; <span class="comment">% Age runs from 18 to 100 (5 periods of 16 years + terminal)</span>
    jret =5;
    n_agrid   =10; <span class="comment">% No. of grid points for assets</span>
    n_etagrid =5; <span class="comment">% No. of grid points for persistent labor productivity shocks</span>
    n_kidsgrid=3; <span class="comment">% No. of grid points for children (0 to 5+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_small"</span>))
    n_jgrid   =18; <span class="comment">% Age runs from 18 to 100 (16 periods of 5 years + terminal)</span>
    jret =13;
    n_agrid   =20; <span class="comment">% No. of grid points for assets</span>
    n_etagrid =5; <span class="comment">% No. of grid points for persistent labor productivity shocks</span>
    n_kidsgrid=3; <span class="comment">% No. of grid points for children (0 to 5+ children)</span>
<span class="keyword">end</span>

<span class="comment">% Years Per Period</span>
<span class="keyword">if</span> (n_jgrid == 83)
    it_yrs_per_period = 1;
<span class="keyword">else</span>
    it_yrs_per_period = (80/(n_jgrid-2));
<span class="keyword">end</span>
</pre><h2 id="4">Preferences, Technologies, etc.</h2><p>Non-calibrated parameters</p><pre class="codeinput">gamma=2; <span class="comment">% Risk aversion parameter</span>
<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_dense"</span>))
    rho_eta=0.98; <span class="comment">% Persistence of AR(1) productivity shocks</span>
    sigma_eta=0.018; <span class="comment">% Variance of AR(1) productivity shocks</span>
    g_n=0.01; <span class="comment">% Annual population growth of 1.1 percent</span>
    r=0.04; <span class="comment">% Annual real interest rate of 4.0 percent from McGrattan and Prescott</span>
    beta=0.972; <span class="comment">% Discount factor</span>
<span class="keyword">else</span>
    rho_eta=0.98^it_yrs_per_period;
    sigma_eta=sqrt(0.018^2*sum((0.98.^(0:(it_yrs_per_period-1))).^2));
    g_n=(1.01^it_yrs_per_period)-1;
    r=(1.04^it_yrs_per_period)-1;
    beta=0.972^it_yrs_per_period; <span class="comment">% Discount factor</span>
<span class="keyword">end</span>

<span class="comment">% Government budget constraint parameters</span>
g_cons=0.17575574; <span class="comment">% Government consumption expenditures to GDP (BEA: Average 2015-2019)</span>
a2=1.9007; <span class="comment">% Initial guess for average income tax burden (if we use GS)</span>

<span class="comment">% Calibrated parameters</span>
theta=0.6595; <span class="comment">% TFP parameter to normalize units such that average household income relative to GDP per capita equals (the latter is normalized to 1): Real GDP/capita in 2019: $58,056</span>

<span class="comment">% Consumption allocation rule (1=uniform; 2=square root)</span>
cons_allocation_rule=2;

<span class="comment">% Social Security benefits</span>
SS=zeros(n_jgrid,2);
SS(jret:end,1)=0.24433; <span class="comment">% Average SS non-college 2005-2009 as a share of GDP per capita</span>
SS(jret:end,2)=0.29263; <span class="comment">% Average SS college 2005-2009 as a share of GDP per capita</span>
</pre><h2 id="5">PARAM Mortality</h2><p>Assume MORT_PROB will have 80 rows. Average based on Resulting Dataframes</p><pre class="codeinput">load(<span class="string">'Mortality_prob_by_age_18_99.mat'</span>,<span class="string">'mort_prob'</span>)
psi_full=1-mort_prob;
psi_full=[psi_full;0]; <span class="comment">% Maximum lifespan=100 (survival probability at age 100=0)</span>

<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_dense"</span>))
    psi = psi_full;
<span class="keyword">else</span>
    psi = NaN(n_jgrid,1);
    psi(1) = mean(1-mort_prob(1:2));
    psi(2:(end-1)) = prod(reshape(1-mort_prob(3:end), it_yrs_per_period, []), 1)';
    psi(end) = 0;
<span class="keyword">end</span>

clear <span class="string">mort_prob</span> <span class="string">psi_full</span>
</pre><h2 id="6">PARAM Productivity by Education Types</h2><p>Generate epsilon matrix A1. load external</p><pre class="codeinput">load(<span class="string">'Life_cycle_prod_by_educ.mat'</span>,<span class="string">'life_cycle_prod_by_educ'</span>) <span class="comment">% Life-cycle labor productivity for 20-100 year-olds by education (non-college vs. college)</span>
<span class="comment">% Set Annual</span>
epsilon_full=NaN(83,2);
epsilon_full(3:end,:)=life_cycle_prod_by_educ(:,:);

epsilon_full(1,:)=epsilon_full(3,:); <span class="comment">% Let life-cycle labor productivity of 18- and 19-year-olds be the same as that for 20-year-olds</span>
epsilon_full(2,:)=epsilon_full(3,:);

<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_dense"</span>))
    epsilon = epsilon_full;
<span class="keyword">else</span>
    epsilon=NaN(n_jgrid,2);
    epsilon(1,:) = epsilon_full(3,:);
    <span class="keyword">for</span> e=1:2
        epsilon(2:end-1,e) = mean(reshape(life_cycle_prod_by_educ(1:80, e), it_yrs_per_period, (n_jgrid-2)))';
    <span class="keyword">end</span>
<span class="keyword">end</span>

epsilon(jret:end,:)=0; <span class="comment">% Assume zero labor productivity for 65+ year-olds (exogenous retirement)</span>

clear <span class="string">life_cycle_prod_by_educ</span> <span class="string">epsilon_aux</span>
</pre><h2 id="7">PARAM Kids Transition</h2><p>Transition probabilities for number of children (0, 1, 2, 3, 4, or 5) (stored in the following order: Number of children in year 1, age, marital status, college attainment. Each column refers to the number of children in year 2)</p><p>PI_KIDS_TRANS_PROB has 6*2*41 = 492 rows. It is assuming strcmp(st_param_group, "default_base"). For tiny and small grid, select appropriate subset of rows to match appropriate age groups from PI_KIDS.</p><p>pi_kids_trans_prob estimation might change in the future if there are more age groups added. To make sure this code here works, use N_JGRID_PKTP as the N_JGRID count for PI_KIDS_TRANS_PROB. But assume there will always be up to 6 kids, and 2 marriage/notmarry groups.</p><pre class="codeinput">load(<span class="string">'pi_kids_trans_prob'</span>,<span class="string">'pi_kids_trans_prob'</span>)
n_kidsgrid_kptp = 5;
n_educgrid_kptp = 2;
n_marriedgrid_kptp = 2;
n_jgrid_pktp = 83;
pi_kids_pktp =NaN(<span class="keyword">...</span>
    n_kidsgrid_kptp,<span class="keyword">...</span>
    n_kidsgrid_kptp,<span class="keyword">...</span>
    n_jgrid_pktp,<span class="keyword">...</span>
    n_educgrid_kptp,<span class="keyword">...</span>
    n_marriedgrid_kptp);

<span class="keyword">for</span> kidsp=1:n_kidsgrid_kptp <span class="comment">% No. of kids in year 2</span>
    counter=0;
    <span class="keyword">for</span> kids=1:n_kidsgrid_kptp <span class="comment">% No. of kids in year 1</span>
        <span class="keyword">for</span> j=1:(n_jgrid_pktp-1) <span class="comment">% Age in year 1</span>
            <span class="keyword">for</span> married=1:n_marriedgrid_kptp <span class="comment">% Marital status</span>
                <span class="keyword">for</span> educ=1:n_educgrid_kptp <span class="comment">% Educational level</span>
                    counter=counter+1;
                    pi_kids_pktp(kids,kidsp,j,educ,married)=pi_kids_trans_prob(counter,kidsp);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

pi_kids_pktp(:,:,n_jgrid_pktp,:,:)=0;
pi_kids_pktp(:,1,n_jgrid_pktp,:,:)=1;

<span class="comment">% Subset Selection</span>
<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_dense"</span>))
    pi_kids = pi_kids_pktp;
<span class="keyword">else</span>
    pi_kids = pi_kids_pktp(<span class="keyword">...</span>
        1:n_kidsgrid, <span class="keyword">...</span>
        1:n_kidsgrid, <span class="keyword">...</span>
        round(linspace(1, n_jgrid_pktp, n_jgrid)), <span class="keyword">...</span>
        :, : <span class="keyword">...</span>
        );
<span class="keyword">end</span>

<span class="comment">% Ensure that all rows sum to 1 in case of rounding error</span>
<span class="keyword">for</span> kids=1:n_kidsgrid <span class="comment">% No. of kids in year 1</span>
    <span class="keyword">for</span> j=1:n_jgrid <span class="comment">% Age in year 1</span>
        <span class="keyword">for</span> educ=1:n_educgrid <span class="comment">% Educational level</span>
            <span class="keyword">for</span> married=1:n_marriedgrid <span class="comment">% Marital status</span>
                aux_sum=sum(pi_kids(kids,:,j,educ,married));
                pi_kids(kids,:,j,educ,married)=pi_kids(kids,:,j,educ,married)/aux_sum;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">%</span>

clear <span class="string">aux_sum</span> <span class="string">counter</span> <span class="string">pi_kids_trans_prob</span> <span class="string">pi_kids_pktp</span>
</pre><h2 id="8">PARAM Specifying asset grid (use non-linear spacing with minimum value of 0)</h2><pre class="codeinput">curv=3; <span class="comment">% Governs how the grid points are allocated</span>
scale_a=190; <span class="comment">% Maximum value of assets (NOTE: Verifying that it does not bind in Aggregation.m) grid=1.2451e-11</span>

agrid=zeros(n_agrid,1);

<span class="keyword">for</span> i=2:n_agrid
	agrid(i)=scale_a*((i-1)/(n_agrid-1))^curv;
<span class="keyword">end</span>
</pre><h2 id="9">PARAM Derive transition probabilities and stationary distribution for productivity shock</h2><pre class="codeinput"><span class="comment">% Discretize process for persistent productivity shocks and derive stationary distribution</span>
[eta_grid,pi_eta]=rouwenhorst(rho_eta,sqrt(sigma_eta),n_etagrid);

stat_distr_eta=NaN(1,n_etagrid);
x0=(1/n_etagrid)*ones(1,n_etagrid);
err=1;
tol=10^-12;
<span class="keyword">while</span> err&gt;tol
    x1=x0*pi_eta(:,:);
    err=max(abs(x1-x0));
    <span class="keyword">if</span> err&gt;tol
       x0=x1;
    <span class="keyword">end</span>
<span class="keyword">end</span>
stat_distr_eta(1,:)=x0;
stat_distr_eta = stat_distr_eta./sum(stat_distr_eta);
</pre><h2 id="10">Initial conditions for marital status, college attainment, and number of kids</h2><p>Distribution of educational attainment from PSID tab Rcollege if RAGE&gt;=18 &amp; RAGE!=. [aweight=WEIGHT]</p><pre class="codeinput">stat_distr_educ(1,1)=0.6970; <span class="comment">% No college</span>
stat_distr_educ(1,2)=0.3030; <span class="comment">% College</span>

<span class="comment">% Distribution of marital status conditional on college attainment from PSID</span>
<span class="comment">% tab  Rmarried if RAGE&gt;=18 &amp; RAGE!=. &amp; Rcollege==0 [aweight=WEIGHT]</span>
stat_distr_married(1,1)=0.5635; <span class="comment">% Not married</span>
stat_distr_married(1,2)=0.4365; <span class="comment">% Married</span>

<span class="comment">% tab  Rmarried if RAGE&gt;=18 &amp; RAGE!=. &amp; Rcollege==1 [aweight=WEIGHT]</span>
stat_distr_married(2,1)=0.4364; <span class="comment">% Not married</span>
stat_distr_married(2,2)=0.5636; <span class="comment">% Married</span>

<span class="comment">% Stationary distribution of children at age 20 from PSID</span>
<span class="comment">% Not married and no college</span>
<span class="comment">% tab kids if Rmarried==0 &amp; Rcollege==0 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(1,1,1)=0.7333;
stat_distr_kids_kn5(1,1,2)=0.1513;
stat_distr_kids_kn5(1,1,3)=0.0828;
stat_distr_kids_kn5(1,1,4)=0.0236;
stat_distr_kids_kn5(1,1,5)=0.0059;

<span class="comment">% Not married but college-educated</span>
<span class="comment">% tab kids if Rmarried==0 &amp; Rcollege==1 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(2,1,1)=0.9752;
stat_distr_kids_kn5(2,1,2)=0.0236;
stat_distr_kids_kn5(2,1,3)=0.0001;
stat_distr_kids_kn5(2,1,4)=0.0011;
stat_distr_kids_kn5(2,1,5)=0;

<span class="comment">% Married and no college</span>
<span class="comment">% tab kids if Rmarried==1 &amp; Rcollege==0 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(1,2,1)=0.4143;
stat_distr_kids_kn5(1,2,2)=0.2958;
stat_distr_kids_kn5(1,2,3)=0.2131;
stat_distr_kids_kn5(1,2,4)=0.0569;
stat_distr_kids_kn5(1,2,5)=0.0199;

<span class="comment">% Married and college-educated</span>
<span class="comment">% tab kids if Rmarried==1 &amp; Rcollege==1 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(2,2,1)=0.7534;
stat_distr_kids_kn5(2,2,2)=0.2153;
stat_distr_kids_kn5(2,2,3)=0.0221;
stat_distr_kids_kn5(2,2,4)=0.0091;
stat_distr_kids_kn5(2,2,5)=0;

<span class="comment">% Subset Kids for Smaller Solutions</span>
<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_base"</span>))
    stat_distr_kids = stat_distr_kids_kn5;
<span class="keyword">else</span>
    stat_distr_kids = stat_distr_kids_kn5(:,:,1:n_kidsgrid);
<span class="keyword">end</span>

<span class="comment">% Reweight</span>
bl_sum_onebyone = true;
<span class="keyword">if</span> (bl_sum_onebyone)
    aux=sum(stat_distr_kids(1,1,:));
    stat_distr_kids(1,1,:)=stat_distr_kids(1,1,:)/aux;
    aux=sum(stat_distr_kids(2,1,:));
    stat_distr_kids(2,1,:)=stat_distr_kids(2,1,:)/aux;
    aux=sum(stat_distr_kids(1,2,:));
    stat_distr_kids(1,2,:)=stat_distr_kids(1,2,:)/aux;
    aux=sum(stat_distr_kids(2,2,:));
    stat_distr_kids(2,2,:)=stat_distr_kids(2,2,:)/aux;
<span class="keyword">else</span>
mt_aux = repmat(sum(stat_distr_kids, 3), <span class="keyword">...</span>
    [1,1,size(stat_distr_kids,3)]);
    stat_distr_kids(2,2,:)=stat_distr_kids./mt_aux;
<span class="keyword">end</span>

clear <span class="string">aux</span>
</pre><h2 id="11">Population distribution</h2><p>Normalize mass of 18-year-olds to 1</p><pre class="codeinput">Pop=zeros(n_jgrid,1);
Pop(1)=1;
<span class="keyword">for</span> j=2:n_jgrid
    Pop(j)=Pop(j-1)*psi(j-1)/(1+g_n);
<span class="keyword">end</span>

name=<span class="string">'Old-age dependency ratio (ratio of 65+/(18-64))='</span>;
st_old_age_depend =[name,num2str(sum(Pop(jret:end))/sum(Pop(1:(jret-1))))];
<span class="comment">% disp(st_old_age_depend);</span>
</pre><h2 id="12">Set Parameter Maps</h2><pre class="codeinput">mp_params_preftechpricegov = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_preftechpricegov(<span class="string">'gamma'</span>) = gamma;
mp_params_preftechpricegov(<span class="string">'beta'</span>) = beta;
mp_params_preftechpricegov(<span class="string">'theta'</span>) = theta;
mp_params_preftechpricegov(<span class="string">'cons_allocation_rule'</span>) = cons_allocation_rule;
mp_params_preftechpricegov(<span class="string">'r'</span>) = r;
mp_params_preftechpricegov(<span class="string">'g_n'</span>) = g_n;
mp_params_preftechpricegov(<span class="string">'g_cons'</span>) = g_cons;
mp_params_preftechpricegov(<span class="string">'a2'</span>) = a2;

mp_params_statesgrid = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_statesgrid(<span class="string">'agrid'</span>) = agrid;
mp_params_statesgrid(<span class="string">'eta_grid'</span>) = eta_grid;

mp_params_exotrans = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_exotrans(<span class="string">'pi_eta'</span>) = pi_eta;
mp_params_exotrans(<span class="string">'pi_kids'</span>) = pi_kids;
mp_params_exotrans(<span class="string">'psi'</span>) = psi;

mp_params_typelife = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_typelife(<span class="string">'epsilon'</span>) = epsilon;
mp_params_typelife(<span class="string">'SS'</span>) = SS;

mp_params_intlen = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_intlen(<span class="string">'n_jgrid'</span>) = n_jgrid;
mp_params_intlen(<span class="string">'n_agrid'</span>) = n_agrid;
mp_params_intlen(<span class="string">'n_etagrid'</span>) = n_etagrid;
mp_params_intlen(<span class="string">'n_educgrid'</span>) = n_educgrid;
mp_params_intlen(<span class="string">'n_marriedgrid'</span>) = n_marriedgrid;
mp_params_intlen(<span class="string">'n_kidsgrid'</span>) = n_kidsgrid;

mp_params_stat = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_stat(<span class="string">'stat_distr_eta'</span>) = stat_distr_eta;
mp_params_stat(<span class="string">'stat_distr_educ'</span>) = stat_distr_educ;
mp_params_stat(<span class="string">'stat_distr_married'</span>) = stat_distr_married;
mp_params_stat(<span class="string">'stat_distr_kids'</span>) = stat_distr_kids;
mp_params_stat(<span class="string">'Pop'</span>) = Pop;
mp_params_stat(<span class="string">'st_old_age_depend'</span>) = string(st_old_age_depend);
</pre><h2 id="13">Combine Maps</h2><pre class="codeinput">mp_params = [mp_params_preftechpricegov; mp_params_statesgrid ; <span class="keyword">...</span>
    mp_params_exotrans; mp_params_typelife; mp_params_intlen ; <span class="keyword">...</span>
    mp_params_stat];

mp_params(<span class="string">'mp_params_name'</span>) = string(st_param_group);

<span class="comment">% MP_PARAMS = [MP_PARAMS_PREFTECHPRICE; MP_PARAMS_STATESGRID ; ...</span>
<span class="comment">%     MP_PARAMS_EXOTRANS; MP_PARAMS_TYPELIFE; MP_PARAMS_INTLEN];</span>
</pre><h2 id="14">Print</h2><pre class="codeinput"><span class="keyword">if</span> (bl_print_mp_params)
    ff_container_map_display(mp_params_preftechpricegov);
    ff_container_map_display(mp_params_intlen);
    ff_container_map_display(mp_params_statesgrid, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_exotrans, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_typelife, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_stat, it_row_n_keep, it_col_n_keep);
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_preftechpricegov Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                            i    idx      value   
                            _    ___    __________

    a2                      1     1         1.9007
    beta                    2     2          0.972
    cons_allocation_rule    3     3              2
    g_cons                  4     4     0.17575574
    g_n                     5     5           0.01
    gamma                   6     6              2
    r                       7     7           0.04
    theta                   8     8         0.6595

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_intlen Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                     i    idx    value
                     _    ___    _____

    n_agrid          1     1      55  
    n_educgrid       2     2       2  
    n_etagrid        3     3       9  
    n_jgrid          4     4      83  
    n_kidsgrid       5     5       5  
    n_marriedgrid    6     6       2  

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_statesgrid ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                i    idx    ndim    numel    rowN    colN             sum                     mean                   std                 coefvari                  min                 max       
                _    ___    ____    _____    ____    ____    _____________________    _____________________    ________________    _____________________    _________________    ________________

    agrid       1     1      2       55       55      1           2660.87962962963         48.3796296296296    55.8001666608665         1.15338143528681                    0                 190
    eta_grid    2     2      2        9        9      1      -2.22044604925031e-16    -2.46716227694479e-17    1.30558241966773    -5.29183844884536e+16    -1.90692517849118    1.90692517849118

xxx TABLE:agrid xxxxxxxxxxxxxxxxxx
                   c1         
           ___________________

    r1                       0
    r2     0.00120662500635066
    r3     0.00965300005080526
    r4      0.0325788751714678
    r52       160.060013717421
    r53       169.661128892953
    r54       179.638711070467
    r55                    190

xxx TABLE:eta_grid xxxxxxxxxxxxxxxxxx
                  c1        
          __________________

    r1     -1.90692517849118
    r2     -1.43019388386839
    r3    -0.953462589245592
    r4    -0.476731294622796
    r6     0.476731294622796
    r7     0.953462589245592
    r8      1.43019388386839
    r9      1.90692517849118

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_exotrans ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
               i    idx    ndim    numel    rowN    colN        sum               mean                  std               coefvari                 min                    max       
               _    ___    ____    _____    ____    ____    ____________    _________________    _________________    _________________    ____________________    _________________

    pi_eta     1     1      2        81       9        9               9    0.111111111111111    0.289681339309146     2.60713205378232    1.00000000000001e-16    0.924251408497207
    pi_kids    2     2      5      8300       5     1660            1660                  0.2     0.29879519368243     1.49397596841215                       0                    1
    psi        3     3      2        83      83        1    78.160070152    0.941687592192771    0.131199873233344    0.139324202974617                       0          0.999369671

xxx TABLE:pi_eta xxxxxxxxxxxxxxxxxx
                   c1                      c2                      c3                      c4                      c6                      c7                      c8                      c9         
          ____________________    ____________________    ____________________    ____________________    ____________________    ____________________    ____________________    ____________________

    r1        0.92274469442792      0.0745652278325593      0.0026361444183228    5.32554427944001e-05    5.43367440000002e-09    2.74428000000001e-11    7.92000000000005e-14    1.00000000000001e-16
    r2     0.00932065347906991       0.923403730532501      0.0652645451445373      0.0019774445223456    3.36229185600001e-07    2.03769720000001e-09    6.86080000000004e-12    9.90000000000006e-15
    r3    9.41480149401002e-05      0.0186470128984392       0.923874614696603      0.0559524525165144    1.90227119544001e-05         1.441011628e-07    5.82199200000003e-10    9.80100000000005e-13
    r4    9.50990049900002e-07      0.0002824920746208      0.0279762262582572       0.924157202840626    0.000941768342905602    9.51135597720002e-06    4.80327408000002e-08    9.70299000000004e-11
    r6    9.70299000000004e-11    4.80327408000002e-08    9.51135597720003e-06    0.000941768342905602       0.924157202840626      0.0279762262582572      0.0002824920746208    9.50990049900002e-07
    r7    9.80100000000005e-13    5.82199200000003e-10         1.441011628e-07    1.90227119544001e-05      0.0559524525165144       0.923874614696603      0.0186470128984392    9.41480149401002e-05
    r8    9.90000000000006e-15    6.86080000000004e-12    2.03769720000001e-09    3.36229185600001e-07      0.0019774445223456      0.0652645451445373       0.923403730532501     0.00932065347906991
    r9    1.00000000000001e-16    7.92000000000005e-14    2.74428000000001e-11    5.43367440000002e-09    5.32554427944001e-05      0.0026361444183228      0.0745652278325593        0.92274469442792

xxx TABLE:pi_kids xxxxxxxxxxxxxxxxxx
                   c1                      c2                      c3                      c4             c1657    c1658    c1659    c1660
          ____________________    ____________________    ____________________    ____________________    _____    _____    _____    _____

    r1       0.885810221147405       0.111368785929732     0.00279039338576291    3.02059206004454e-05      0        0        0        0  
    r2      0.0511182117632578       0.659431849982379       0.285062928221033      0.0043303340909526      0        0        0        0  
    r3     0.00126545853158291      0.0533200987428242       0.787629128602746       0.155381262519464      0        0        0        0  
    r4    1.80799519610212e-05    0.000805119610741851      0.0699524858721347       0.784743106946937      0        0        0        0  
    r5    1.81853676308963e-07    8.10474364589005e-06    0.000757218270042704      0.0554441317825653      0        0        0        0  

xxx TABLE:psi xxxxxxxxxxxxxxxxxx
               c1     
           ___________

    r1     0.999369671
    r2     0.999328247
    r3     0.999287421
    r4     0.999246823
    r80     0.71587307
    r81     0.69771592
    r82    0.681385166
    r83              0

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_typelife ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
               i    idx    ndim    numel    rowN    colN         sum               mean                  std               coefvari         min        max    
               _    ___    ____    _____    ____    ____    _____________    _________________    _________________    _________________    ___    ___________

    SS         1     1      2       166      83      2            18.7936    0.113214457831325    0.133911415049701     1.18281196248991     0         0.29263
    epsilon    2     2      2       166      83      2      162.614843843     0.97960749303012    0.892942204468349    0.911530598552592     0     2.261193991

xxx TABLE:SS xxxxxxxxxxxxxxxxxx
             c1         c2   
           _______    _______

    r1           0          0
    r2           0          0
    r3           0          0
    r4           0          0
    r80    0.24433    0.29263
    r81    0.24433    0.29263
    r82    0.24433    0.29263
    r83    0.24433    0.29263

xxx TABLE:epsilon xxxxxxxxxxxxxxxxxx
               c1             c2     
           ___________    ___________

    r1               1              1
    r2               1              1
    r3               1              1
    r4     1.039896011    1.092294335
    r80              0              0
    r81              0              0
    r82              0              0
    r83              0              0

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_stat ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                          i    idx    ndim    numel    rowN    colN          sum                 mean                  std                coefvari                 min                   max       
                          _    ___    ____    _____    ____    ____    ________________    _________________    __________________    _________________    ___________________    _________________

    Pop                   1     1      2       83       83       1     45.7930651914795    0.551723677005778     0.301399253298434    0.546286602986004    0.00627865793435248                    1
    stat_distr_educ       2     3      2        2        1       2                    1                  0.5       0.2786000717875    0.557200143574999                  0.303                0.697
    stat_distr_eta        3     4      2        9        1       9                    1    0.111111111111111     0.103240922183481    0.929168299651329     0.0039062500025211    0.273437499974789
    stat_distr_kids       4     5      3       20        2      10                    4                  0.2     0.294334846368898     1.47167423184449                      0               0.9752
    stat_distr_married    5     6      2        4        2       2                    2                  0.5    0.0733812419264397    0.146762483852879                 0.4364               0.5636

xxx TABLE:Pop xxxxxxxxxxxxxxxxxx
                   c1         
           ___________________

    r1                       1
    r2       0.989474921782178
    r3       0.979020038648561
    r4        0.96863604903806
    r80     0.0190074392897291
    r81     0.0134721919972049
    r82     0.0093066958749965
    r83    0.00627865793435248

xxx TABLE:stat_distr_educ xxxxxxxxxxxxxxxxxx
           c1       c2  
          _____    _____

    r1    0.697    0.303

xxx TABLE:stat_distr_eta xxxxxxxxxxxxxxxxxx
                  c1                    c2                   c3                   c4                   c6                   c7                    c8                    c9        
          __________________    __________________    _________________    _________________    _________________    _________________    __________________    __________________

    r1    0.0039062500025211    0.0312500000100844    0.109375000010084    0.218749999989916    0.218749999989916    0.109375000010085    0.0312500000100844    0.0039062500025211

xxx TABLE:stat_distr_kids xxxxxxxxxxxxxxxxxx
                 c1                   c2                   c3                   c4                    c7                    c8                    c9              c10  
          _________________    _________________    _________________    _________________    __________________    __________________    ___________________    ______

    r1    0.735580298926673               0.4143    0.151770488514395               0.2958    0.0236733875012539                0.0569    0.00591834687531347    0.0199
    r2               0.9752    0.753475347534754               0.0236    0.215321532153215                0.0011    0.0091009100910091                      0         0

xxx TABLE:stat_distr_married xxxxxxxxxxxxxxxxxx
            c1        c2  
          ______    ______

    r1    0.5635    0.4365
    r2    0.4364    0.5636

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_stat String
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                          i     idx                             string                          
                         ___    ___    _________________________________________________________

    st_old_age_depend    "1"    "2"    "Old-age dependency ratio (ratio of 65+/(18-64))=0.23426"

</pre><h2 id="15">Return</h2><pre class="codeinput"><span class="keyword">if</span> (nargout==1)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
<span class="keyword">elseif</span> (nargout==6)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
    varargout{2} = mp_params_preftechpricegov;
    varargout{3} = mp_params_statesgrid;
    varargout{4} = mp_params_exotrans;
    varargout{5} = mp_params_typelife;
    varargout{6} = mp_params_intlen;
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% SNW_MP_PARAM Organizes and Sets Various Model Input Scalar and Array Parameters
%    SNW_MP_PARAM sets several main default parameter structures. There are
%    four types of parameters: scalar (pref, tech, prices), state space
%    arrays, Transition Matrixes (Exogenous), Permanent Type (Life-cycle
%    Arrays)
%
%    ST_PARAM_GROUP options:
%
%    * "default_base": Main
%    * "default_small": Quick Testing
%    * "default_tiny": Quicker Testing
%
%    Pref, Technology, and prices SCALARS:
%
%    * BETA discount
%    * THETA total factor productivity normalizer
%    * R interest rate
%
%    Vectorized State Space ARRAYS:
%
%    * AGRID asset grid
%    * ETA_GRID productivity shock grid
%
%    Transition Matrixes ARRAYS:
%
%    * PI_ETA shock productivity transition
%    * PI_KIDS shock kids count transition
%    * PSI shock survival probability
%
%    Permanent Education Type Heterogeneity ARRAYS:
%
%    * EPSILON perfect-foresight education type transition
%    * SS Social Security
%
%    MP_PARAMS = SNW_MP_PARAM() get default parameters all in the same
%    container map
%
%    MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters
%    for the type ST_PARAM_GROUP. ST_PARAM_GROUP groups include:
%    "default_base", "default_small", etc.
%
%    MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS) generates
%    default parameters for the type ST_PARAM_GROUP, display parameter map
%    details if BL_PRINT_MP_PARAMS is true.
%
%    MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS,
%    IT_ROW_N_KEEP, IT_COL_N_KEEP) Control for output matrixes how many
%    rows and columns to print out.
%
%    [MP_PARAMS, MP_PARAMS_PREFTECHPRICEGOV, MP_PARAMS_STATESGRID,
%    MP_PARAMS_EXOTRANS, MP_PARAMS_TYPELIFE, MP_PARAMS_INTLEN] =
%    SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters for the type
%    ST_PARAM_GROUP, and output all parameters in one MP_PARAMS, but also
%    parameters oraganized in submaps by parameter types
%
%    See also SNWX_MP_PARAM
%

%%
function varargout = snw_mp_param(varargin)
%% Parse Main Inputs and Set Defaults
if (~isempty(varargin))

    [it_row_n_keep, it_col_n_keep] = deal(8, 8);

    if (length(varargin)==1)
        st_param_group = varargin{:};
        bl_print_mp_params = false;
    elseif (length(varargin)==2)
        [st_param_group, bl_print_mp_params] = varargin{:};
    elseif (length(varargin)==4)
        [st_param_group, bl_print_mp_params, it_row_n_keep, it_col_n_keep] = varargin{:};
    end

else

%     st_param_group = 'default_base';
    st_param_group = 'default_dense';    
%     st_param_group = 'default_tiny';
    bl_print_mp_params = true;
    [it_row_n_keep, it_col_n_keep] = deal(8, 8);

end

%% Parametesr Grid Points
% Number of grid points
n_educgrid=2; % No. of grid points for educational attainment (college vs. non-college)
n_marriedgrid=2; % No. of grid points for marital status
n_kidsgrid=5; % No. of grid points for children (0 to 5+ children)
if(strcmp(st_param_group, "default_dense"))
    n_jgrid  =83; % Age runs from 18 to 100 (a period is 2 years)
    jret     =49;
    n_agrid  =55; % No. of grid points for assets
    n_etagrid =9; % No. of grid points for persistent labor productivity shocks
    n_kidsgrid=5; % No. of grid points for children (0 to 4+ children)
elseif(strcmp(st_param_group, "default_base"))
    n_jgrid  =42; % Age runs from 18 to 100 (a period is 2 years)
    jret=25;
    n_agrid  =40; % No. of grid points for assets
    n_etagrid =7; % No. of grid points for persistent labor productivity shocks
    n_kidsgrid=5; % No. of grid points for children (0 to 4+ children)
elseif(strcmp(st_param_group, "default_tiny"))
    n_jgrid   =7; % Age runs from 18 to 100 (5 periods of 16 years + terminal)
    jret =5;
    n_agrid   =10; % No. of grid points for assets
    n_etagrid =5; % No. of grid points for persistent labor productivity shocks
    n_kidsgrid=3; % No. of grid points for children (0 to 5+ children)
elseif(strcmp(st_param_group, "default_small"))
    n_jgrid   =18; % Age runs from 18 to 100 (16 periods of 5 years + terminal)
    jret =13;
    n_agrid   =20; % No. of grid points for assets
    n_etagrid =5; % No. of grid points for persistent labor productivity shocks
    n_kidsgrid=3; % No. of grid points for children (0 to 5+ children)
end

% Years Per Period
if (n_jgrid == 83)
    it_yrs_per_period = 1;
else
    it_yrs_per_period = (80/(n_jgrid-2));
end


%% Preferences, Technologies, etc.
% Non-calibrated parameters
gamma=2; % Risk aversion parameter
if(strcmp(st_param_group, "default_dense"))
    rho_eta=0.98; % Persistence of AR(1) productivity shocks
    sigma_eta=0.018; % Variance of AR(1) productivity shocks
    g_n=0.01; % Annual population growth of 1.1 percent
    r=0.04; % Annual real interest rate of 4.0 percent from McGrattan and Prescott
    beta=0.972; % Discount factor
else
    rho_eta=0.98^it_yrs_per_period;
    sigma_eta=sqrt(0.018^2*sum((0.98.^(0:(it_yrs_per_period-1))).^2));
    g_n=(1.01^it_yrs_per_period)-1;
    r=(1.04^it_yrs_per_period)-1;
    beta=0.972^it_yrs_per_period; % Discount factor
end

% Government budget constraint parameters
g_cons=0.17575574; % Government consumption expenditures to GDP (BEA: Average 2015-2019)
a2=1.9007; % Initial guess for average income tax burden (if we use GS)

% Calibrated parameters
theta=0.6595; % TFP parameter to normalize units such that average household income relative to GDP per capita equals (the latter is normalized to 1): Real GDP/capita in 2019: $58,056

% Consumption allocation rule (1=uniform; 2=square root)
cons_allocation_rule=2;

% Social Security benefits
SS=zeros(n_jgrid,2);
SS(jret:end,1)=0.24433; % Average SS non-college 2005-2009 as a share of GDP per capita
SS(jret:end,2)=0.29263; % Average SS college 2005-2009 as a share of GDP per capita

%% PARAM Mortality
% Assume MORT_PROB will have 80 rows. Average based on Resulting Dataframes
load('Mortality_prob_by_age_18_99.mat','mort_prob')
psi_full=1-mort_prob;
psi_full=[psi_full;0]; % Maximum lifespan=100 (survival probability at age 100=0)

if(strcmp(st_param_group, "default_dense"))
    psi = psi_full;
else
    psi = NaN(n_jgrid,1);
    psi(1) = mean(1-mort_prob(1:2));
    psi(2:(end-1)) = prod(reshape(1-mort_prob(3:end), it_yrs_per_period, []), 1)';
    psi(end) = 0;
end

clear mort_prob psi_full

%% PARAM Productivity by Education Types
% Generate epsilon matrix
% A1. load external
load('Life_cycle_prod_by_educ.mat','life_cycle_prod_by_educ') % Life-cycle labor productivity for 20-100 year-olds by education (non-college vs. college)
% Set Annual
epsilon_full=NaN(83,2);
epsilon_full(3:end,:)=life_cycle_prod_by_educ(:,:);

epsilon_full(1,:)=epsilon_full(3,:); % Let life-cycle labor productivity of 18- and 19-year-olds be the same as that for 20-year-olds
epsilon_full(2,:)=epsilon_full(3,:);

if(strcmp(st_param_group, "default_dense"))
    epsilon = epsilon_full;
else
    epsilon=NaN(n_jgrid,2);
    epsilon(1,:) = epsilon_full(3,:);
    for e=1:2
        epsilon(2:end-1,e) = mean(reshape(life_cycle_prod_by_educ(1:80, e), it_yrs_per_period, (n_jgrid-2)))';
    end
end

epsilon(jret:end,:)=0; % Assume zero labor productivity for 65+ year-olds (exogenous retirement)

clear life_cycle_prod_by_educ epsilon_aux

%% PARAM Kids Transition
% Transition probabilities for number of children (0, 1, 2, 3, 4, or 5) (stored in the following order:
% Number of children in year 1, age, marital status, college attainment. Each column refers to
% the number of children in year 2)
%
% PI_KIDS_TRANS_PROB has 6*2*41 = 492 rows. It is assuming
% strcmp(st_param_group, "default_base"). For tiny and small grid, select
% appropriate subset of rows to match appropriate age groups from PI_KIDS.
%
% pi_kids_trans_prob estimation might change in the future if there are
% more age groups added. To make sure this code here works, use
% N_JGRID_PKTP as the N_JGRID count for PI_KIDS_TRANS_PROB. But assume
% there will always be up to 6 kids, and 2 marriage/notmarry groups.


load('pi_kids_trans_prob','pi_kids_trans_prob')
n_kidsgrid_kptp = 5;
n_educgrid_kptp = 2;
n_marriedgrid_kptp = 2;
n_jgrid_pktp = 83;
pi_kids_pktp =NaN(...
    n_kidsgrid_kptp,...
    n_kidsgrid_kptp,...
    n_jgrid_pktp,...
    n_educgrid_kptp,...
    n_marriedgrid_kptp);

for kidsp=1:n_kidsgrid_kptp % No. of kids in year 2
    counter=0;
    for kids=1:n_kidsgrid_kptp % No. of kids in year 1
        for j=1:(n_jgrid_pktp-1) % Age in year 1
            for married=1:n_marriedgrid_kptp % Marital status
                for educ=1:n_educgrid_kptp % Educational level
                    counter=counter+1;
                    pi_kids_pktp(kids,kidsp,j,educ,married)=pi_kids_trans_prob(counter,kidsp);
                end
            end
        end
    end
end

pi_kids_pktp(:,:,n_jgrid_pktp,:,:)=0;
pi_kids_pktp(:,1,n_jgrid_pktp,:,:)=1;

% Subset Selection
if(strcmp(st_param_group, "default_dense"))
    pi_kids = pi_kids_pktp;
else
    pi_kids = pi_kids_pktp(...
        1:n_kidsgrid, ...
        1:n_kidsgrid, ...
        round(linspace(1, n_jgrid_pktp, n_jgrid)), ...
        :, : ...
        );
end

% Ensure that all rows sum to 1 in case of rounding error
for kids=1:n_kidsgrid % No. of kids in year 1
    for j=1:n_jgrid % Age in year 1
        for educ=1:n_educgrid % Educational level
            for married=1:n_marriedgrid % Marital status
                aux_sum=sum(pi_kids(kids,:,j,educ,married));
                pi_kids(kids,:,j,educ,married)=pi_kids(kids,:,j,educ,married)/aux_sum;
            end
        end
    end
end

%

clear aux_sum counter pi_kids_trans_prob pi_kids_pktp

%% PARAM Specifying asset grid (use non-linear spacing with minimum value of 0)
curv=3; % Governs how the grid points are allocated
scale_a=190; % Maximum value of assets (NOTE: Verifying that it does not bind in Aggregation.m) grid=1.2451e-11

agrid=zeros(n_agrid,1);

for i=2:n_agrid
	agrid(i)=scale_a*((i-1)/(n_agrid-1))^curv;
end

%% PARAM Derive transition probabilities and stationary distribution for productivity shock

% Discretize process for persistent productivity shocks and derive stationary distribution
[eta_grid,pi_eta]=rouwenhorst(rho_eta,sqrt(sigma_eta),n_etagrid);

stat_distr_eta=NaN(1,n_etagrid);
x0=(1/n_etagrid)*ones(1,n_etagrid);
err=1;
tol=10^-12;
while err>tol
    x1=x0*pi_eta(:,:);
    err=max(abs(x1-x0));
    if err>tol
       x0=x1;
    end
end
stat_distr_eta(1,:)=x0;
stat_distr_eta = stat_distr_eta./sum(stat_distr_eta);

%% Initial conditions for marital status, college attainment, and number of kids
% Distribution of educational attainment from PSID
% tab Rcollege if RAGE>=18 & RAGE!=. [aweight=WEIGHT]
stat_distr_educ(1,1)=0.6970; % No college
stat_distr_educ(1,2)=0.3030; % College

% Distribution of marital status conditional on college attainment from PSID
% tab  Rmarried if RAGE>=18 & RAGE!=. & Rcollege==0 [aweight=WEIGHT]
stat_distr_married(1,1)=0.5635; % Not married
stat_distr_married(1,2)=0.4365; % Married

% tab  Rmarried if RAGE>=18 & RAGE!=. & Rcollege==1 [aweight=WEIGHT]
stat_distr_married(2,1)=0.4364; % Not married
stat_distr_married(2,2)=0.5636; % Married

% Stationary distribution of children at age 20 from PSID
% Not married and no college
% tab kids if Rmarried==0 & Rcollege==0 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(1,1,1)=0.7333;
stat_distr_kids_kn5(1,1,2)=0.1513;
stat_distr_kids_kn5(1,1,3)=0.0828;
stat_distr_kids_kn5(1,1,4)=0.0236;
stat_distr_kids_kn5(1,1,5)=0.0059;

% Not married but college-educated
% tab kids if Rmarried==0 & Rcollege==1 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(2,1,1)=0.9752;
stat_distr_kids_kn5(2,1,2)=0.0236;
stat_distr_kids_kn5(2,1,3)=0.0001;
stat_distr_kids_kn5(2,1,4)=0.0011;
stat_distr_kids_kn5(2,1,5)=0;

% Married and no college
% tab kids if Rmarried==1 & Rcollege==0 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(1,2,1)=0.4143;
stat_distr_kids_kn5(1,2,2)=0.2958;
stat_distr_kids_kn5(1,2,3)=0.2131;
stat_distr_kids_kn5(1,2,4)=0.0569;
stat_distr_kids_kn5(1,2,5)=0.0199;

% Married and college-educated
% tab kids if Rmarried==1 & Rcollege==1 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(2,2,1)=0.7534;
stat_distr_kids_kn5(2,2,2)=0.2153;
stat_distr_kids_kn5(2,2,3)=0.0221;
stat_distr_kids_kn5(2,2,4)=0.0091;
stat_distr_kids_kn5(2,2,5)=0;

% Subset Kids for Smaller Solutions
if(strcmp(st_param_group, "default_base"))
    stat_distr_kids = stat_distr_kids_kn5;
else
    stat_distr_kids = stat_distr_kids_kn5(:,:,1:n_kidsgrid);
end

% Reweight
bl_sum_onebyone = true;
if (bl_sum_onebyone)
    aux=sum(stat_distr_kids(1,1,:));
    stat_distr_kids(1,1,:)=stat_distr_kids(1,1,:)/aux;
    aux=sum(stat_distr_kids(2,1,:));
    stat_distr_kids(2,1,:)=stat_distr_kids(2,1,:)/aux;
    aux=sum(stat_distr_kids(1,2,:));
    stat_distr_kids(1,2,:)=stat_distr_kids(1,2,:)/aux;
    aux=sum(stat_distr_kids(2,2,:));
    stat_distr_kids(2,2,:)=stat_distr_kids(2,2,:)/aux;
else
mt_aux = repmat(sum(stat_distr_kids, 3), ...
    [1,1,size(stat_distr_kids,3)]);
    stat_distr_kids(2,2,:)=stat_distr_kids./mt_aux;
end

clear aux

%% Population distribution
% Normalize mass of 18-year-olds to 1
Pop=zeros(n_jgrid,1);
Pop(1)=1;
for j=2:n_jgrid
    Pop(j)=Pop(j-1)*psi(j-1)/(1+g_n);
end

name='Old-age dependency ratio (ratio of 65+/(18-64))=';
st_old_age_depend =[name,num2str(sum(Pop(jret:end))/sum(Pop(1:(jret-1))))];
% disp(st_old_age_depend);

%% Set Parameter Maps
mp_params_preftechpricegov = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_preftechpricegov('gamma') = gamma;
mp_params_preftechpricegov('beta') = beta;
mp_params_preftechpricegov('theta') = theta;
mp_params_preftechpricegov('cons_allocation_rule') = cons_allocation_rule;
mp_params_preftechpricegov('r') = r;
mp_params_preftechpricegov('g_n') = g_n;
mp_params_preftechpricegov('g_cons') = g_cons;
mp_params_preftechpricegov('a2') = a2;

mp_params_statesgrid = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_statesgrid('agrid') = agrid;
mp_params_statesgrid('eta_grid') = eta_grid;

mp_params_exotrans = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_exotrans('pi_eta') = pi_eta;
mp_params_exotrans('pi_kids') = pi_kids;
mp_params_exotrans('psi') = psi;

mp_params_typelife = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_typelife('epsilon') = epsilon;
mp_params_typelife('SS') = SS;

mp_params_intlen = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_intlen('n_jgrid') = n_jgrid;
mp_params_intlen('n_agrid') = n_agrid;
mp_params_intlen('n_etagrid') = n_etagrid;
mp_params_intlen('n_educgrid') = n_educgrid;
mp_params_intlen('n_marriedgrid') = n_marriedgrid;
mp_params_intlen('n_kidsgrid') = n_kidsgrid;

mp_params_stat = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_stat('stat_distr_eta') = stat_distr_eta;
mp_params_stat('stat_distr_educ') = stat_distr_educ;
mp_params_stat('stat_distr_married') = stat_distr_married;
mp_params_stat('stat_distr_kids') = stat_distr_kids;
mp_params_stat('Pop') = Pop;
mp_params_stat('st_old_age_depend') = string(st_old_age_depend);

%% Combine Maps
mp_params = [mp_params_preftechpricegov; mp_params_statesgrid ; ...
    mp_params_exotrans; mp_params_typelife; mp_params_intlen ; ...
    mp_params_stat];

mp_params('mp_params_name') = string(st_param_group);

% MP_PARAMS = [MP_PARAMS_PREFTECHPRICE; MP_PARAMS_STATESGRID ; ...
%     MP_PARAMS_EXOTRANS; MP_PARAMS_TYPELIFE; MP_PARAMS_INTLEN];

%% Print
if (bl_print_mp_params)
    ff_container_map_display(mp_params_preftechpricegov);
    ff_container_map_display(mp_params_intlen);
    ff_container_map_display(mp_params_statesgrid, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_exotrans, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_typelife, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_stat, it_row_n_keep, it_col_n_keep);
end

%% Return
if (nargout==1)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
elseif (nargout==6)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
    varargout{2} = mp_params_preftechpricegov;
    varargout{3} = mp_params_statesgrid;
    varargout{4} = mp_params_exotrans;
    varargout{5} = mp_params_typelife;
    varargout{6} = mp_params_intlen;
end

end

##### SOURCE END #####
--></body></html>