
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>SNW_MP_PARAM Organizes and Sets Various Model Input Scalar and Array Parameters</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-07-10"><meta name="DC.source" content="snw_mp_param.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>SNW_MP_PARAM Organizes and Sets Various Model Input Scalar and Array Parameters</h1><!--introduction--><pre>  SNW_MP_PARAM sets several main default parameter structures. There are
  four types of parameters: scalar (pref, tech, prices), state space
  arrays, Transition Matrixes (Exogenous), Permanent Type (Life-cycle
  Arrays)</pre><pre>  ST_PARAM_GROUP options:</pre><pre>  * "default_base": Main
  * "default_small": Quick Testing
  * "default_tiny": Quicker Testing</pre><pre>  Pref, Technology, and prices SCALARS:</pre><pre>  * BETA discount
  * THETA total factor productivity normalizer
  * R interest rate</pre><pre>  Vectorized State Space ARRAYS:</pre><pre>  * AGRID asset grid
  * ETA_GRID productivity shock grid</pre><pre>  Transition Matrixes ARRAYS:</pre><pre>  * PI_ETA shock productivity transition
  * PI_KIDS shock kids count transition
  * PSI shock survival probability</pre><pre>  Permanent Education Type Heterogeneity ARRAYS:</pre><pre>  * EPSILON perfect-foresight education type transition
  * SS Social Security</pre><pre>  MP_PARAMS = SNW_MP_PARAM() get default parameters all in the same
  container map</pre><pre>  MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters
  for the type ST_PARAM_GROUP. ST_PARAM_GROUP groups include:
  "default_base", "default_small", etc.</pre><pre>  MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS) generates
  default parameters for the type ST_PARAM_GROUP, display parameter map
  details if BL_PRINT_MP_PARAMS is true.</pre><pre>  MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS,
  IT_ROW_N_KEEP, IT_COL_N_KEEP) Control for output matrixes how many
  rows and columns to print out.</pre><pre>  [MP_PARAMS, MP_PARAMS_PREFTECHPRICEGOV, MP_PARAMS_STATESGRID,
  MP_PARAMS_EXOTRANS, MP_PARAMS_TYPELIFE, MP_PARAMS_INTLEN] =
  SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters for the type
  ST_PARAM_GROUP, and output all parameters in one MP_PARAMS, but also
  parameters oraganized in submaps by parameter types</pre><pre>  See also SNWX_MP_PARAM</pre><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Parse Main Inputs and Set Defaults</a></li><li><a href="#3">Parametesr Grid Points</a></li><li><a href="#4">Planning and Unemployment Parameters</a></li><li><a href="#5">Preferences, Technologies, etc.</a></li><li><a href="#6">PARAM Mortality</a></li><li><a href="#7">PARAM Productivity by Education Types</a></li><li><a href="#8">PARAM Kids Transition</a></li><li><a href="#9">PARAM Specifying asset grid (use non-linear spacing with minimum value of 0)</a></li><li><a href="#10">Derive transition probabilities and stationary distribution for productivity shock</a></li><li><a href="#11">Initial conditions for marital status, college attainment, and number of kids</a></li><li><a href="#12">Population distribution</a></li><li><a href="#13">Set Parameter Maps</a></li><li><a href="#14">Combine Maps</a></li><li><a href="#15">Print</a></li><li><a href="#16">Return</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> varargout = snw_mp_param(varargin)
</pre><h2 id="2">Parse Main Inputs and Set Defaults</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(varargin))

    [it_row_n_keep, it_col_n_keep] = deal(8, 8);

    <span class="keyword">if</span> (length(varargin)==1)
        st_param_group = varargin{:};
        bl_print_mp_params = false;
    <span class="keyword">elseif</span> (length(varargin)==2)
        [st_param_group, bl_print_mp_params] = varargin{:};
    <span class="keyword">elseif</span> (length(varargin)==4)
        [st_param_group, bl_print_mp_params, it_row_n_keep, it_col_n_keep] = varargin{:};
    <span class="keyword">end</span>

<span class="keyword">else</span>

<span class="comment">%     st_param_group = 'default_base';</span>
    st_param_group = <span class="string">'default_verydense'</span>;
<span class="comment">%     st_param_group = 'default_dense';</span>
<span class="comment">%     st_param_group = 'default_tiny';</span>
    bl_print_mp_params = true;
    [it_row_n_keep, it_col_n_keep] = deal(20, 8);

<span class="keyword">end</span>
</pre><h2 id="3">Parametesr Grid Points</h2><p>Number of grid points</p><pre class="codeinput">n_educgrid=2; <span class="comment">% No. of grid points for educational attainment (college vs. non-college)</span>
n_marriedgrid=2; <span class="comment">% No. of grid points for marital status</span>
n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 5+ children)</span>
<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_verydense"</span>))
    n_jgrid  =83; <span class="comment">% Age runs from 18 to 100 (a period is 2 years)</span>
    jret     =48;
    n_agrid  =251; <span class="comment">% No. of grid points for assets</span>
    n_eta_H_grid=9; <span class="comment">% 9; % No. of grid points for persistent labor productivity shocks</span>
    n_eta_S_grid=5; <span class="comment">% 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)</span>
    n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 4+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_moredense"</span>))
    n_jgrid  =83; <span class="comment">% Age runs from 18 to 100 (a period is 2 years)</span>
    jret     =48;
    n_agrid  =151; <span class="comment">% No. of grid points for assets</span>
    n_eta_H_grid=9; <span class="comment">% 9; % No. of grid points for persistent labor productivity shocks</span>
    n_eta_S_grid=5; <span class="comment">% 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)</span>
    n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 4+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_dense"</span>))
    n_jgrid  =83; <span class="comment">% Age runs from 18 to 100 (a period is 2 years)</span>
    jret     =48;
    n_agrid  =55; <span class="comment">% No. of grid points for assets</span>
    n_eta_H_grid=7; <span class="comment">% 9; % No. of grid points for persistent labor productivity shocks</span>
    n_eta_S_grid=3; <span class="comment">% 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)</span>
    n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 4+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_base"</span>))
    n_jgrid  =42; <span class="comment">% Age runs from 18 to 100 (a period is 2 years)</span>
    jret=25;
    n_agrid  =40; <span class="comment">% No. of grid points for assets</span>
    n_eta_H_grid=5; <span class="comment">% 9; % No. of grid points for persistent labor productivity shocks</span>
    n_eta_S_grid=3; <span class="comment">% 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)</span>
    n_kidsgrid=5; <span class="comment">% No. of grid points for children (0 to 4+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_small53"</span>))
    n_jgrid   =18; <span class="comment">% Age runs from 18 to 100 (16 periods of 5 years + terminal)</span>
    jret      =13;
    n_agrid   =25;
    n_eta_H_grid=5;
    n_eta_S_grid=3;
    n_kidsgrid=3;
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_small"</span>))
    n_jgrid   =18; <span class="comment">% Age runs from 18 to 100 (16 periods of 5 years + terminal)</span>
    jret      =13;
    n_agrid   =25; <span class="comment">% No. of grid points for assets</span>
    n_eta_H_grid=5; <span class="comment">% 9; % No. of grid points for persistent labor productivity shocks</span>
    n_eta_S_grid=1; <span class="comment">% 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)</span>
    n_kidsgrid=3; <span class="comment">% No. of grid points for children (0 to 5+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_tiny53"</span>))
    n_jgrid   =7; <span class="comment">% Age runs from 18 to 100 (5 periods of 16 years + terminal)</span>
    jret =5;
    n_agrid   =10; <span class="comment">% No. of grid points for assets</span>
    n_eta_H_grid=5; <span class="comment">% 9; % No. of grid points for persistent labor productivity shocks</span>
    n_eta_S_grid=3; <span class="comment">% 3; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)</span>
    n_kidsgrid=3; <span class="comment">% No. of grid points for children (0 to 5+ children)</span>
<span class="keyword">elseif</span>(strcmp(st_param_group, <span class="string">"default_tiny"</span>))
    n_jgrid   =7; <span class="comment">% Age runs from 18 to 100 (5 periods of 16 years + terminal)</span>
    jret =5;
    n_agrid   =10; <span class="comment">% No. of grid points for assets</span>
    n_eta_H_grid=5; <span class="comment">% 9; % No. of grid points for persistent labor productivity shocks</span>
    n_eta_S_grid=1; <span class="comment">% 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)</span>
    n_kidsgrid=3; <span class="comment">% No. of grid points for children (0 to 5+ children)</span>
<span class="keyword">end</span>
n_etagrid=n_eta_H_grid*n_eta_S_grid; <span class="comment">% Length of productivity shock grid</span>

<span class="comment">% Years Per Period</span>
<span class="keyword">if</span> (n_jgrid == 83)
    it_yrs_per_period = 1;
<span class="keyword">else</span>
    it_yrs_per_period = (80/(n_jgrid-2));
<span class="keyword">end</span>
</pre><h2 id="4">Planning and Unemployment Parameters</h2><p>ADDITIONAL PARAMETERS/VARIABLES for planner problem are given in the following sections: "Compute value of employment and unemployment in 2020 conditional on number of welfare checks"; "Probability of unemployment" "Solve planner's problem" xi: Proportional reduction in income due to unemployment (xi=0 refers to 0 labor income; xi=1 refers to no drop in labor income) b: Unemployment insurance replacement rate (b=0 refers to no UI benefits; b=1 refers to 100 percent labor income replacement) TR: Value of a welfare check (can receive multiple checks). TO DO: Update with alternative values n_welfchecksgrid: Number of welfare checks. 0 refers to 0 dollars; 51 refers to 5000 dollars pi_unemp: Probability of unemployment n_incgrid: Number of income groups inc_grid: Grid for income groups</p><pre class="codeinput"><span class="comment">% omega=0.0135; % Total spending on welfare checks as a share of aggregate income (estimated to cost $290 billion, or 1.35 percent of GDP in 2019. IRS has paid out $218 billion as of May 11)</span>

xi=0.75; <span class="comment">% Proportional reduction in income due to unemployment (xi=0 refers to 0 labor income; xi=1 refers to no drop in labor income)</span>
b=1; <span class="comment">% Unemployment insurance replacement rate (b=0 refers to no UI benefits; b=1 refers to 100 percent labor income replacement)</span>
TR=100/58056; <span class="comment">% Value of a welfare check (can receive multiple checks). TO DO: Update with alternative values</span>
n_welfchecksgrid=51; <span class="comment">% Number of welfare checks. 0 refers to 0 dollars; 51 refers to 5000 dollars</span>

<span class="comment">% Probability of unemployment</span>
<span class="comment">% pi_j=[0.22;0.175;0.16;0.165;0.22]; % Probability of unemployment in 2020 by age groups from Cajner et al. (2020, NBER)</span>
<span class="comment">% pi_w=[0.360;0.22;0.17;0.14;0.09]; % Probability of unemployment in 2020 by wage quintiles from Cajner et al. (2020, NBER)</span>

<span class="comment">% Columns are wage groups; rows are age groups.</span>
pi_unemp=zeros(n_jgrid,5);
aux_mat=[0.08027790 0.05170647 0.04150239 0.03537994 0.02517586];
pi_unemp(1:13,:)=repmat(aux_mat,13,1);
aux_mat=[0.07070343 0.04213200 0.03192792 0.02580547 0.01560139];
pi_unemp(14:23,:)=repmat(aux_mat,10,1);
aux_mat=[0.06751194 0.03894051 0.02873643 0.02261398 0.01240990];
pi_unemp(24:33,:)=repmat(aux_mat,10,1);
aux_mat=[0.06857577 0.04000434 0.02980026 0.02367781 0.01347373];
pi_unemp(34:43,:)=repmat(aux_mat,10,1);
aux_mat=[0.08027790 0.05170647 0.04150239 0.03537994 0.02517586];
pi_unemp(44:48,:)=repmat(aux_mat,5,1);

clear <span class="string">aux_mat</span>

<span class="comment">% Solve planner's problem</span>
n_incgrid=201; <span class="comment">% Number of income groups</span>
inc_grid=linspace(0,7,n_incgrid)'; <span class="comment">% 7 refers to 7*58056=406392 dollars in 2012USD</span>
</pre><h2 id="5">Preferences, Technologies, etc.</h2><pre class="codeinput"><span class="comment">% Non-calibrated parameters</span>
gamma=2; <span class="comment">% Risk aversion parameter</span>
<span class="keyword">if</span>(contains(st_param_group, <span class="string">"dense"</span>))
    rho_eta=0.98; <span class="comment">% Persistence of AR(1) productivity shocks</span>
    sigma_eta=0.018; <span class="comment">% Variance of AR(1) productivity shocks</span>
    g_n=0.01; <span class="comment">% Annual population growth of 1.1 percent</span>
    r=0.04; <span class="comment">% Annual real interest rate of 4.0 percent from McGrattan and Prescott</span>
    beta=0.969010845568155; <span class="comment">% 0.97068903873305; % Discount factor</span>
<span class="keyword">else</span>
    rho_eta=0.98^it_yrs_per_period;
    sigma_eta=sqrt(0.018^2*sum((0.98.^(0:(it_yrs_per_period-1))).^2));
    g_n=(1.01^it_yrs_per_period)-1;
    r=(1.04^it_yrs_per_period)-1;
    beta=0.969010845568155^it_yrs_per_period;
<span class="keyword">end</span>

<span class="comment">% Spousal Shocks</span>
rho_eta_spouse=0; <span class="comment">% Persistence of spousal AR(1) productivity shocks</span>
sigma_eta_spouse=1.040654^2; <span class="comment">% Variance of spousal AR(1) productivity shocks (standard deviation of residual from spousal income regression for 18-65 year-old household heads. See spousal_income.m for regression specification details)</span>

<span class="comment">% Bequest</span>
<span class="comment">% Bequests allocation rule (=1: accidental bequests go to the government; =2: accidental bequests uniformly across the population)</span>
<span class="comment">% Bequests=Bequests_aux/((1+g_n)*sum(sum(sum(sum(sum(sum(Phi_true(:,:,:,:,:,:))))))));</span>
bequests_option=1;
Bequests=0.05826*(bequests_option-1);
throw_in_ocean=1; <span class="comment">% If bequests go to the government, a value of 1 for throw_in_ocean means that all accidental bequests are "thrown in the ocean", whereas a value of 0 means the full amount goes to the government</span>

<span class="keyword">if</span> bequests_option==2
    a2=1.575;
<span class="keyword">elseif</span> bequests_option==1
    <span class="keyword">if</span> throw_in_ocean==0
        a2=0.7027;
    <span class="keyword">elseif</span> throw_in_ocean==1
        a2=1.6081061107858;
    <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="comment">% Government budget constraint parameters</span>
g_cons=0.17575574; <span class="comment">% Government consumption expenditures to GDP (BEA: Average 2015-2019)</span>

<span class="comment">% Calibrated parameters</span>
theta=0.66947637485374; <span class="comment">% TFP parameter to normalize units such that average household income relative to GDP per capita is consistent with the data (the latter is normalized to 1): Real GDP/capita in 2019: $58,056</span>

<span class="comment">% Consumption allocation rule (1=uniform; 2=square root)</span>
cons_allocation_rule=2;

<span class="comment">% Social Security benefits</span>
SS=zeros(n_jgrid,2);
SS(jret:end,1)=0.24433; <span class="comment">% Average SS non-college 2005-2009 as a share of GDP per capita</span>
SS(jret:end,2)=0.29263; <span class="comment">% Average SS college 2005-2009 as a share of GDP per capita</span>
</pre><h2 id="6">PARAM Mortality</h2><p>Assume MORT_PROB will have 80 rows. Average based on Resulting Dataframes</p><pre class="codeinput">load(<span class="string">'Mortality_prob_by_age_18_99.mat'</span>,<span class="string">'mort_prob'</span>)
psi_full=1-mort_prob;
psi_full=[psi_full;0]; <span class="comment">% Maximum lifespan=100 (survival probability at age 100=0)</span>

<span class="keyword">if</span>(contains(st_param_group, <span class="string">"dense"</span>))
    psi = psi_full;
<span class="keyword">else</span>
    psi = NaN(n_jgrid,1);
    psi(1) = mean(1-mort_prob(1:2));
    psi(2:(end-1)) = prod(reshape(1-mort_prob(3:end), it_yrs_per_period, []), 1)';
    psi(end) = 0;
<span class="keyword">end</span>

clear <span class="string">mort_prob</span> <span class="string">psi_full</span>
</pre><h2 id="7">PARAM Productivity by Education Types</h2><p>Generate epsilon matrix A1. load external</p><pre class="codeinput">load(<span class="string">'Life_cycle_prod_by_educ.mat'</span>,<span class="string">'life_cycle_prod_by_educ'</span>) <span class="comment">% Life-cycle labor productivity for 20-100 year-olds by education (non-college vs. college)</span>
<span class="comment">% Set Annual</span>
epsilon_full=NaN(83,2);
epsilon_full(3:end,:)=life_cycle_prod_by_educ(:,:);

epsilon_full(1,:)=epsilon_full(3,:); <span class="comment">% Let life-cycle labor productivity of 18- and 19-year-olds be the same as that for 20-year-olds</span>
epsilon_full(2,:)=epsilon_full(3,:);

<span class="keyword">if</span>(contains(st_param_group, <span class="string">"dense"</span>))
    epsilon = epsilon_full;
<span class="keyword">else</span>
    epsilon=NaN(n_jgrid,2);
    epsilon(1,:) = epsilon_full(3,:);
    <span class="keyword">for</span> e=1:2
        epsilon(2:end-1,e) = mean(reshape(life_cycle_prod_by_educ(1:80, e), it_yrs_per_period, (n_jgrid-2)))';
    <span class="keyword">end</span>
<span class="keyword">end</span>

epsilon(jret:end,:)=0; <span class="comment">% Assume zero labor productivity for 65+ year-olds (exogenous retirement)</span>

clear <span class="string">life_cycle_prod_by_educ</span> <span class="string">epsilon_aux</span>
</pre><h2 id="8">PARAM Kids Transition</h2><p>Transition probabilities for number of children (0, 1, 2, 3, 4, or 5) (stored in the following order: Number of children in year 1, age, marital status, college attainment. Each column refers to the number of children in year 2)</p><p>PI_KIDS_TRANS_PROB has 6*2*41 = 492 rows. It is assuming strcmp(st_param_group, "default_base"). For tiny and small grid, select appropriate subset of rows to match appropriate age groups from PI_KIDS.</p><p>pi_kids_trans_prob estimation might change in the future if there are more age groups added. To make sure this code here works, use N_JGRID_PKTP as the N_JGRID count for PI_KIDS_TRANS_PROB. But assume there will always be up to 6 kids, and 2 marriage/notmarry groups.</p><pre class="codeinput">load(<span class="string">'pi_kids_trans_prob'</span>,<span class="string">'pi_kids_trans_prob'</span>)
n_kidsgrid_kptp = 5;
n_educgrid_kptp = 2;
n_marriedgrid_kptp = 2;
n_jgrid_pktp = 83;
pi_kids_pktp =NaN(<span class="keyword">...</span>
    n_kidsgrid_kptp,<span class="keyword">...</span>
    n_kidsgrid_kptp,<span class="keyword">...</span>
    n_jgrid_pktp,<span class="keyword">...</span>
    n_educgrid_kptp,<span class="keyword">...</span>
    n_marriedgrid_kptp);

<span class="keyword">for</span> kidsp=1:n_kidsgrid_kptp <span class="comment">% No. of kids in year 2</span>
    counter=0;
    <span class="keyword">for</span> kids=1:n_kidsgrid_kptp <span class="comment">% No. of kids in year 1</span>
        <span class="keyword">for</span> j=1:(n_jgrid_pktp-1) <span class="comment">% Age in year 1</span>
            <span class="keyword">for</span> married=1:n_marriedgrid_kptp <span class="comment">% Marital status</span>
                <span class="keyword">for</span> educ=1:n_educgrid_kptp <span class="comment">% Educational level</span>
                    counter=counter+1;
                    pi_kids_pktp(kids,kidsp,j,educ,married)=pi_kids_trans_prob(counter,kidsp);
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

pi_kids_pktp(:,:,n_jgrid_pktp,:,:)=0;
pi_kids_pktp(:,1,n_jgrid_pktp,:,:)=1;

<span class="comment">% Subset Selection</span>
<span class="keyword">if</span>(contains(st_param_group, <span class="string">"dense"</span>))
    pi_kids = pi_kids_pktp;
<span class="keyword">else</span>
    pi_kids = pi_kids_pktp(<span class="keyword">...</span>
        1:n_kidsgrid, <span class="keyword">...</span>
        1:n_kidsgrid, <span class="keyword">...</span>
        round(linspace(1, n_jgrid_pktp, n_jgrid)), <span class="keyword">...</span>
        :, : <span class="keyword">...</span>
        );
<span class="keyword">end</span>

<span class="comment">% Ensure that all rows sum to 1 in case of rounding error</span>
<span class="keyword">for</span> kids=1:n_kidsgrid <span class="comment">% No. of kids in year 1</span>
    <span class="keyword">for</span> j=1:n_jgrid <span class="comment">% Age in year 1</span>
        <span class="keyword">for</span> educ=1:n_educgrid <span class="comment">% Educational level</span>
            <span class="keyword">for</span> married=1:n_marriedgrid <span class="comment">% Marital status</span>
                aux_sum=sum(pi_kids(kids,:,j,educ,married));
                pi_kids(kids,:,j,educ,married)=pi_kids(kids,:,j,educ,married)/aux_sum;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">%</span>
clear <span class="string">aux_sum</span> <span class="string">counter</span> <span class="string">pi_kids_trans_prob</span> <span class="string">pi_kids_pktp</span>
</pre><h2 id="9">PARAM Specifying asset grid (use non-linear spacing with minimum value of 0)</h2><pre class="codeinput">curv=3; <span class="comment">% Governs how the grid points are allocated</span>
scale_a=190; <span class="comment">% Maximum value of assets (NOTE: Verifying that it does not bind in Aggregation.m) grid=1.2451e-11</span>
scale_a=135; <span class="comment">% Maximum value of assets (NOTE: Verifying that it does not bind in Aggregation.m) grid=0</span>


agrid=zeros(n_agrid,1);

<span class="keyword">for</span> i=2:n_agrid
	agrid(i)=scale_a*((i-1)/(n_agrid-1))^curv;
<span class="keyword">end</span>
</pre><h2 id="10">Derive transition probabilities and stationary distribution for productivity shock</h2><p>Discretize process for persistent productivity shocks and derive stationary distribution</p><pre class="codeinput">[eta_H_grid_aux,pi_H_eta]=rouwenhorst(rho_eta,sqrt(sigma_eta),n_eta_H_grid);
[eta_S_grid_aux,pi_S_eta]=rouwenhorst(rho_eta_spouse,sqrt(sigma_eta_spouse),n_eta_S_grid);

pi_eta=NaN(n_etagrid,n_etagrid);
counter=0;
<span class="keyword">for</span> eta_S=1:n_eta_S_grid
    <span class="keyword">for</span> eta_H=1:n_eta_H_grid
        counter=counter+1;

        counterp=0;
        <span class="keyword">for</span> eta_Sp=1:n_eta_S_grid
            <span class="keyword">for</span> eta_Hp=1:n_eta_H_grid
                counterp=counterp+1;
                pi_eta(counter,counterp)=pi_H_eta(eta_H,eta_Hp)*pi_S_eta(eta_S,eta_Sp);
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

eta_H_grid=repmat(eta_H_grid_aux,n_eta_S_grid,1);
eta_S_grid=sort(repmat(eta_S_grid_aux,n_eta_H_grid,1));

stat_distr_eta=NaN(1,n_etagrid);

x0=(1/n_etagrid)*ones(1,n_etagrid);

err=1;
tol=10^-12;

<span class="keyword">while</span> err&gt;tol
    x1=x0*pi_eta(:,:);
    err=max(abs(x1-x0));
    <span class="keyword">if</span> err&gt;tol
       x0=x1;
    <span class="keyword">end</span>
<span class="keyword">end</span>

stat_distr_eta(1,:)=x0;

clear <span class="string">counter</span> <span class="string">counterp</span> <span class="string">eta_H_grid_aux</span> <span class="string">eta_S_grid_aux</span>
</pre><h2 id="11">Initial conditions for marital status, college attainment, and number of kids</h2><p>Distribution of educational attainment from PSID tab Rcollege if RAGE&gt;=18 &amp; RAGE!=. [aweight=WEIGHT]</p><pre class="codeinput">stat_distr_educ(1,1)=0.6970; <span class="comment">% No college</span>
stat_distr_educ(1,2)=0.3030; <span class="comment">% College</span>

<span class="comment">% Distribution of marital status conditional on college attainment from PSID</span>
<span class="comment">% tab  Rmarried if RAGE&gt;=18 &amp; RAGE!=. &amp; Rcollege==0 [aweight=WEIGHT]</span>
stat_distr_married(1,1)=0.5635; <span class="comment">% Not married</span>
stat_distr_married(1,2)=0.4365; <span class="comment">% Married</span>

<span class="comment">% tab  Rmarried if RAGE&gt;=18 &amp; RAGE!=. &amp; Rcollege==1 [aweight=WEIGHT]</span>
stat_distr_married(2,1)=0.4364; <span class="comment">% Not married</span>
stat_distr_married(2,2)=0.5636; <span class="comment">% Married</span>

<span class="comment">% Stationary distribution of children at age 20 from PSID</span>
<span class="comment">% Not married and no college</span>
<span class="comment">% tab kids if Rmarried==0 &amp; Rcollege==0 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(1,1,1)=0.7333;
stat_distr_kids_kn5(1,1,2)=0.1513;
stat_distr_kids_kn5(1,1,3)=0.0828;
stat_distr_kids_kn5(1,1,4)=0.0236;
stat_distr_kids_kn5(1,1,5)=0.0059;

<span class="comment">% Not married but college-educated</span>
<span class="comment">% tab kids if Rmarried==0 &amp; Rcollege==1 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(2,1,1)=0.9752;
stat_distr_kids_kn5(2,1,2)=0.0236;
stat_distr_kids_kn5(2,1,3)=0.0001;
stat_distr_kids_kn5(2,1,4)=0.0011;
stat_distr_kids_kn5(2,1,5)=0;

<span class="comment">% Married and no college</span>
<span class="comment">% tab kids if Rmarried==1 &amp; Rcollege==0 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(1,2,1)=0.4143;
stat_distr_kids_kn5(1,2,2)=0.2958;
stat_distr_kids_kn5(1,2,3)=0.2131;
stat_distr_kids_kn5(1,2,4)=0.0569;
stat_distr_kids_kn5(1,2,5)=0.0199;

<span class="comment">% Married and college-educated</span>
<span class="comment">% tab kids if Rmarried==1 &amp; Rcollege==1 &amp; inrange(RAGE,18,25) [aweight=WEIGHT]</span>
stat_distr_kids_kn5(2,2,1)=0.7534;
stat_distr_kids_kn5(2,2,2)=0.2153;
stat_distr_kids_kn5(2,2,3)=0.0221;
stat_distr_kids_kn5(2,2,4)=0.0091;
stat_distr_kids_kn5(2,2,5)=0;

<span class="comment">% Subset Kids for Smaller Solutions</span>
<span class="keyword">if</span>(strcmp(st_param_group, <span class="string">"default_base"</span>))
    stat_distr_kids = stat_distr_kids_kn5;
<span class="keyword">else</span>
    stat_distr_kids = stat_distr_kids_kn5(:,:,1:n_kidsgrid);
<span class="keyword">end</span>

<span class="comment">% Reweight</span>
bl_sum_onebyone = true;
<span class="keyword">if</span> (bl_sum_onebyone)
    aux=sum(stat_distr_kids(1,1,:));
    stat_distr_kids(1,1,:)=stat_distr_kids(1,1,:)/aux;
    aux=sum(stat_distr_kids(2,1,:));
    stat_distr_kids(2,1,:)=stat_distr_kids(2,1,:)/aux;
    aux=sum(stat_distr_kids(1,2,:));
    stat_distr_kids(1,2,:)=stat_distr_kids(1,2,:)/aux;
    aux=sum(stat_distr_kids(2,2,:));
    stat_distr_kids(2,2,:)=stat_distr_kids(2,2,:)/aux;
<span class="keyword">else</span>
    mt_aux = repmat(sum(stat_distr_kids, 3), <span class="keyword">...</span>
        [1,1,size(stat_distr_kids,3)]);
    stat_distr_kids(2,2,:)=stat_distr_kids./mt_aux;
<span class="keyword">end</span>

clear <span class="string">aux</span>
</pre><h2 id="12">Population distribution</h2><p>Normalize mass of 18-year-olds to 1</p><pre class="codeinput">Pop=zeros(n_jgrid,1);
Pop(1)=1;
<span class="keyword">for</span> j=2:n_jgrid
    Pop(j)=Pop(j-1)*psi(j-1)/(1+g_n);
<span class="keyword">end</span>

name=<span class="string">'Old-age dependency ratio (ratio of 65+/(18-64))='</span>;
st_old_age_depend =[name,num2str(sum(Pop(jret:end))/sum(Pop(1:(jret-1))))];
<span class="comment">% disp(st_old_age_depend);</span>
</pre><h2 id="13">Set Parameter Maps</h2><pre class="codeinput">mp_params_covid_unemploy = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_covid_unemploy(<span class="string">'xi'</span>) = xi;
mp_params_covid_unemploy(<span class="string">'b'</span>) = b;
mp_params_covid_unemploy(<span class="string">'TR'</span>) = TR;
mp_params_covid_unemploy(<span class="string">'n_welfchecksgrid'</span>) = n_welfchecksgrid;
mp_params_covid_unemploy(<span class="string">'pi_unemp'</span>) = pi_unemp;
mp_params_covid_unemploy(<span class="string">'n_incgrid'</span>) = n_incgrid;
mp_params_covid_unemploy(<span class="string">'inc_grid'</span>) = inc_grid;

mp_params_preftechpricegov = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_preftechpricegov(<span class="string">'gamma'</span>) = gamma;
mp_params_preftechpricegov(<span class="string">'beta'</span>) = beta;
mp_params_preftechpricegov(<span class="string">'theta'</span>) = theta;
mp_params_preftechpricegov(<span class="string">'cons_allocation_rule'</span>) = cons_allocation_rule;
mp_params_preftechpricegov(<span class="string">'r'</span>) = r;
mp_params_preftechpricegov(<span class="string">'g_n'</span>) = g_n;
mp_params_preftechpricegov(<span class="string">'g_cons'</span>) = g_cons;
mp_params_preftechpricegov(<span class="string">'a2'</span>) = a2;
mp_params_preftechpricegov(<span class="string">'jret'</span>) = jret;
mp_params_preftechpricegov(<span class="string">'Bequests'</span>) = Bequests;
mp_params_preftechpricegov(<span class="string">'bequests_option'</span>) = bequests_option;
mp_params_preftechpricegov(<span class="string">'throw_in_ocean'</span>) = throw_in_ocean;

mp_params_statesgrid = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_statesgrid(<span class="string">'agrid'</span>) = agrid;
mp_params_statesgrid(<span class="string">'eta_H_grid'</span>) = eta_H_grid;
mp_params_statesgrid(<span class="string">'eta_S_grid'</span>) = eta_S_grid;

mp_params_exotrans = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_exotrans(<span class="string">'pi_eta'</span>) = pi_eta;
mp_params_exotrans(<span class="string">'pi_H_eta'</span>) = pi_H_eta;
mp_params_exotrans(<span class="string">'pi_S_eta'</span>) = pi_S_eta;
mp_params_exotrans(<span class="string">'pi_kids'</span>) = pi_kids;
mp_params_exotrans(<span class="string">'psi'</span>) = psi;

mp_params_typelife = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_typelife(<span class="string">'epsilon'</span>) = epsilon;
mp_params_typelife(<span class="string">'SS'</span>) = SS;

mp_params_intlen = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_intlen(<span class="string">'n_jgrid'</span>) = n_jgrid;
mp_params_intlen(<span class="string">'n_agrid'</span>) = n_agrid;
mp_params_intlen(<span class="string">'n_etagrid'</span>) = n_etagrid;
mp_params_intlen(<span class="string">'n_eta_S_grid'</span>) = n_eta_S_grid;
mp_params_intlen(<span class="string">'n_eta_H_grid'</span>) = n_eta_H_grid;
mp_params_intlen(<span class="string">'n_educgrid'</span>) = n_educgrid;
mp_params_intlen(<span class="string">'n_marriedgrid'</span>) = n_marriedgrid;
mp_params_intlen(<span class="string">'n_kidsgrid'</span>) = n_kidsgrid;

mp_params_stat = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
mp_params_stat(<span class="string">'stat_distr_eta'</span>) = stat_distr_eta;
mp_params_stat(<span class="string">'stat_distr_educ'</span>) = stat_distr_educ;
mp_params_stat(<span class="string">'stat_distr_married'</span>) = stat_distr_married;
mp_params_stat(<span class="string">'stat_distr_kids'</span>) = stat_distr_kids;
mp_params_stat(<span class="string">'Pop'</span>) = Pop;
mp_params_stat(<span class="string">'st_old_age_depend'</span>) = string(st_old_age_depend);
</pre><h2 id="14">Combine Maps</h2><pre class="codeinput">mp_params = [<span class="keyword">...</span>
    mp_params_covid_unemploy; <span class="keyword">...</span>
    mp_params_preftechpricegov; <span class="keyword">...</span>
    mp_params_statesgrid ; <span class="keyword">...</span>
    mp_params_exotrans; <span class="keyword">...</span>
    mp_params_typelife; <span class="keyword">...</span>
    mp_params_intlen ; <span class="keyword">...</span>
    mp_params_stat];

mp_params(<span class="string">'mp_params_name'</span>) = string(st_param_group);

<span class="comment">% MP_PARAMS = [MP_PARAMS_PREFTECHPRICE; MP_PARAMS_STATESGRID ; ...</span>
<span class="comment">%     MP_PARAMS_EXOTRANS; MP_PARAMS_TYPELIFE; MP_PARAMS_INTLEN];</span>
</pre><h2 id="15">Print</h2><pre class="codeinput"><span class="keyword">if</span> (bl_print_mp_params)
    ff_container_map_display(mp_params_covid_unemploy);
    ff_container_map_display(mp_params_preftechpricegov);
    ff_container_map_display(mp_params_intlen);
    ff_container_map_display(mp_params_statesgrid, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_exotrans, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_typelife, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_stat, it_row_n_keep, it_col_n_keep);
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_covid_unemploy ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                i    idx    ndim    numel    rowN    colN     sum        mean        std       coefvari    min      max   
                _    ___    ____    _____    ____    ____    ______    ________    ________    ________    ___    ________

    inc_grid    1     3      2       201     201      1       703.5         3.5      2.0359    0.58168      0            7
    pi_unemp    2     6      2       415      83      5      9.5319    0.022968    0.024679     1.0745      0     0.080278

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_covid_unemploy Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                        i    idx      value  
                        _    ___    _________

    TR                  1     1     0.0017225
    b                   2     2             1
    n_incgrid           3     4           201
    n_welfchecksgrid    4     5            51
    xi                  5     7          0.75

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_preftechpricegov Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                            i     idx     value 
                            __    ___    _______

    Bequests                 1     1           0
    a2                       2     2      1.6081
    bequests_option          3     3           1
    beta                     4     4     0.96901
    cons_allocation_rule     5     5           2
    g_cons                   6     6     0.17576
    g_n                      7     7        0.01
    gamma                    8     8           2
    jret                     9     9          48
    r                       10    10        0.04
    theta                   11    11     0.66948
    throw_in_ocean          12    12           1

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_intlen Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                     i    idx    value
                     _    ___    _____

    n_agrid          1     1      251 
    n_educgrid       2     2        2 
    n_eta_H_grid     3     3        9 
    n_eta_S_grid     4     4        5 
    n_etagrid        5     5       45 
    n_jgrid          6     6       83 
    n_kidsgrid       7     7        5 
    n_marriedgrid    8     8        2 

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_statesgrid ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                  i    idx    ndim    numel    rowN    colN        sum           mean         std       coefvari        min       max  
                  _    ___    ____    _____    ____    ____    ___________    ___________    ______    ___________    _______    ______

    agrid         1     1      2       251     251      1           8505.1         33.885    38.567         1.1382          0       135
    eta_H_grid    2     2      2        45      45      1      -2.2204e-16    -4.9343e-18    1.2448    -2.5228e+17    -1.9069    1.9069
    eta_S_grid    3     3      2        45      45      1                0              0    1.4883            Inf    -2.0813    2.0813

xxx TABLE:agrid xxxxxxxxxxxxxxxxxx
                c1    
            __________

    r1               0
    r2        8.64e-06
    r3       6.912e-05
    r4      0.00023328
    r5      0.00055296
    r6         0.00108
    r7       0.0018662
    r8       0.0029635
    r9       0.0044237
    r10      0.0062986
    r242        120.94
    r243        122.45
    r244        123.97
    r245        125.51
    r246        127.06
    r247        128.62
    r248         130.2
    r249        131.79
    r250        133.39
    r251           135

xxx TABLE:eta_H_grid xxxxxxxxxxxxxxxxxx
              c1   
           ________

    r1      -1.9069
    r2      -1.4302
    r3     -0.95346
    r4     -0.47673
    r5            0
    r6      0.47673
    r7      0.95346
    r8       1.4302
    r9       1.9069
    r10     -1.9069
    r36      1.9069
    r37     -1.9069
    r38     -1.4302
    r39    -0.95346
    r40    -0.47673
    r41           0
    r42     0.47673
    r43     0.95346
    r44      1.4302
    r45      1.9069

xxx TABLE:eta_S_grid xxxxxxxxxxxxxxxxxx
             c1   
           _______

    r1     -2.0813
    r2     -2.0813
    r3     -2.0813
    r4     -2.0813
    r5     -2.0813
    r6     -2.0813
    r7     -2.0813
    r8     -2.0813
    r9     -2.0813
    r10    -1.0407
    r36     1.0407
    r37     2.0813
    r38     2.0813
    r39     2.0813
    r40     2.0813
    r41     2.0813
    r42     2.0813
    r43     2.0813
    r44     2.0813
    r45     2.0813

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_exotrans ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                i    idx    ndim    numel    rowN    colN     sum       mean        std       coefvari      min         max  
                _    ___    ____    _____    ____    ____    _____    ________    ________    ________    ________    _______

    pi_H_eta    1     1      2        81       9        9        9     0.11111     0.28968     2.6071        1e-16    0.92425
    pi_S_eta    2     2      2        25       5        5        5         0.2     0.12369    0.61846       0.0625      0.375
    pi_eta      3     3      2      2025      45       45       45    0.022222    0.068674     3.0903     6.25e-18    0.34659
    pi_kids     4     4      5      8300       5     1660     1660         0.2      0.2988      1.494            0          1
    psi         5     5      2        83      83        1    78.16     0.94169      0.1312    0.13932            0    0.99937

xxx TABLE:pi_H_eta xxxxxxxxxxxxxxxxxx
              c1            c2            c3            c4            c6            c7            c8            c9    
          __________    __________    __________    __________    __________    __________    __________    __________

    r1       0.92274      0.074565     0.0026361    5.3255e-05    5.4337e-09    2.7443e-11      7.92e-14         1e-16
    r2     0.0093207        0.9234      0.065265     0.0019774    3.3623e-07    2.0377e-09    6.8608e-12       9.9e-15
    r3    9.4148e-05      0.018647       0.92387      0.055952    1.9023e-05     1.441e-07     5.822e-10     9.801e-13
    r4    9.5099e-07    0.00028249      0.027976       0.92416    0.00094177    9.5114e-06    4.8033e-08     9.703e-11
    r5     9.606e-09    3.8043e-06    0.00056504      0.037305      0.037305    0.00056504    3.8043e-06     9.606e-09
    r6     9.703e-11    4.8033e-08    9.5114e-06    0.00094177       0.92416      0.027976    0.00028249    9.5099e-07
    r7     9.801e-13     5.822e-10     1.441e-07    1.9023e-05      0.055952       0.92387      0.018647    9.4148e-05
    r8       9.9e-15    6.8608e-12    2.0377e-09    3.3623e-07     0.0019774      0.065265        0.9234     0.0093207
    r9         1e-16      7.92e-14    2.7443e-11    5.4337e-09    5.3255e-05     0.0026361      0.074565       0.92274

xxx TABLE:pi_S_eta xxxxxxxxxxxxxxxxxx
            c1       c2      c3       c4       c5  
          ______    ____    _____    ____    ______

    r1    0.0625    0.25    0.375    0.25    0.0625
    r2    0.0625    0.25    0.375    0.25    0.0625
    r3    0.0625    0.25    0.375    0.25    0.0625
    r4    0.0625    0.25    0.375    0.25    0.0625
    r5    0.0625    0.25    0.375    0.25    0.0625

xxx TABLE:pi_eta xxxxxxxxxxxxxxxxxx
               c1            c2            c3            c4           c42           c43           c44           c45    
           __________    __________    __________    __________    __________    __________    __________    __________

    r1       0.057672     0.0046603    0.00016476    3.3285e-06     3.396e-10    1.7152e-12      4.95e-15      6.25e-18
    r2     0.00058254      0.057713      0.004079    0.00012359    2.1014e-08    1.2736e-10     4.288e-13    6.1875e-16
    r3     5.8843e-06     0.0011654      0.057742      0.003497    1.1889e-06    9.0063e-09    3.6387e-11    6.1256e-14
    r4     5.9437e-08    1.7656e-05     0.0017485       0.05776    5.8861e-05    5.9446e-07     3.002e-09    6.0644e-12
    r5     6.0037e-10    2.3777e-07    3.5315e-05     0.0023316     0.0023316    3.5315e-05    2.3777e-07    6.0037e-10
    r6     6.0644e-12     3.002e-09    5.9446e-07    5.8861e-05       0.05776     0.0017485    1.7656e-05    5.9437e-08
    r7     6.1256e-14    3.6387e-11    9.0063e-09    1.1889e-06      0.003497      0.057742     0.0011654    5.8843e-06
    r8     6.1875e-16     4.288e-13    1.2736e-10    2.1014e-08    0.00012359      0.004079      0.057713    0.00058254
    r9       6.25e-18      4.95e-15    1.7152e-12     3.396e-10    3.3285e-06    0.00016476     0.0046603      0.057672
    r10      0.057672     0.0046603    0.00016476    3.3285e-06     3.396e-10    1.7152e-12      4.95e-15      6.25e-18
    r36      6.25e-18      4.95e-15    1.7152e-12     3.396e-10    3.3285e-06    0.00016476     0.0046603      0.057672
    r37      0.057672     0.0046603    0.00016476    3.3285e-06     3.396e-10    1.7152e-12      4.95e-15      6.25e-18
    r38    0.00058254      0.057713      0.004079    0.00012359    2.1014e-08    1.2736e-10     4.288e-13    6.1875e-16
    r39    5.8843e-06     0.0011654      0.057742      0.003497    1.1889e-06    9.0063e-09    3.6387e-11    6.1256e-14
    r40    5.9437e-08    1.7656e-05     0.0017485       0.05776    5.8861e-05    5.9446e-07     3.002e-09    6.0644e-12
    r41    6.0037e-10    2.3777e-07    3.5315e-05     0.0023316     0.0023316    3.5315e-05    2.3777e-07    6.0037e-10
    r42    6.0644e-12     3.002e-09    5.9446e-07    5.8861e-05       0.05776     0.0017485    1.7656e-05    5.9437e-08
    r43    6.1256e-14    3.6387e-11    9.0063e-09    1.1889e-06      0.003497      0.057742     0.0011654    5.8843e-06
    r44    6.1875e-16     4.288e-13    1.2736e-10    2.1014e-08    0.00012359      0.004079      0.057713    0.00058254
    r45      6.25e-18      4.95e-15    1.7152e-12     3.396e-10    3.3285e-06    0.00016476     0.0046603      0.057672

xxx TABLE:pi_kids xxxxxxxxxxxxxxxxxx
              c1            c2            c3            c4        c1657    c1658    c1659    c1660
          __________    __________    __________    __________    _____    _____    _____    _____

    r1       0.88581       0.11137     0.0027904    3.0206e-05      0        0        0        0  
    r2      0.051118       0.65943       0.28506     0.0043303      0        0        0        0  
    r3     0.0012655       0.05332       0.78763       0.15538      0        0        0        0  
    r4     1.808e-05    0.00080512      0.069952       0.78474      0        0        0        0  
    r5    1.8185e-07    8.1047e-06    0.00075722      0.055444      0        0        0        0  

xxx TABLE:psi xxxxxxxxxxxxxxxxxx
             c1   
           _______

    r1     0.99937
    r2     0.99933
    r3     0.99929
    r4     0.99925
    r5     0.99923
    r6     0.99923
    r7     0.99924
    r8     0.99927
    r9     0.99928
    r10    0.99929
    r74    0.82817
    r75    0.81104
    r76    0.79282
    r77    0.77349
    r78    0.75398
    r79     0.7345
    r80    0.71587
    r81    0.69772
    r82    0.68139
    r83          0

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_typelife ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
               i    idx    ndim    numel    rowN    colN     sum       mean        std      coefvari    min      max  
               _    ___    ____    _____    ____    ____    ______    _______    _______    ________    ___    _______

    SS         1     1      2       166      83      2      19.331    0.11645    0.13441     1.1542      0     0.29263
    epsilon    2     2      2       166      83      2      159.11    0.95847    0.89457    0.93333      0      2.2612

xxx TABLE:SS xxxxxxxxxxxxxxxxxx
             c1         c2   
           _______    _______

    r1           0          0
    r2           0          0
    r3           0          0
    r4           0          0
    r5           0          0
    r6           0          0
    r7           0          0
    r8           0          0
    r9           0          0
    r10          0          0
    r74    0.24433    0.29263
    r75    0.24433    0.29263
    r76    0.24433    0.29263
    r77    0.24433    0.29263
    r78    0.24433    0.29263
    r79    0.24433    0.29263
    r80    0.24433    0.29263
    r81    0.24433    0.29263
    r82    0.24433    0.29263
    r83    0.24433    0.29263

xxx TABLE:epsilon xxxxxxxxxxxxxxxxxx
             c1        c2  
           ______    ______

    r1          1         1
    r2          1         1
    r3          1         1
    r4     1.0399    1.0923
    r5     1.0788    1.1845
    r6     1.1167    1.2759
    r7     1.1534    1.3655
    r8     1.1889    1.4525
    r9     1.2231    1.5365
    r10     1.256    1.6166
    r74         0         0
    r75         0         0
    r76         0         0
    r77         0         0
    r78         0         0
    r79         0         0
    r80         0         0
    r81         0         0
    r82         0         0
    r83         0         0

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_stat ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                          i    idx    ndim    numel    rowN    colN     sum        mean        std       coefvari       min          max  
                          _    ___    ____    _____    ____    ____    ______    ________    ________    ________    __________    _______

    Pop                   1     1      2       83       83       1     45.793     0.55172      0.3014    0.54629      0.0062787          1
    stat_distr_educ       2     3      2        2        1       2          1         0.5      0.2786     0.5572          0.303      0.697
    stat_distr_eta        3     4      2       45        1      45          1    0.022222    0.026746     1.2036     0.00024414    0.10254
    stat_distr_kids       4     5      3       20        2      10          4         0.2     0.29433     1.4717              0     0.9752
    stat_distr_married    5     6      2        4        2       2          2         0.5    0.073381    0.14676         0.4364     0.5636

xxx TABLE:Pop xxxxxxxxxxxxxxxxxx
              c1    
           _________

    r1             1
    r2       0.98947
    r3       0.97902
    r4       0.96864
    r5       0.95832
    r6        0.9481
    r7       0.93799
    r8         0.928
    r9       0.91813
    r10      0.90839
    r74     0.088453
    r75     0.072529
    r76     0.058241
    r77     0.045718
    r78     0.035012
    r79     0.026137
    r80     0.019007
    r81     0.013472
    r82    0.0093067
    r83    0.0062787

xxx TABLE:stat_distr_educ xxxxxxxxxxxxxxxxxx
           c1       c2  
          _____    _____

    r1    0.697    0.303

xxx TABLE:stat_distr_eta xxxxxxxxxxxxxxxxxx
              c1           c2           c3           c4         c42          c43          c44          c45    
          __________    _________    _________    ________    ________    _________    _________    __________

    r1    0.00024414    0.0019531    0.0068359    0.013672    0.013672    0.0068359    0.0019531    0.00024414

xxx TABLE:stat_distr_kids xxxxxxxxxxxxxxxxxx
            c1         c2         c3         c4          c7          c8           c9         c10  
          _______    _______    _______    _______    ________    _________    _________    ______

    r1    0.73558     0.4143    0.15177     0.2958    0.023673       0.0569    0.0059183    0.0199
    r2     0.9752    0.75348     0.0236    0.21532      0.0011    0.0091009            0         0

xxx TABLE:stat_distr_married xxxxxxxxxxxxxxxxxx
            c1        c2  
          ______    ______

    r1    0.5635    0.4365
    r2    0.4364    0.5636

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params_stat String
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                          i     idx                             string                          
                         ___    ___    _________________________________________________________

    st_old_age_depend    "1"    "2"    "Old-age dependency ratio (ratio of 65+/(18-64))=0.25251"

</pre><h2 id="16">Return</h2><pre class="codeinput"><span class="keyword">if</span> (nargout==1)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
<span class="keyword">elseif</span> (nargout==6)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
    varargout{2} = mp_params_covid_unemploy;
    varargout{3} = mp_params_preftechpricegov;
    varargout{4} = mp_params_statesgrid;
    varargout{5} = mp_params_exotrans;
    varargout{6} = mp_params_typelife;
    varargout{7} = mp_params_intlen;
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% SNW_MP_PARAM Organizes and Sets Various Model Input Scalar and Array Parameters
%    SNW_MP_PARAM sets several main default parameter structures. There are
%    four types of parameters: scalar (pref, tech, prices), state space
%    arrays, Transition Matrixes (Exogenous), Permanent Type (Life-cycle
%    Arrays)
%
%    ST_PARAM_GROUP options:
%
%    * "default_base": Main
%    * "default_small": Quick Testing
%    * "default_tiny": Quicker Testing
%
%    Pref, Technology, and prices SCALARS:
%
%    * BETA discount
%    * THETA total factor productivity normalizer
%    * R interest rate
%
%    Vectorized State Space ARRAYS:
%
%    * AGRID asset grid
%    * ETA_GRID productivity shock grid
%
%    Transition Matrixes ARRAYS:
%
%    * PI_ETA shock productivity transition
%    * PI_KIDS shock kids count transition
%    * PSI shock survival probability
%
%    Permanent Education Type Heterogeneity ARRAYS:
%
%    * EPSILON perfect-foresight education type transition
%    * SS Social Security
%
%    MP_PARAMS = SNW_MP_PARAM() get default parameters all in the same
%    container map
%
%    MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters
%    for the type ST_PARAM_GROUP. ST_PARAM_GROUP groups include:
%    "default_base", "default_small", etc.
%
%    MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS) generates
%    default parameters for the type ST_PARAM_GROUP, display parameter map
%    details if BL_PRINT_MP_PARAMS is true.
%
%    MP_PARAMS = SNW_MP_PARAM(ST_PARAM_GROUP, BL_PRINT_MP_PARAMS,
%    IT_ROW_N_KEEP, IT_COL_N_KEEP) Control for output matrixes how many
%    rows and columns to print out.
%
%    [MP_PARAMS, MP_PARAMS_PREFTECHPRICEGOV, MP_PARAMS_STATESGRID,
%    MP_PARAMS_EXOTRANS, MP_PARAMS_TYPELIFE, MP_PARAMS_INTLEN] =
%    SNW_MP_PARAM(ST_PARAM_GROUP) generates default parameters for the type
%    ST_PARAM_GROUP, and output all parameters in one MP_PARAMS, but also
%    parameters oraganized in submaps by parameter types
%
%    See also SNWX_MP_PARAM
%

%%
function varargout = snw_mp_param(varargin)
%% Parse Main Inputs and Set Defaults
if (~isempty(varargin))

    [it_row_n_keep, it_col_n_keep] = deal(8, 8);

    if (length(varargin)==1)
        st_param_group = varargin{:};
        bl_print_mp_params = false;
    elseif (length(varargin)==2)
        [st_param_group, bl_print_mp_params] = varargin{:};
    elseif (length(varargin)==4)
        [st_param_group, bl_print_mp_params, it_row_n_keep, it_col_n_keep] = varargin{:};
    end

else

%     st_param_group = 'default_base';
    st_param_group = 'default_verydense';
%     st_param_group = 'default_dense';
%     st_param_group = 'default_tiny';
    bl_print_mp_params = true;
    [it_row_n_keep, it_col_n_keep] = deal(20, 8);

end

%% Parametesr Grid Points
% Number of grid points
n_educgrid=2; % No. of grid points for educational attainment (college vs. non-college)
n_marriedgrid=2; % No. of grid points for marital status
n_kidsgrid=5; % No. of grid points for children (0 to 5+ children)
if(strcmp(st_param_group, "default_verydense"))
    n_jgrid  =83; % Age runs from 18 to 100 (a period is 2 years)
    jret     =48;
    n_agrid  =251; % No. of grid points for assets
    n_eta_H_grid=9; % 9; % No. of grid points for persistent labor productivity shocks
    n_eta_S_grid=5; % 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)
    n_kidsgrid=5; % No. of grid points for children (0 to 4+ children)
elseif(strcmp(st_param_group, "default_moredense"))
    n_jgrid  =83; % Age runs from 18 to 100 (a period is 2 years)
    jret     =48;
    n_agrid  =151; % No. of grid points for assets
    n_eta_H_grid=9; % 9; % No. of grid points for persistent labor productivity shocks
    n_eta_S_grid=5; % 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)
    n_kidsgrid=5; % No. of grid points for children (0 to 4+ children)
elseif(strcmp(st_param_group, "default_dense"))
    n_jgrid  =83; % Age runs from 18 to 100 (a period is 2 years)
    jret     =48;
    n_agrid  =55; % No. of grid points for assets
    n_eta_H_grid=7; % 9; % No. of grid points for persistent labor productivity shocks
    n_eta_S_grid=3; % 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)
    n_kidsgrid=5; % No. of grid points for children (0 to 4+ children)
elseif(strcmp(st_param_group, "default_base"))
    n_jgrid  =42; % Age runs from 18 to 100 (a period is 2 years)
    jret=25;
    n_agrid  =40; % No. of grid points for assets
    n_eta_H_grid=5; % 9; % No. of grid points for persistent labor productivity shocks
    n_eta_S_grid=3; % 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)
    n_kidsgrid=5; % No. of grid points for children (0 to 4+ children)
elseif(strcmp(st_param_group, "default_small53"))
    n_jgrid   =18; % Age runs from 18 to 100 (16 periods of 5 years + terminal)
    jret      =13;
    n_agrid   =25;
    n_eta_H_grid=5;
    n_eta_S_grid=3;
    n_kidsgrid=3;
elseif(strcmp(st_param_group, "default_small"))
    n_jgrid   =18; % Age runs from 18 to 100 (16 periods of 5 years + terminal)
    jret      =13;
    n_agrid   =25; % No. of grid points for assets
    n_eta_H_grid=5; % 9; % No. of grid points for persistent labor productivity shocks
    n_eta_S_grid=1; % 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)
    n_kidsgrid=3; % No. of grid points for children (0 to 5+ children)
elseif(strcmp(st_param_group, "default_tiny53"))
    n_jgrid   =7; % Age runs from 18 to 100 (5 periods of 16 years + terminal)
    jret =5;
    n_agrid   =10; % No. of grid points for assets
    n_eta_H_grid=5; % 9; % No. of grid points for persistent labor productivity shocks
    n_eta_S_grid=3; % 3; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)
    n_kidsgrid=3; % No. of grid points for children (0 to 5+ children)
elseif(strcmp(st_param_group, "default_tiny"))
    n_jgrid   =7; % Age runs from 18 to 100 (5 periods of 16 years + terminal)
    jret =5;
    n_agrid   =10; % No. of grid points for assets
    n_eta_H_grid=5; % 9; % No. of grid points for persistent labor productivity shocks
    n_eta_S_grid=1; % 1; % No. of grid points for spousal labor productivity shocks (=1 corresponds to no spousal shocks)
    n_kidsgrid=3; % No. of grid points for children (0 to 5+ children)
end
n_etagrid=n_eta_H_grid*n_eta_S_grid; % Length of productivity shock grid

% Years Per Period
if (n_jgrid == 83)
    it_yrs_per_period = 1;
else
    it_yrs_per_period = (80/(n_jgrid-2));
end

%% Planning and Unemployment Parameters
% ADDITIONAL PARAMETERS/VARIABLES for planner problem are given in the following sections:
% "Compute value of employment and unemployment in 2020 conditional on number of welfare checks";
% "Probability of unemployment"
% "Solve planner's problem"
% xi: Proportional reduction in income due to unemployment (xi=0 refers to 0 labor income; xi=1 refers to no drop in labor income)
% b: Unemployment insurance replacement rate (b=0 refers to no UI benefits; b=1 refers to 100 percent labor income replacement)
% TR: Value of a welfare check (can receive multiple checks). TO DO: Update with alternative values
% n_welfchecksgrid: Number of welfare checks. 0 refers to 0 dollars; 51 refers to 5000 dollars
% pi_unemp: Probability of unemployment
% n_incgrid: Number of income groups
% inc_grid: Grid for income groups

% omega=0.0135; % Total spending on welfare checks as a share of aggregate income (estimated to cost $290 billion, or 1.35 percent of GDP in 2019. IRS has paid out $218 billion as of May 11)

xi=0.75; % Proportional reduction in income due to unemployment (xi=0 refers to 0 labor income; xi=1 refers to no drop in labor income)
b=1; % Unemployment insurance replacement rate (b=0 refers to no UI benefits; b=1 refers to 100 percent labor income replacement)
TR=100/58056; % Value of a welfare check (can receive multiple checks). TO DO: Update with alternative values
n_welfchecksgrid=51; % Number of welfare checks. 0 refers to 0 dollars; 51 refers to 5000 dollars

% Probability of unemployment
% pi_j=[0.22;0.175;0.16;0.165;0.22]; % Probability of unemployment in 2020 by age groups from Cajner et al. (2020, NBER)
% pi_w=[0.360;0.22;0.17;0.14;0.09]; % Probability of unemployment in 2020 by wage quintiles from Cajner et al. (2020, NBER)

% Columns are wage groups; rows are age groups.
pi_unemp=zeros(n_jgrid,5);
aux_mat=[0.08027790 0.05170647 0.04150239 0.03537994 0.02517586];
pi_unemp(1:13,:)=repmat(aux_mat,13,1);
aux_mat=[0.07070343 0.04213200 0.03192792 0.02580547 0.01560139];
pi_unemp(14:23,:)=repmat(aux_mat,10,1);
aux_mat=[0.06751194 0.03894051 0.02873643 0.02261398 0.01240990];
pi_unemp(24:33,:)=repmat(aux_mat,10,1);
aux_mat=[0.06857577 0.04000434 0.02980026 0.02367781 0.01347373];
pi_unemp(34:43,:)=repmat(aux_mat,10,1);
aux_mat=[0.08027790 0.05170647 0.04150239 0.03537994 0.02517586];
pi_unemp(44:48,:)=repmat(aux_mat,5,1);

clear aux_mat

% Solve planner's problem
n_incgrid=201; % Number of income groups
inc_grid=linspace(0,7,n_incgrid)'; % 7 refers to 7*58056=406392 dollars in 2012USD

%% Preferences, Technologies, etc.

% Non-calibrated parameters
gamma=2; % Risk aversion parameter
if(contains(st_param_group, "dense"))
    rho_eta=0.98; % Persistence of AR(1) productivity shocks
    sigma_eta=0.018; % Variance of AR(1) productivity shocks
    g_n=0.01; % Annual population growth of 1.1 percent
    r=0.04; % Annual real interest rate of 4.0 percent from McGrattan and Prescott
    beta=0.969010845568155; % 0.97068903873305; % Discount factor
else
    rho_eta=0.98^it_yrs_per_period;
    sigma_eta=sqrt(0.018^2*sum((0.98.^(0:(it_yrs_per_period-1))).^2));
    g_n=(1.01^it_yrs_per_period)-1;
    r=(1.04^it_yrs_per_period)-1;
    beta=0.969010845568155^it_yrs_per_period;
end

% Spousal Shocks
rho_eta_spouse=0; % Persistence of spousal AR(1) productivity shocks
sigma_eta_spouse=1.040654^2; % Variance of spousal AR(1) productivity shocks (standard deviation of residual from spousal income regression for 18-65 year-old household heads. See spousal_income.m for regression specification details)

% Bequest
% Bequests allocation rule (=1: accidental bequests go to the government; =2: accidental bequests uniformly across the population)
% Bequests=Bequests_aux/((1+g_n)*sum(sum(sum(sum(sum(sum(Phi_true(:,:,:,:,:,:))))))));
bequests_option=1;
Bequests=0.05826*(bequests_option-1);
throw_in_ocean=1; % If bequests go to the government, a value of 1 for throw_in_ocean means that all accidental bequests are "thrown in the ocean", whereas a value of 0 means the full amount goes to the government

if bequests_option==2
    a2=1.575;
elseif bequests_option==1
    if throw_in_ocean==0
        a2=0.7027;
    elseif throw_in_ocean==1
        a2=1.6081061107858;
    end
end


% Government budget constraint parameters
g_cons=0.17575574; % Government consumption expenditures to GDP (BEA: Average 2015-2019)

% Calibrated parameters
theta=0.66947637485374; % TFP parameter to normalize units such that average household income relative to GDP per capita is consistent with the data (the latter is normalized to 1): Real GDP/capita in 2019: $58,056

% Consumption allocation rule (1=uniform; 2=square root)
cons_allocation_rule=2;

% Social Security benefits
SS=zeros(n_jgrid,2);
SS(jret:end,1)=0.24433; % Average SS non-college 2005-2009 as a share of GDP per capita
SS(jret:end,2)=0.29263; % Average SS college 2005-2009 as a share of GDP per capita

%% PARAM Mortality
% Assume MORT_PROB will have 80 rows. Average based on Resulting Dataframes
load('Mortality_prob_by_age_18_99.mat','mort_prob')
psi_full=1-mort_prob;
psi_full=[psi_full;0]; % Maximum lifespan=100 (survival probability at age 100=0)

if(contains(st_param_group, "dense"))
    psi = psi_full;
else
    psi = NaN(n_jgrid,1);
    psi(1) = mean(1-mort_prob(1:2));
    psi(2:(end-1)) = prod(reshape(1-mort_prob(3:end), it_yrs_per_period, []), 1)';
    psi(end) = 0;
end

clear mort_prob psi_full

%% PARAM Productivity by Education Types
% Generate epsilon matrix
% A1. load external
load('Life_cycle_prod_by_educ.mat','life_cycle_prod_by_educ') % Life-cycle labor productivity for 20-100 year-olds by education (non-college vs. college)
% Set Annual
epsilon_full=NaN(83,2);
epsilon_full(3:end,:)=life_cycle_prod_by_educ(:,:);

epsilon_full(1,:)=epsilon_full(3,:); % Let life-cycle labor productivity of 18- and 19-year-olds be the same as that for 20-year-olds
epsilon_full(2,:)=epsilon_full(3,:);

if(contains(st_param_group, "dense"))
    epsilon = epsilon_full;
else
    epsilon=NaN(n_jgrid,2);
    epsilon(1,:) = epsilon_full(3,:);
    for e=1:2
        epsilon(2:end-1,e) = mean(reshape(life_cycle_prod_by_educ(1:80, e), it_yrs_per_period, (n_jgrid-2)))';
    end
end

epsilon(jret:end,:)=0; % Assume zero labor productivity for 65+ year-olds (exogenous retirement)

clear life_cycle_prod_by_educ epsilon_aux

%% PARAM Kids Transition
% Transition probabilities for number of children (0, 1, 2, 3, 4, or 5) (stored in the following order:
% Number of children in year 1, age, marital status, college attainment. Each column refers to
% the number of children in year 2)
%
% PI_KIDS_TRANS_PROB has 6*2*41 = 492 rows. It is assuming
% strcmp(st_param_group, "default_base"). For tiny and small grid, select
% appropriate subset of rows to match appropriate age groups from PI_KIDS.
%
% pi_kids_trans_prob estimation might change in the future if there are
% more age groups added. To make sure this code here works, use
% N_JGRID_PKTP as the N_JGRID count for PI_KIDS_TRANS_PROB. But assume
% there will always be up to 6 kids, and 2 marriage/notmarry groups.


load('pi_kids_trans_prob','pi_kids_trans_prob')
n_kidsgrid_kptp = 5;
n_educgrid_kptp = 2;
n_marriedgrid_kptp = 2;
n_jgrid_pktp = 83;
pi_kids_pktp =NaN(...
    n_kidsgrid_kptp,...
    n_kidsgrid_kptp,...
    n_jgrid_pktp,...
    n_educgrid_kptp,...
    n_marriedgrid_kptp);

for kidsp=1:n_kidsgrid_kptp % No. of kids in year 2
    counter=0;
    for kids=1:n_kidsgrid_kptp % No. of kids in year 1
        for j=1:(n_jgrid_pktp-1) % Age in year 1
            for married=1:n_marriedgrid_kptp % Marital status
                for educ=1:n_educgrid_kptp % Educational level
                    counter=counter+1;
                    pi_kids_pktp(kids,kidsp,j,educ,married)=pi_kids_trans_prob(counter,kidsp);
                end
            end
        end
    end
end

pi_kids_pktp(:,:,n_jgrid_pktp,:,:)=0;
pi_kids_pktp(:,1,n_jgrid_pktp,:,:)=1;

% Subset Selection
if(contains(st_param_group, "dense"))
    pi_kids = pi_kids_pktp;
else
    pi_kids = pi_kids_pktp(...
        1:n_kidsgrid, ...
        1:n_kidsgrid, ...
        round(linspace(1, n_jgrid_pktp, n_jgrid)), ...
        :, : ...
        );
end

% Ensure that all rows sum to 1 in case of rounding error
for kids=1:n_kidsgrid % No. of kids in year 1
    for j=1:n_jgrid % Age in year 1
        for educ=1:n_educgrid % Educational level
            for married=1:n_marriedgrid % Marital status
                aux_sum=sum(pi_kids(kids,:,j,educ,married));
                pi_kids(kids,:,j,educ,married)=pi_kids(kids,:,j,educ,married)/aux_sum;
            end
        end
    end
end

%
clear aux_sum counter pi_kids_trans_prob pi_kids_pktp

%% PARAM Specifying asset grid (use non-linear spacing with minimum value of 0)
curv=3; % Governs how the grid points are allocated
scale_a=190; % Maximum value of assets (NOTE: Verifying that it does not bind in Aggregation.m) grid=1.2451e-11
scale_a=135; % Maximum value of assets (NOTE: Verifying that it does not bind in Aggregation.m) grid=0


agrid=zeros(n_agrid,1);

for i=2:n_agrid
	agrid(i)=scale_a*((i-1)/(n_agrid-1))^curv;
end

%% Derive transition probabilities and stationary distribution for productivity shock
% Discretize process for persistent productivity shocks and derive stationary distribution
[eta_H_grid_aux,pi_H_eta]=rouwenhorst(rho_eta,sqrt(sigma_eta),n_eta_H_grid);
[eta_S_grid_aux,pi_S_eta]=rouwenhorst(rho_eta_spouse,sqrt(sigma_eta_spouse),n_eta_S_grid);

pi_eta=NaN(n_etagrid,n_etagrid);
counter=0;
for eta_S=1:n_eta_S_grid
    for eta_H=1:n_eta_H_grid
        counter=counter+1;

        counterp=0;
        for eta_Sp=1:n_eta_S_grid
            for eta_Hp=1:n_eta_H_grid
                counterp=counterp+1;
                pi_eta(counter,counterp)=pi_H_eta(eta_H,eta_Hp)*pi_S_eta(eta_S,eta_Sp);
            end
        end
    end
end

eta_H_grid=repmat(eta_H_grid_aux,n_eta_S_grid,1);
eta_S_grid=sort(repmat(eta_S_grid_aux,n_eta_H_grid,1));

stat_distr_eta=NaN(1,n_etagrid);

x0=(1/n_etagrid)*ones(1,n_etagrid);

err=1;
tol=10^-12;

while err>tol
    x1=x0*pi_eta(:,:);
    err=max(abs(x1-x0));
    if err>tol
       x0=x1;
    end
end

stat_distr_eta(1,:)=x0;

clear counter counterp eta_H_grid_aux eta_S_grid_aux

%% Initial conditions for marital status, college attainment, and number of kids
% Distribution of educational attainment from PSID
% tab Rcollege if RAGE>=18 & RAGE!=. [aweight=WEIGHT]
stat_distr_educ(1,1)=0.6970; % No college
stat_distr_educ(1,2)=0.3030; % College

% Distribution of marital status conditional on college attainment from PSID
% tab  Rmarried if RAGE>=18 & RAGE!=. & Rcollege==0 [aweight=WEIGHT]
stat_distr_married(1,1)=0.5635; % Not married
stat_distr_married(1,2)=0.4365; % Married

% tab  Rmarried if RAGE>=18 & RAGE!=. & Rcollege==1 [aweight=WEIGHT]
stat_distr_married(2,1)=0.4364; % Not married
stat_distr_married(2,2)=0.5636; % Married

% Stationary distribution of children at age 20 from PSID
% Not married and no college
% tab kids if Rmarried==0 & Rcollege==0 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(1,1,1)=0.7333;
stat_distr_kids_kn5(1,1,2)=0.1513;
stat_distr_kids_kn5(1,1,3)=0.0828;
stat_distr_kids_kn5(1,1,4)=0.0236;
stat_distr_kids_kn5(1,1,5)=0.0059;

% Not married but college-educated
% tab kids if Rmarried==0 & Rcollege==1 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(2,1,1)=0.9752;
stat_distr_kids_kn5(2,1,2)=0.0236;
stat_distr_kids_kn5(2,1,3)=0.0001;
stat_distr_kids_kn5(2,1,4)=0.0011;
stat_distr_kids_kn5(2,1,5)=0;

% Married and no college
% tab kids if Rmarried==1 & Rcollege==0 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(1,2,1)=0.4143;
stat_distr_kids_kn5(1,2,2)=0.2958;
stat_distr_kids_kn5(1,2,3)=0.2131;
stat_distr_kids_kn5(1,2,4)=0.0569;
stat_distr_kids_kn5(1,2,5)=0.0199;

% Married and college-educated
% tab kids if Rmarried==1 & Rcollege==1 & inrange(RAGE,18,25) [aweight=WEIGHT]
stat_distr_kids_kn5(2,2,1)=0.7534;
stat_distr_kids_kn5(2,2,2)=0.2153;
stat_distr_kids_kn5(2,2,3)=0.0221;
stat_distr_kids_kn5(2,2,4)=0.0091;
stat_distr_kids_kn5(2,2,5)=0;

% Subset Kids for Smaller Solutions
if(strcmp(st_param_group, "default_base"))
    stat_distr_kids = stat_distr_kids_kn5;
else
    stat_distr_kids = stat_distr_kids_kn5(:,:,1:n_kidsgrid);
end

% Reweight
bl_sum_onebyone = true;
if (bl_sum_onebyone)
    aux=sum(stat_distr_kids(1,1,:));
    stat_distr_kids(1,1,:)=stat_distr_kids(1,1,:)/aux;
    aux=sum(stat_distr_kids(2,1,:));
    stat_distr_kids(2,1,:)=stat_distr_kids(2,1,:)/aux;
    aux=sum(stat_distr_kids(1,2,:));
    stat_distr_kids(1,2,:)=stat_distr_kids(1,2,:)/aux;
    aux=sum(stat_distr_kids(2,2,:));
    stat_distr_kids(2,2,:)=stat_distr_kids(2,2,:)/aux;
else
    mt_aux = repmat(sum(stat_distr_kids, 3), ...
        [1,1,size(stat_distr_kids,3)]);
    stat_distr_kids(2,2,:)=stat_distr_kids./mt_aux;
end

clear aux

%% Population distribution
% Normalize mass of 18-year-olds to 1
Pop=zeros(n_jgrid,1);
Pop(1)=1;
for j=2:n_jgrid
    Pop(j)=Pop(j-1)*psi(j-1)/(1+g_n);
end

name='Old-age dependency ratio (ratio of 65+/(18-64))=';
st_old_age_depend =[name,num2str(sum(Pop(jret:end))/sum(Pop(1:(jret-1))))];
% disp(st_old_age_depend);

%% Set Parameter Maps
mp_params_covid_unemploy = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_covid_unemploy('xi') = xi;
mp_params_covid_unemploy('b') = b;
mp_params_covid_unemploy('TR') = TR;
mp_params_covid_unemploy('n_welfchecksgrid') = n_welfchecksgrid;
mp_params_covid_unemploy('pi_unemp') = pi_unemp;
mp_params_covid_unemploy('n_incgrid') = n_incgrid;
mp_params_covid_unemploy('inc_grid') = inc_grid;

mp_params_preftechpricegov = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_preftechpricegov('gamma') = gamma;
mp_params_preftechpricegov('beta') = beta;
mp_params_preftechpricegov('theta') = theta;
mp_params_preftechpricegov('cons_allocation_rule') = cons_allocation_rule;
mp_params_preftechpricegov('r') = r;
mp_params_preftechpricegov('g_n') = g_n;
mp_params_preftechpricegov('g_cons') = g_cons;
mp_params_preftechpricegov('a2') = a2;
mp_params_preftechpricegov('jret') = jret;
mp_params_preftechpricegov('Bequests') = Bequests;
mp_params_preftechpricegov('bequests_option') = bequests_option;
mp_params_preftechpricegov('throw_in_ocean') = throw_in_ocean;

mp_params_statesgrid = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_statesgrid('agrid') = agrid;
mp_params_statesgrid('eta_H_grid') = eta_H_grid;
mp_params_statesgrid('eta_S_grid') = eta_S_grid;

mp_params_exotrans = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_exotrans('pi_eta') = pi_eta;
mp_params_exotrans('pi_H_eta') = pi_H_eta;
mp_params_exotrans('pi_S_eta') = pi_S_eta;
mp_params_exotrans('pi_kids') = pi_kids;
mp_params_exotrans('psi') = psi;

mp_params_typelife = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_typelife('epsilon') = epsilon;
mp_params_typelife('SS') = SS;

mp_params_intlen = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_intlen('n_jgrid') = n_jgrid;
mp_params_intlen('n_agrid') = n_agrid;
mp_params_intlen('n_etagrid') = n_etagrid;
mp_params_intlen('n_eta_S_grid') = n_eta_S_grid;
mp_params_intlen('n_eta_H_grid') = n_eta_H_grid;
mp_params_intlen('n_educgrid') = n_educgrid;
mp_params_intlen('n_marriedgrid') = n_marriedgrid;
mp_params_intlen('n_kidsgrid') = n_kidsgrid;

mp_params_stat = containers.Map('KeyType', 'char', 'ValueType', 'any');
mp_params_stat('stat_distr_eta') = stat_distr_eta;
mp_params_stat('stat_distr_educ') = stat_distr_educ;
mp_params_stat('stat_distr_married') = stat_distr_married;
mp_params_stat('stat_distr_kids') = stat_distr_kids;
mp_params_stat('Pop') = Pop;
mp_params_stat('st_old_age_depend') = string(st_old_age_depend);

%% Combine Maps
mp_params = [...
    mp_params_covid_unemploy; ...
    mp_params_preftechpricegov; ...
    mp_params_statesgrid ; ...
    mp_params_exotrans; ...
    mp_params_typelife; ...
    mp_params_intlen ; ...
    mp_params_stat];

mp_params('mp_params_name') = string(st_param_group);

% MP_PARAMS = [MP_PARAMS_PREFTECHPRICE; MP_PARAMS_STATESGRID ; ...
%     MP_PARAMS_EXOTRANS; MP_PARAMS_TYPELIFE; MP_PARAMS_INTLEN];

%% Print
if (bl_print_mp_params)
    ff_container_map_display(mp_params_covid_unemploy);
    ff_container_map_display(mp_params_preftechpricegov);
    ff_container_map_display(mp_params_intlen);
    ff_container_map_display(mp_params_statesgrid, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_exotrans, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_typelife, it_row_n_keep, it_col_n_keep);
    ff_container_map_display(mp_params_stat, it_row_n_keep, it_col_n_keep);
end

%% Return
if (nargout==1)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
elseif (nargout==6)
    varargout = cell(nargout,0);
    varargout{1} = mp_params;
    varargout{2} = mp_params_covid_unemploy;
    varargout{3} = mp_params_preftechpricegov;
    varargout{4} = mp_params_statesgrid;
    varargout{5} = mp_params_exotrans;
    varargout{6} = mp_params_typelife;
    varargout{7} = mp_params_intlen;
end

end

##### SOURCE END #####
--></body></html>