<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Alternative Value Function Solution Testing | SNW Dynamic Life Cycle and Welfare Checks Code Companion</title>
  <meta name="description" content="Chapter 3 Alternative Value Function Solution Testing | SNW Dynamic Life Cycle and Welfare Checks Code Companion" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Alternative Value Function Solution Testing | SNW Dynamic Life Cycle and Welfare Checks Code Companion" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 3 Alternative Value Function Solution Testing | SNW Dynamic Life Cycle and Welfare Checks Code Companion" />
  <meta name="github-repo" content="fanwangecon/PrjOptiSNW" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Alternative Value Function Solution Testing | SNW Dynamic Life Cycle and Welfare Checks Code Companion" />
  
  <meta name="twitter:description" content="Chapter 3 Alternative Value Function Solution Testing | SNW Dynamic Life Cycle and Welfare Checks Code Companion" />
  

<meta name="author" content="Vegard Nygård, Bent Sørensen, and Fan Wang" />


<meta name="date" content="2020-08-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="solving-the-dynamic-life-cycle-problem.html"/>
<link rel="next" href="solution-with-unemployment.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-10');
</script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SNW Dynamic Life Cycle and Welfare Checks Code Companion</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="parameters.html"><a href="parameters.html"><i class="fa fa-check"></i><b>1</b> Parameters</a><ul>
<li class="chapter" data-level="1.1" data-path="parameters.html"><a href="parameters.html#model-parameters"><i class="fa fa-check"></i><b>1.1</b> Model Parameters</a><ul>
<li class="chapter" data-level="1.1.1" data-path="parameters.html"><a href="parameters.html#documentation-run-parameters-docdense"><i class="fa fa-check"></i><b>1.1.1</b> Documentation Run Parameters Docdense</a></li>
<li class="chapter" data-level="1.1.2" data-path="parameters.html"><a href="parameters.html#parameters-used-for-test-simulation"><i class="fa fa-check"></i><b>1.1.2</b> Parameters Used for Test Simulation</a></li>
<li class="chapter" data-level="1.1.3" data-path="parameters.html"><a href="parameters.html#parameters-used-for-paper-simulations"><i class="fa fa-check"></i><b>1.1.3</b> Parameters Used for Paper Simulations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="parameters.html"><a href="parameters.html#model-controls"><i class="fa fa-check"></i><b>1.2</b> Model Controls</a><ul>
<li class="chapter" data-level="1.2.1" data-path="parameters.html"><a href="parameters.html#test-snw_mp_controls-defaults"><i class="fa fa-check"></i><b>1.2.1</b> Test SNW_MP_CONTROLS Defaults</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="solving-the-dynamic-life-cycle-problem.html"><a href="solving-the-dynamic-life-cycle-problem.html"><i class="fa fa-check"></i><b>2</b> Solving the Dynamic Life Cycle Problem</a><ul>
<li class="chapter" data-level="2.1" data-path="solving-the-dynamic-life-cycle-problem.html"><a href="solving-the-dynamic-life-cycle-problem.html#life-cycle-dynamic-programming-with-marital-status-children-and-savings"><i class="fa fa-check"></i><b>2.1</b> Life Cycle Dynamic Programming with Marital Status, Children and Savings</a><ul>
<li class="chapter" data-level="2.1.1" data-path="solving-the-dynamic-life-cycle-problem.html"><a href="solving-the-dynamic-life-cycle-problem.html#test-snw_vfi_main_bisect_vec-defaults-more-dense"><i class="fa fa-check"></i><b>2.1.1</b> Test SNW_VFI_MAIN_BISECT_VEC Defaults More Dense</a></li>
<li class="chapter" data-level="2.1.2" data-path="solving-the-dynamic-life-cycle-problem.html"><a href="solving-the-dynamic-life-cycle-problem.html#more-dense-param-results-define-frames"><i class="fa fa-check"></i><b>2.1.2</b> More Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="2.1.3" data-path="solving-the-dynamic-life-cycle-problem.html"><a href="solving-the-dynamic-life-cycle-problem.html#analyze-savings-and-shocks"><i class="fa fa-check"></i><b>2.1.3</b> Analyze Savings and Shocks</a></li>
<li class="chapter" data-level="2.1.4" data-path="solving-the-dynamic-life-cycle-problem.html"><a href="solving-the-dynamic-life-cycle-problem.html#analyze-kids-and-marriage-and-age"><i class="fa fa-check"></i><b>2.1.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="2.1.5" data-path="solving-the-dynamic-life-cycle-problem.html"><a href="solving-the-dynamic-life-cycle-problem.html#analyze-education-and-marriage-and-age"><i class="fa fa-check"></i><b>2.1.5</b> Analyze Education and Marriage and Age</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html"><i class="fa fa-check"></i><b>3</b> Alternative Value Function Solution Testing</a><ul>
<li class="chapter" data-level="3.1" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-test-exact-solution-looped-minimizer"><i class="fa fa-check"></i><b>3.1</b> Small Test Exact Solution Looped Minimizer</a><ul>
<li class="chapter" data-level="3.1.1" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#test-snw_vfi_main-defaults-small"><i class="fa fa-check"></i><b>3.1.1</b> Test SNW_VFI_MAIN Defaults Small</a></li>
<li class="chapter" data-level="3.1.2" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-param-results-define-frames"><i class="fa fa-check"></i><b>3.1.2</b> Small Param Results Define Frames</a></li>
<li class="chapter" data-level="3.1.3" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-savings-and-shocks-1"><i class="fa fa-check"></i><b>3.1.3</b> Analyze Savings and Shocks</a></li>
<li class="chapter" data-level="3.1.4" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-kids-and-marriage-and-age-1"><i class="fa fa-check"></i><b>3.1.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="3.1.5" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-education-and-marriage-and-age-1"><i class="fa fa-check"></i><b>3.1.5</b> Analyze Education and Marriage and Age</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-test-grid-search-solution"><i class="fa fa-check"></i><b>3.2</b> Small Test Grid Search Solution</a><ul>
<li class="chapter" data-level="3.2.1" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#test-snw_vfi_main_grid_search-defaults-small"><i class="fa fa-check"></i><b>3.2.1</b> Test SNW_VFI_MAIN_GRID_SEARCH Defaults Small</a></li>
<li class="chapter" data-level="3.2.2" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-param-results-define-frames-1"><i class="fa fa-check"></i><b>3.2.2</b> Small Param Results Define Frames</a></li>
<li class="chapter" data-level="3.2.3" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-savings-and-shocks-2"><i class="fa fa-check"></i><b>3.2.3</b> Analyze Savings and Shocks</a></li>
<li class="chapter" data-level="3.2.4" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-kids-and-marriage-and-age-2"><i class="fa fa-check"></i><b>3.2.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="3.2.5" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-education-and-marriage-and-age-2"><i class="fa fa-check"></i><b>3.2.5</b> Analyze Education and Marriage and Age</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-test-exact-solution-vectorized-bisection"><i class="fa fa-check"></i><b>3.3</b> Small Test Exact Solution Vectorized Bisection</a><ul>
<li class="chapter" data-level="3.3.1" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#test-snw_vfi_main-defaults-small-1"><i class="fa fa-check"></i><b>3.3.1</b> Test SNW_VFI_MAIN Defaults Small</a></li>
<li class="chapter" data-level="3.3.2" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-param-results-define-frames-2"><i class="fa fa-check"></i><b>3.3.2</b> Small Param Results Define Frames</a></li>
<li class="chapter" data-level="3.3.3" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-savings-and-shocks-3"><i class="fa fa-check"></i><b>3.3.3</b> Analyze Savings and Shocks</a></li>
<li class="chapter" data-level="3.3.4" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-kids-and-marriage-and-age-3"><i class="fa fa-check"></i><b>3.3.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="3.3.5" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-education-and-marriage-and-age-3"><i class="fa fa-check"></i><b>3.3.5</b> Analyze Education and Marriage and Age</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-test-exact-solution-spousal-shocks"><i class="fa fa-check"></i><b>3.4</b> Small Test Exact Solution Spousal Shocks</a><ul>
<li class="chapter" data-level="3.4.1" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#test-snw_vfi_main-defaults-small-2"><i class="fa fa-check"></i><b>3.4.1</b> Test SNW_VFI_MAIN Defaults Small</a></li>
<li class="chapter" data-level="3.4.2" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#small-param-results-define-frames-3"><i class="fa fa-check"></i><b>3.4.2</b> Small Param Results Define Frames</a></li>
<li class="chapter" data-level="3.4.3" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-savings-and-shocks-4"><i class="fa fa-check"></i><b>3.4.3</b> Analyze Savings and Shocks</a></li>
<li class="chapter" data-level="3.4.4" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-kids-and-marriage-and-age-4"><i class="fa fa-check"></i><b>3.4.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="3.4.5" data-path="alternative-value-function-solution-testing.html"><a href="alternative-value-function-solution-testing.html#analyze-education-and-marriage-and-age-4"><i class="fa fa-check"></i><b>3.4.5</b> Analyze Education and Marriage and Age</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="solution-with-unemployment.html"><a href="solution-with-unemployment.html"><i class="fa fa-check"></i><b>4</b> Solution with Unemployment</a><ul>
<li class="chapter" data-level="4.1" data-path="solution-with-unemployment.html"><a href="solution-with-unemployment.html#life-cycle-dynamic-programming-under-unemployment-shock"><i class="fa fa-check"></i><b>4.1</b> Life Cycle Dynamic Programming under Unemployment Shock</a><ul>
<li class="chapter" data-level="4.1.1" data-path="solution-with-unemployment.html"><a href="solution-with-unemployment.html#test-snw_vfi_unemp-defaults-dense"><i class="fa fa-check"></i><b>4.1.1</b> Test SNW_VFI_UNEMP Defaults Dense</a></li>
<li class="chapter" data-level="4.1.2" data-path="solution-with-unemployment.html"><a href="solution-with-unemployment.html#dense-param-results-define-frames"><i class="fa fa-check"></i><b>4.1.2</b> Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="4.1.3" data-path="solution-with-unemployment.html"><a href="solution-with-unemployment.html#analyze-savings-and-shocks-5"><i class="fa fa-check"></i><b>4.1.3</b> Analyze Savings and Shocks</a></li>
<li class="chapter" data-level="4.1.4" data-path="solution-with-unemployment.html"><a href="solution-with-unemployment.html#analyze-kids-and-marriage-and-age-5"><i class="fa fa-check"></i><b>4.1.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="4.1.5" data-path="solution-with-unemployment.html"><a href="solution-with-unemployment.html#analyze-education-and-marriage-and-age-5"><i class="fa fa-check"></i><b>4.1.5</b> Analyze Education and Marriage and Age</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html"><i class="fa fa-check"></i><b>5</b> Household Life Cycle Distribution</a><ul>
<li class="chapter" data-level="5.1" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#distribution-exact-savings-choices"><i class="fa fa-check"></i><b>5.1</b> Distribution Exact Savings Choices</a><ul>
<li class="chapter" data-level="5.1.1" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#test-snw_ds_main-defaults-dense"><i class="fa fa-check"></i><b>5.1.1</b> Test SNW_DS_MAIN Defaults Dense</a></li>
<li class="chapter" data-level="5.1.2" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#show-all-info-in-mp_dsvfi_results-more-dense"><i class="fa fa-check"></i><b>5.1.2</b> Show All Info in mp_dsvfi_results More Dense</a></li>
<li class="chapter" data-level="5.1.3" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#more-dense-param-results-define-frames-1"><i class="fa fa-check"></i><b>5.1.3</b> More Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="5.1.4" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#analyze-probability-mass-along-age-dimensions"><i class="fa fa-check"></i><b>5.1.4</b> Analyze Probability Mass Along Age Dimensions</a></li>
<li class="chapter" data-level="5.1.5" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#analyze-probability-mass-asset-and-shock-dimensions"><i class="fa fa-check"></i><b>5.1.5</b> Analyze Probability Mass Asset and Shock Dimensions</a></li>
<li class="chapter" data-level="5.1.6" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#probability-statistics-a-c-and-v-conditional-on-ages"><i class="fa fa-check"></i><b>5.1.6</b> Probability Statistics A, C and V Conditional on Ages</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#distribution-exact-savings-choices-vectorized"><i class="fa fa-check"></i><b>5.2</b> Distribution Exact Savings Choices Vectorized</a><ul>
<li class="chapter" data-level="5.2.1" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#test-snw_ds_main_vec-defaults-dense"><i class="fa fa-check"></i><b>5.2.1</b> Test SNW_DS_MAIN_VEC Defaults Dense</a></li>
<li class="chapter" data-level="5.2.2" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#show-all-info-in-mp_dsvfi_results-more-dense-1"><i class="fa fa-check"></i><b>5.2.2</b> Show All Info in mp_dsvfi_results More Dense</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#distribution-grid-search"><i class="fa fa-check"></i><b>5.3</b> Distribution Grid Search</a><ul>
<li class="chapter" data-level="5.3.1" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#test-snw_ds_main_grid_search-defaults-more-dense"><i class="fa fa-check"></i><b>5.3.1</b> Test SNW_DS_MAIN_GRID_SEARCH Defaults More Dense</a></li>
<li class="chapter" data-level="5.3.2" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#show-all-info-in-mp_dsvfi_results-more-dense-2"><i class="fa fa-check"></i><b>5.3.2</b> Show All Info in mp_dsvfi_results More Dense</a></li>
<li class="chapter" data-level="5.3.3" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#more-dense-param-results-define-frames-2"><i class="fa fa-check"></i><b>5.3.3</b> More Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="5.3.4" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#analyze-probability-mass-along-age-dimensions-1"><i class="fa fa-check"></i><b>5.3.4</b> Analyze Probability Mass Along Age Dimensions</a></li>
<li class="chapter" data-level="5.3.5" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#analyze-probability-mass-asset-and-shock-dimensions-1"><i class="fa fa-check"></i><b>5.3.5</b> Analyze Probability Mass Asset and Shock Dimensions</a></li>
<li class="chapter" data-level="5.3.6" data-path="household-life-cycle-distribution.html"><a href="household-life-cycle-distribution.html#probability-statistics-a-c-and-v-conditional-on-ages-1"><i class="fa fa-check"></i><b>5.3.6</b> Probability Statistics A, C and V Conditional on Ages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="value-of-each-check.html"><a href="value-of-each-check.html"><i class="fa fa-check"></i><b>6</b> Value of Each Check</a><ul>
<li class="chapter" data-level="6.1" data-path="value-of-each-check.html"><a href="value-of-each-check.html#v-and-c-without-unemployment"><i class="fa fa-check"></i><b>6.1</b> 2020 V and C without Unemployment</a><ul>
<li class="chapter" data-level="6.1.1" data-path="value-of-each-check.html"><a href="value-of-each-check.html#test-snw_a4chk_wrk_bisec_vec-defaults-dense"><i class="fa fa-check"></i><b>6.1.1</b> Test SNW_A4CHK_WRK_BISEC_VEC Defaults Dense</a></li>
<li class="chapter" data-level="6.1.2" data-path="value-of-each-check.html"><a href="value-of-each-check.html#dense-param-results-define-frames-1"><i class="fa fa-check"></i><b>6.1.2</b> Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="6.1.3" data-path="value-of-each-check.html"><a href="value-of-each-check.html#analyze-difference-in-v-and-c-with-check"><i class="fa fa-check"></i><b>6.1.3</b> Analyze Difference in V and C with Check</a></li>
<li class="chapter" data-level="6.1.4" data-path="value-of-each-check.html"><a href="value-of-each-check.html#analyze-kids-and-marriage-and-age-6"><i class="fa fa-check"></i><b>6.1.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="6.1.5" data-path="value-of-each-check.html"><a href="value-of-each-check.html#analyze-education-and-marriage"><i class="fa fa-check"></i><b>6.1.5</b> Analyze Education and Marriage</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="value-of-each-check.html"><a href="value-of-each-check.html#v-and-c-with-unemployment"><i class="fa fa-check"></i><b>6.2</b> 2020 V and C with Unemployment</a><ul>
<li class="chapter" data-level="6.2.1" data-path="value-of-each-check.html"><a href="value-of-each-check.html#test-snw_a4chk_unemp_bisec_vec-defaults"><i class="fa fa-check"></i><b>6.2.1</b> Test SNW_A4CHK_UNEMP_BISEC_VEC Defaults</a></li>
<li class="chapter" data-level="6.2.2" data-path="value-of-each-check.html"><a href="value-of-each-check.html#dense-param-results-define-frames-2"><i class="fa fa-check"></i><b>6.2.2</b> Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="6.2.3" data-path="value-of-each-check.html"><a href="value-of-each-check.html#analyze-difference-in-v-and-c-with-check-1"><i class="fa fa-check"></i><b>6.2.3</b> Analyze Difference in V and C with Check</a></li>
<li class="chapter" data-level="6.2.4" data-path="value-of-each-check.html"><a href="value-of-each-check.html#analyze-kids-and-marriage-and-age-7"><i class="fa fa-check"></i><b>6.2.4</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="6.2.5" data-path="value-of-each-check.html"><a href="value-of-each-check.html#analyze-education-and-marriage-1"><i class="fa fa-check"></i><b>6.2.5</b> Analyze Education and Marriage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html"><i class="fa fa-check"></i><b>7</b> 2020 Outcomes Full State Space with Savings, Shocks and Education</a><ul>
<li class="chapter" data-level="7.1" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#full-states-ev-and-ec-of-one-check"><i class="fa fa-check"></i><b>7.1</b> 2020 Full States EV and EC of One Check</a><ul>
<li class="chapter" data-level="7.1.1" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#test-snw_evuvw20_jaeemk-defaults-dense"><i class="fa fa-check"></i><b>7.1.1</b> Test SNW_EVUVW20_JAEEMK Defaults Dense</a></li>
<li class="chapter" data-level="7.1.2" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#solve-for-2020-evuvw-with-0-and-2-checks"><i class="fa fa-check"></i><b>7.1.2</b> Solve for 2020 Evuvw With 0 and 2 Checks</a></li>
<li class="chapter" data-level="7.1.3" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#dense-param-results-define-frames-3"><i class="fa fa-check"></i><b>7.1.3</b> Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="7.1.4" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#analyze-difference-in-v-and-c-with-check-2"><i class="fa fa-check"></i><b>7.1.4</b> Analyze Difference in V and C with Check</a></li>
<li class="chapter" data-level="7.1.5" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#analyze-marginal-value-and-mpc-over-yaeta-conditional-on-kids-marry-age-education"><i class="fa fa-check"></i><b>7.1.5</b> Analyze Marginal Value and MPC over Y(a,eta), Conditional On Kids, Marry, Age, Education</a></li>
<li class="chapter" data-level="7.1.6" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#marginal-value-gains-color-as-shock-conditional-on-age-marital-kids-and-education"><i class="fa fa-check"></i><b>7.1.6</b> Marginal Value Gains, Color as Shock, Conditional on Age, Marital, Kids, and Education</a></li>
<li class="chapter" data-level="7.1.7" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#marginal-consumption-gains-color-as-shock-conditional-on-age-marital-kids-and-education"><i class="fa fa-check"></i><b>7.1.7</b> Marginal Consumption Gains, Color as Shock, Conditional on Age, Marital, Kids, and Education</a></li>
<li class="chapter" data-level="7.1.8" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#analyze-kids-and-marriage-and-age-8"><i class="fa fa-check"></i><b>7.1.8</b> Analyze Kids and Marriage and Age</a></li>
<li class="chapter" data-level="7.1.9" data-path="outcomes-full-state-space-with-savings-shocks-and-education.html"><a href="outcomes-full-state-space-with-savings-shocks-and-education.html#analyze-education-and-marriage-2"><i class="fa fa-check"></i><b>7.1.9</b> Analyze Education and Marriage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html"><i class="fa fa-check"></i><b>8</b> 2019 Expectations Given Income, Age, Kids and Marital Status</a><ul>
<li class="chapter" data-level="8.1" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#age-income-kids-marry-ev-and-ec-of-one-check"><i class="fa fa-check"></i><b>8.1</b> 2019 Age, Income, Kids, Marry EV and EC of One Check</a><ul>
<li class="chapter" data-level="8.1.1" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#test-snw_evuvw19_jmky-defaults-dense"><i class="fa fa-check"></i><b>8.1.1</b> Test SNW_EVUVW19_JMKY Defaults Dense</a></li>
<li class="chapter" data-level="8.1.2" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#solve-vfi-and-distributon"><i class="fa fa-check"></i><b>8.1.2</b> Solve VFI and Distributon</a></li>
<li class="chapter" data-level="8.1.3" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#pre-compute-matrixes-and-ymky-mass"><i class="fa fa-check"></i><b>8.1.3</b> Pre-Compute Matrixes and YMKY Mass</a></li>
<li class="chapter" data-level="8.1.4" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#solve-for-2019-evuvw-with-0-and-2-checks"><i class="fa fa-check"></i><b>8.1.4</b> Solve for 2019 Evuvw With 0 and 2 Checks</a></li>
<li class="chapter" data-level="8.1.5" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#dense-param-results-define-frames-4"><i class="fa fa-check"></i><b>8.1.5</b> Dense Param Results Define Frames</a></li>
<li class="chapter" data-level="8.1.6" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#analyze-marginal-value-and-mpc-over-yaeta-conditional-on-kids-marry-age-education-1"><i class="fa fa-check"></i><b>8.1.6</b> Analyze Marginal Value and MPC over Y(a,eta), Conditional On Kids, Marry, Age, Education</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#age-income-kids-marry-ev-and-ec-all-checks"><i class="fa fa-check"></i><b>8.2</b> 2019 Age, Income, Kids, Marry EV and EC All Checks</a><ul>
<li class="chapter" data-level="8.2.1" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#test-snw_evuvw19_jmky_allchecks-parameters"><i class="fa fa-check"></i><b>8.2.1</b> Test SNW_EVUVW19_JMKY_ALLCHECKS Parameters</a></li>
<li class="chapter" data-level="8.2.2" data-path="expectations-given-income-age-kids-and-marital-status.html"><a href="expectations-given-income-age-kids-and-marital-status.html#snw_evuvw19_jmky_allchecks-low-storage-invoke"><i class="fa fa-check"></i><b>8.2.2</b> SNW_EVUVW19_JMKY_ALLCHECKS Low Storage Invoke</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="calibration.html"><a href="calibration.html"><i class="fa fa-check"></i><b>9</b> Calibration</a><ul>
<li class="chapter" data-level="9.1" data-path="calibration.html"><a href="calibration.html#calibrate-beta-and-normalize-gdp"><i class="fa fa-check"></i><b>9.1</b> Calibrate Beta and Normalize GDP</a><ul>
<li class="chapter" data-level="9.1.1" data-path="calibration.html"><a href="calibration.html#calibrate-parameter-controls-for-snw-functions"><i class="fa fa-check"></i><b>9.1.1</b> Calibrate Parameter Controls for SNW Functions</a></li>
<li class="chapter" data-level="9.1.2" data-path="calibration.html"><a href="calibration.html#calibrate-routine"><i class="fa fa-check"></i><b>9.1.2</b> Calibrate Routine</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a><ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#parameters-links"><i class="fa fa-check"></i><b>A.1</b> Parameters links</a></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#solving-the-dynamic-life-cycle-problem-links"><i class="fa fa-check"></i><b>A.2</b> Solving the Dynamic Life Cycle Problem links</a></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#alternative-value-function-solution-testing-links"><i class="fa fa-check"></i><b>A.3</b> Alternative Value Function Solution Testing links</a></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#solution-with-unemployment-links"><i class="fa fa-check"></i><b>A.4</b> Solution with Unemployment links</a></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#household-life-cycle-distribution-links"><i class="fa fa-check"></i><b>A.5</b> Household Life Cycle Distribution links</a></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#value-of-each-check-links"><i class="fa fa-check"></i><b>A.6</b> Value of Each Check links</a></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#outcomes-full-state-space-with-savings-shocks-and-education-links"><i class="fa fa-check"></i><b>A.7</b> Outcomes Full State Space with Savings, Shocks and Education links</a></li>
<li class="chapter" data-level="A.8" data-path="index-and-code-links.html"><a href="index-and-code-links.html#expectations-given-income-age-kids-and-marital-status-links"><i class="fa fa-check"></i><b>A.8</b> Expectations Given Income, Age, Kids and Marital Status links</a></li>
<li class="chapter" data-level="A.9" data-path="index-and-code-links.html"><a href="index-and-code-links.html#calibration-links"><i class="fa fa-check"></i><b>A.9</b> Calibration links</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/PrjOptiSNW/bookdown/index.html" target="blank">PrjOptiSNW Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SNW Dynamic Life Cycle and Welfare Checks Code Companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="alternative-value-function-solution-testing" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Alternative Value Function Solution Testing</h1>

<div id="small-test-exact-solution-looped-minimizer" class="section level2">
<h2><span class="header-section-number">3.1</span> Small Test Exact Solution Looped Minimizer</h2>
<p>This is the example vignette for function:
<a href="https://github.com/FanWangEcon/PrjOptiSNW/blob/master/PrjOptiSNW/svalpol/snw_vfi_main.m"><strong>snw_vfi_main</strong></a>
from the <a href="https://fanwangecon.github.io/PrjOptiSNW/"><strong>PrjOptiSNW
Package</strong></a><strong>.</strong> This function
solves for policy function fully iteratively using matlab minimizer.
Small Solution Analysis.</p>
<div id="test-snw_vfi_main-defaults-small" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Test SNW_VFI_MAIN Defaults Small</h3>
<p>Call the function with defaults parameters.</p>
<pre><code>mp_param = snw_mp_param(&#39;default_small&#39;);
[V_VFI,ap_VFI,cons_VFI,mp_valpol_more] = snw_vfi_main(mp_param);

SNW_VFI_MAIN: Finished Age Group:18 of 18</code></pre>
</div>
<div id="small-param-results-define-frames" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Small Param Results Define Frames</h3>
<p>Define the matrix dimensions names and dimension vector values. Policy
and Value Functions share the same ND dimensional structure.</p>
<pre><code>% Grids:
age_grid = [19, 22:5:97, 100];
agrid = mp_param(&#39;agrid&#39;)&#39;;
eta_H_grid = mp_param(&#39;eta_H_grid&#39;)&#39;;
eta_S_grid = mp_param(&#39;eta_S_grid&#39;)&#39;;
ar_st_eta_HS_grid = string(cellstr([num2str(eta_H_grid&#39;, &#39;hz=%3.2f;&#39;), num2str(eta_S_grid&#39;, &#39;wz=%3.2f&#39;)]));
edu_grid = [0,1];
marry_grid = [0,1];
kids_grid = (1:1:mp_param(&#39;n_kidsgrid&#39;))&#39;;
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
cl_mp_datasetdesc = {};
cl_mp_datasetdesc{1} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;age&#39;, age_grid});
cl_mp_datasetdesc{2} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;savings&#39;, agrid});
cl_mp_datasetdesc{3} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;eta&#39;, 1:length(eta_H_grid)});
cl_mp_datasetdesc{4} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;edu&#39;, edu_grid});
cl_mp_datasetdesc{5} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;marry&#39;, marry_grid});
cl_mp_datasetdesc{6} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;kids&#39;, kids_grid});</code></pre>
</div>
<div id="analyze-savings-and-shocks-1" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Analyze Savings and Shocks</h3>
<p>First, analyze Savings Levels and Shocks, Aggregate Over All Others, and
do various other calculations.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Savings States, a&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log</code></pre>
<p>MEAN(VAL(A,Z)), MEAN(AP(A,Z)), MEAN(C(A,Z))</p>
<p>Tabulate value and policies along savings and shocks:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [1,4,5,6,3,2];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(A,Z))&quot;, V_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);
% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(A,Z))&quot;, ap_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);</code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(A,Z))”, cons_VFI, true, [“mean”], 4, 1, cl_mp_datasetdesc, ar_permute);</p>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(a,z))&#39;};
ff_graph_grid((tb_az_v{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(a,z))&#39;};
ff_graph_grid((tb_az_ap{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(a,z))&#39;};
ff_graph_grid((tb_az_c{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
</div>
<div id="analyze-kids-and-marriage-and-age-1" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Analyze Kids and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;k0M0&quot;, &quot;K1M0&quot;, &quot;K2M0&quot;, &quot;k0M1&quot;, &quot;K1M1&quot;, &quot;K2M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = { &#39;o&#39;, &#39;d&#39; ,&#39;s&#39;, &#39;o&#39;, &#39;d&#39;, &#39;s&#39;};
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(KM,J)), MEAN(AP(KM,J)), MEAN(C(KM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,4,1,6,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(KM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);
% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(KM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);</code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(KM,J))”, cons_VFI, true, [“mean”], 3, 1, cl_mp_datasetdesc, ar_permute);</p>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(KM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(KM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(KM,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(KM,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
</div>
<div id="analyze-education-and-marriage-and-age-1" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Analyze Education and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;E0M0&quot;, &quot;E1M0&quot;, &quot;E0M1&quot;, &quot;E1M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = {&#39;*&#39;, &#39;p&#39;, &#39;*&#39;,&#39;p&#39; };
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(EKM,J)), MEAN(AP(EKM,J)), MEAN(C(EKM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,6,1,4,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(EKM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);
% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(EKM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);
% Consumption Choices
tb_az_c = ff_summ_nd_array(&quot;MEAN(C(EKM,J))&quot;, cons_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);</code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(EM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(EM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(EK,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(EK,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>

</div>
</div>
<div id="small-test-grid-search-solution" class="section level2">
<h2><span class="header-section-number">3.2</span> Small Test Grid Search Solution</h2>
<p>This is the example vignette for function:
<a href="https://github.com/FanWangEcon/PrjOptiSNW/tree/master/PrjOptiSNW/svalpol/snw_vfi_main_grid_search.m"><strong>snw_vfi_main_grid_search</strong></a>
from the <a href="https://fanwangecon.github.io/PrjOptiSNW/"><strong>PrjOptiSNW
Package</strong></a><strong>.</strong> This function
solves for policy function using grid search. Small Solution Analysis.
Small Solution Analysis, husband 5 shocks, wife 1 shocks.</p>
<div id="test-snw_vfi_main_grid_search-defaults-small" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Test SNW_VFI_MAIN_GRID_SEARCH Defaults Small</h3>
<p>Call the function with defaults parameters.</p>
<pre><code>mp_param = snw_mp_param(&#39;default_small&#39;);
[V_VFI,ap_VFI,cons_VFI,mp_valpol_more] = snw_vfi_main_grid_search(mp_param);

SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:18 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:17 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:16 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:15 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:14 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:13 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:12 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:11 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:10 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:9 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:8 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:7 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:6 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:5 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:4 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:3 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:2 of 18
SNW_VFI_MAIN_GRID_SEARCH: Finished Age Group:1 of 18
Elapsed time is 5.839670 seconds.
Completed SNW_VFI_MAIN_GRID_SEARCH;SNW_MP_PARAM=default_small;SNW_MP_CONTROL=default_base</code></pre>
</div>
<div id="small-param-results-define-frames-1" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Small Param Results Define Frames</h3>
<p>Define the matrix dimensions names and dimension vector values. Policy
and Value Functions share the same ND dimensional structure.</p>
<pre><code>% Grids:
age_grid = [19, 22:5:97, 100];
agrid = mp_param(&#39;agrid&#39;)&#39;;
eta_H_grid = mp_param(&#39;eta_H_grid&#39;)&#39;;
eta_S_grid = mp_param(&#39;eta_S_grid&#39;)&#39;;
ar_st_eta_HS_grid = string(cellstr([num2str(eta_H_grid&#39;, &#39;hz=%3.2f;&#39;), num2str(eta_S_grid&#39;, &#39;wz=%3.2f&#39;)]));
edu_grid = [0,1];
marry_grid = [0,1];
kids_grid = (1:1:mp_param(&#39;n_kidsgrid&#39;))&#39;;
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
cl_mp_datasetdesc = {};
cl_mp_datasetdesc{1} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;age&#39;, age_grid});
cl_mp_datasetdesc{2} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;savings&#39;, agrid});
cl_mp_datasetdesc{3} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;Hshock&#39;, eta_H_grid});
cl_mp_datasetdesc{4} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;edu&#39;, edu_grid});
cl_mp_datasetdesc{5} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;marry&#39;, marry_grid});
cl_mp_datasetdesc{6} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;kids&#39;, kids_grid});</code></pre>
</div>
<div id="analyze-savings-and-shocks-2" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Analyze Savings and Shocks</h3>
<p>First, analyze Savings Levels and Shocks, Aggregate Over All Others, and
do various other calculations.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Savings States, a&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log</code></pre>
<p>MEAN(VAL(A,Z)), MEAN(AP(A,Z)), MEAN(C(A,Z))</p>
<p>Tabulate value and policies along savings and shocks:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [1,4,5,6,3,2];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(A,Z))&quot;, V_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_Hshock__0_91976    mean_Hshock__0_45988    mean_Hshock_0    mean_Hshock_0_45988    mean_Hshock_0_91976
    _____    _________    ____________________    ____________________    _____________    ___________________    ___________________

      1              0           -7.2621                 -5.3086             -3.7492             -2.4926                 -1.4915     
      2      0.0097656           -7.1445                 -5.2223             -3.6785             -2.4286                 -1.4317     
      3       0.078125            -6.489                 -4.7412             -3.2884             -2.0835                 -1.1114     
      4        0.26367           -5.3573                 -3.8789             -2.6221             -1.5232                -0.60744     
      5          0.625           -4.0454                 -2.8494             -1.8168            -0.89616               -0.078835     
      6         1.2207           -2.7343                 -1.8181            -0.98298            -0.25711                  0.4161     
      7         2.1094           -1.5234                -0.86783            -0.22453             0.35789                 0.87111     
      8         3.3496          -0.46769               -0.030108              0.4355             0.88833                  1.2964     
      9              5           0.39914                 0.68023             0.99893              1.3355                  1.6594     
     10         7.1191            1.0817                  1.2609              1.4733              1.7121                  1.9602     
     11         9.7656            1.6112                  1.7245              1.8649                2.03                   2.213     
     12         12.998            2.0172                  2.0904               2.183              2.2964                  2.4278     
     13         16.875            2.3301                  2.3771               2.439              2.5167                  2.6105     
     14         21.455            2.5712                  2.6024              2.6436              2.6973                  2.7641     
     15         26.797             2.758                   2.779              2.8073              2.8446                  2.8923     
     16         32.959            2.9047                  2.9189              2.9383              2.9646                  2.9988     
     17             40            3.0205                  3.0304               3.044              3.0625                  3.0873     
     18         47.979            3.1125                  3.1195              3.1293              3.1426                  3.1607     
     19         56.953            3.1866                  3.1917              3.1987              3.2085                  3.2218     
     20         66.982            3.2468                  3.2505              3.2556              3.2628                  3.2728     
     21         78.125             3.296                  3.2988              3.3026              3.3079                  3.3154     
     22         90.439            3.3366                  3.3386              3.3415              3.3456                  3.3512     
     23         103.98            3.3704                  3.3719              3.3741              3.3772                  3.3815     
     24         118.82            3.3987                  3.3999              3.4015              3.4039                  3.4072     
     25            135            3.4225                  3.4234              3.4247              3.4266                  3.4292     

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(A,Z))&quot;, ap_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_Hshock__0_91976    mean_Hshock__0_45988    mean_Hshock_0    mean_Hshock_0_45988    mean_Hshock_0_91976
    _____    _________    ____________________    ____________________    _____________    ___________________    ___________________

      1              0           1.1204                  1.3194              1.7407              2.4259                 3.1528       
      2      0.0097656           1.1389                  1.3611               1.787              2.4676                 3.1806       
      3       0.078125           1.8241                  1.9861              2.3009              2.7731                 3.3981       
      4        0.26367            2.912                  3.0509              3.2315              3.5833                 3.9861       
      5          0.625           3.9861                  4.1435              4.2269              4.4815                 4.7917       
      6         1.2207           5.0231                  5.1806              5.2407              5.3009                  5.625       
      7         2.1094           6.0741                  6.1806              6.2037              6.2176                 6.3565       
      8         3.3496           7.0463                  7.1157              7.1528              7.1574                 7.1667       
      9              5           7.9537                  7.9954              8.0509              8.0741                 8.0741       
     10         7.1191           8.8657                  8.9028              8.9398              8.9861                 9.0046       
     11         9.7656            9.787                   9.787              9.8426               9.875                 9.9306       
     12         12.998           10.606                   10.63              10.639              10.685                 10.745       
     13         16.875           11.481                  11.495              11.532              11.556                 11.606       
     14         21.455           12.407                  12.407              12.421              12.458                 12.495       
     15         26.797           13.259                  13.287              13.296              13.315                 13.352       
     16         32.959           14.093                  14.102              14.125              14.144                 14.176       
     17             40           14.972                  14.977              14.986              15.005                 15.037       
     18         47.979           15.843                  15.866               15.87               15.88                 15.917       
     19         56.953            16.75                   16.75              16.773              16.782                 16.796       
     20         66.982           17.653                  17.657              17.667              17.699                 17.713       
     21         78.125           18.477                  18.486              18.495              18.505                 18.542       
     22         90.439           19.315                  19.319              19.329              19.347                  19.37       
     23         103.98           20.218                  20.222              20.227              20.245                 20.264       
     24         118.82           21.083                  21.083              21.083              21.097                 21.139       
     25            135           21.944                  21.949              21.954              21.958                 21.972       </code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(A,Z))”, cons_VFI, true, [“mean”], 4, 1, cl_mp_datasetdesc, ar_permute);</p>
<pre><code>xxx  MEAN(C(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_Hshock__0_91976    mean_Hshock__0_45988    mean_Hshock_0    mean_Hshock_0_45988    mean_Hshock_0_91976
    _____    _________    ____________________    ____________________    _____________    ___________________    ___________________

      1              0          0.47561                 0.60477              0.78755             1.0221                 1.3439       
      2      0.0097656          0.48688                 0.61444              0.79661             1.0285                 1.3496       
      3       0.078125          0.55276                 0.67316              0.84544             1.0812                 1.3925       
      4        0.26367          0.68068                 0.79387               0.9582             1.1664                 1.5028       
      5          0.625          0.87413                 0.95556               1.1377             1.3323                 1.6581       
      6         1.2207           1.1386                  1.1823                1.359             1.6442                 1.8769       
      7         2.1094           1.4348                  1.4767               1.6678             1.9853                 2.3357       
      8         3.3496           1.8593                  1.9088               2.0737             2.3969                 2.9009       
      9              5           2.4822                  2.5483               2.6665             2.9566                 3.4714       
     10         7.1191            3.276                  3.3318               3.4625             3.6919                 4.1668       
     11         9.7656           4.2223                   4.356               4.4176             4.6587                 5.0253       
     12         12.998           5.5639                  5.6224               5.8007             5.9774                 6.2959       
     13         16.875           7.1191                  7.1983               7.2626             7.4988                  7.814       
     14         21.455           8.7496                  8.8825               9.0265             9.1825                 9.5252       
     15         26.797            10.88                  10.865               11.023             11.249                 11.563       
     16         32.959           13.483                  13.559               13.624             13.835                 14.147       
     17             40           16.255                  16.355               16.497             16.692                 16.975       
     18         47.979           19.414                  19.362               19.532             19.783                 19.999       
     19         56.953           22.728                  22.861                22.86             23.102                 23.488       
     20         66.982           26.496                  26.587               26.701             26.705                 27.077       
     21         78.125           31.189                  31.223               31.332             31.559                 31.668       
     22         90.439           36.369                  36.444               36.537             36.645                 36.881       
     23         103.98           41.558                  41.627               41.772             41.846                 42.106       
     24         118.82           47.433                  47.565               47.772             47.903                 47.808       
     25            135           53.934                  53.998                54.13             54.386                 54.679       </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(a,z))&#39;};
ff_graph_grid((tb_az_v{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_0.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_1.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(a,z))&#39;};
ff_graph_grid((tb_az_ap{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_2.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_3.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(a,z))&#39;};
ff_graph_grid((tb_az_c{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_4.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_5.png" width="500" /></p>
</div>
<div id="analyze-kids-and-marriage-and-age-2" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Analyze Kids and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;k0M0&quot;, &quot;K1M0&quot;, &quot;K2M0&quot;, &quot;k0M1&quot;, &quot;K1M1&quot;, &quot;K2M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = { &#39;o&#39;, &#39;d&#39; ,&#39;s&#39;, &#39;o&#39;, &#39;d&#39;, &#39;s&#39;};
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(KM,J)), MEAN(AP(KM,J)), MEAN(C(KM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,4,1,6,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(KM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0        2.5769          2.726         2.8073         2.7855         2.6939         2.5501          2.365         2.1438         1.8872          1.5999         1.2756        0.88188        0.17776        0.24661         0.28207        0.30106        0.3257         0.35623  
      2       2        0        1.5197         1.8098         2.0206         2.1004         2.0952         2.0212         1.8925         1.7166          1.495           1.231        0.92151         0.5203       -0.29538       -0.17438       -0.090477      -0.027832      0.028641        0.089565  
      3       3        0        0.9869         1.2649         1.4811         1.5698         1.5738         1.5134         1.4009         1.2418         1.0366         0.78504        0.48099       0.059909        -0.8936       -0.67909        -0.50253       -0.36182      -0.24319        -0.11505  
      4       1        1        2.3544         2.5201         2.6205         2.6297         2.5748         2.4711         2.3294          2.154         1.9463          1.7116         1.4479          1.144        0.71047        0.66682         0.61165        0.56852       0.54218         0.52711  
      5       2        1         1.564         1.8114         1.9978         2.0809         2.0936         2.0476         1.9549         1.8211         1.6483          1.4412          1.202        0.91388         0.4902        0.47757         0.45154        0.43204       0.42163         0.42208  
      6       3        1        1.2123         1.4401         1.6171         1.6965         1.7071          1.666         1.5837          1.465          1.311          1.1252        0.90793        0.64131        0.23723        0.26901         0.28473        0.30056       0.31579         0.34335  

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(KM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0        12.876          12.86         12.976         13.068          13.14         13.176         13.116         13.008           12.9         12.836          12.78         12.664          11.76          11.44          10.96          10.2           8.94             1      
      2       2        0         12.86          12.84         12.916         13.016          13.06         12.952         12.868           12.8         12.724          12.68         12.624         12.472          11.64          11.32          10.78           9.9           8.76             1      
      3       3        0        12.824         12.792         12.884         12.988          12.94         12.884         12.804         12.756          12.68         12.656         12.604          12.44          11.64           11.3          10.78          9.96            8.8             1      
      4       1        1        12.832         12.796         12.892          12.98         13.052           13.1         13.024         12.912         12.812          12.76          12.74         12.672          11.72           11.4          10.84            10           8.78             1      
      5       2        1        12.824         12.788         12.856          12.94         13.004          12.98          12.86          12.76         12.684         12.604         12.604         12.504          11.64          11.28          10.62          9.86            8.6             1      
      6       3        1        12.768         12.724         12.828         12.904         12.972         12.888         12.796         12.688         12.612         12.564         12.568         12.436          11.64          11.26          10.66          9.86           8.64             1      </code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(KM,J))”, cons_VFI, true, [“mean”], 3, 1, cl_mp_datasetdesc, ar_permute);</p>
<pre><code>xxx  MEAN(C(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0        6.3895         6.4629         6.6288         6.7554         6.8327          6.866         8.3231         9.9184         10.865         11.373         11.637         12.687         14.498         17.058         20.171         24.416         30.062          41.102   
      2       2        0        6.4025         6.4709         6.6411         6.7667         7.2326         9.0966         10.326         11.039           11.5         11.758         12.093         14.177          15.24         17.948         21.172         25.606         30.737          41.102   
      3       3        0        6.4139         6.4906         6.6473         6.7745         8.3105         9.6757         10.655           11.2         11.599          11.77         12.391         14.416          15.24         18.107         21.172         25.356         30.713          41.102   
      4       1        1        6.6365         6.7334         6.9186         7.0691         7.1681         7.2225         8.8975         10.423         11.345         11.877          12.11         13.142         15.084         17.372         20.579         24.856         30.438          41.446   
      5       2        1        6.6219         6.7043         6.8923         7.0386         7.1354         8.2428         9.9602         11.081         11.688          12.09         12.213         14.086         15.332         18.137         21.582         25.729         31.101          41.448   
      6       3        1        6.6135         6.7111         6.8733         7.0145         7.1123         9.0255         10.389         11.326          11.83         12.122         12.189         14.278         15.344         18.328         21.584         25.742         31.104          41.461   </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(KM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(KM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_6.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_7.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(KM,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_8.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_9.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(KM,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_10.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_11.png" width="500" /></p>
</div>
<div id="analyze-education-and-marriage-and-age-2" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Analyze Education and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;E0M0&quot;, &quot;E1M0&quot;, &quot;E0M1&quot;, &quot;E1M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = {&#39;*&#39;, &#39;p&#39;, &#39;*&#39;,&#39;p&#39; };
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(EKM,J)), MEAN(AP(EKM,J)), MEAN(C(EKM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,6,1,4,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(EKM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0         1.397         1.5992         1.7503          1.807         1.7952         1.7249         1.6042         1.4376         1.2263         0.97421        0.67541        0.29463        -0.4945        -0.32822       -0.20359      -0.11069       -0.02984        0.05665   
      2       1       0        1.9919          2.268         2.4556         2.4968         2.4467         2.3315         2.1681         1.9639         1.7195          1.4364           1.11         0.6801       -0.17965       -0.076354     -0.0036951      0.051623        0.10394        0.16384   
      3       0       1        1.3943          1.589         1.7371         1.8066         1.8173         1.7774          1.695         1.5739         1.4162          1.2274         1.0077        0.74426        0.35032         0.36868         0.3689       0.37066        0.37529        0.39098   
      4       1       1        2.0262         2.2588         2.4199         2.4648         2.4331         2.3457         2.2169         2.0528         1.8542          1.6246         1.3642         1.0552        0.60828         0.57359        0.52971       0.49674        0.47778        0.47072   

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(EKM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0        12.923         12.909         12.957         13.011         13.016         12.968         12.899         12.819         12.733         12.677         12.605         12.461          11.68         11.347         10.867         10.027           8.84            1      
      2       1       0        12.784         12.752         12.893         13.037         13.077          13.04          12.96         12.891         12.803         12.771         12.733         12.589          11.68          11.36         10.813         10.013         8.8267            1      
      3       0       1        12.883         12.837         12.899         12.949         12.987         12.952         12.859         12.755         12.683         12.603         12.573          12.48         11.667         11.333         10.733           9.92         8.7067            1      
      4       1       1        12.733         12.701         12.819         12.933         13.032         13.027         12.928         12.819         12.723         12.683         12.701         12.595         11.667         11.293          10.68         9.8933           8.64            1      

% Consumption Choices
tb_az_c = ff_summ_nd_array(&quot;MEAN(C(EKM,J))&quot;, cons_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(C(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0        6.3781         6.4224         6.5232         6.6018         7.3509         8.4324         9.6472         10.594         11.192         11.517         11.983         13.721         14.974         17.739         20.792         25.106         30.486          41.083   
      2       1       0        6.4259         6.5271         6.7549         6.9292         7.5663         8.6599         9.8886         10.844         11.451         11.751         12.097         13.799         15.011          17.67         20.885         25.145         30.523           41.12   
      3       0       1        6.5686         6.6336         6.7481         6.8408         6.9145         8.0279         9.6384         10.807         11.443         11.858         12.012         13.706           15.2         17.796         21.181         25.363         30.816          41.394   
      4       1       1        6.6793          6.799         7.0414         7.2407         7.3627         8.2993         9.8595         11.078         11.799         12.201         12.329         13.964         15.307         18.095         21.315         25.521         30.946           41.51   </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(EM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(EM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_12.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_13.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(EK,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_14.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_15.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(EK,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_16.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_grid_search_images/figure_17.png" width="500" /></p>

</div>
</div>
<div id="small-test-exact-solution-vectorized-bisection" class="section level2">
<h2><span class="header-section-number">3.3</span> Small Test Exact Solution Vectorized Bisection</h2>
<p>This is the example vignette for function:
<a href="https://github.com/FanWangEcon/PrjOptiSNW/tree/master/PrjOptiSNW/svalpol/snw_vfi_main_bisec_vec.m"><strong>snw_vfi_main_bisec_vec</strong></a>
from the <a href="https://fanwangecon.github.io/PrjOptiSNW/"><strong>PrjOptiSNW
Package</strong></a><strong>.</strong> This function
solves for policy function with vectorized bisection. Small Solution
Analysis. Small Solution Analysis, husband 5 shocks, wife 1 shocks.</p>
<div id="test-snw_vfi_main-defaults-small-1" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Test SNW_VFI_MAIN Defaults Small</h3>
<p>Call the function with defaults parameters.</p>
<pre><code>mp_param = snw_mp_param(&#39;default_small&#39;);
[V_VFI,ap_VFI,cons_VFI,mp_valpol_more] = snw_vfi_main_bisec_vec(mp_param);

SNW_VFI_MAIN: Finished Age Group:18 of 18
SNW_VFI_MAIN: Finished Age Group:17 of 18
SNW_VFI_MAIN: Finished Age Group:16 of 18
SNW_VFI_MAIN: Finished Age Group:15 of 18
SNW_VFI_MAIN: Finished Age Group:14 of 18
SNW_VFI_MAIN: Finished Age Group:13 of 18
SNW_VFI_MAIN: Finished Age Group:12 of 18
SNW_VFI_MAIN: Finished Age Group:11 of 18
SNW_VFI_MAIN: Finished Age Group:10 of 18
SNW_VFI_MAIN: Finished Age Group:9 of 18
SNW_VFI_MAIN: Finished Age Group:8 of 18
SNW_VFI_MAIN: Finished Age Group:7 of 18
SNW_VFI_MAIN: Finished Age Group:6 of 18
SNW_VFI_MAIN: Finished Age Group:5 of 18
SNW_VFI_MAIN: Finished Age Group:4 of 18
SNW_VFI_MAIN: Finished Age Group:3 of 18
SNW_VFI_MAIN: Finished Age Group:2 of 18
SNW_VFI_MAIN: Finished Age Group:1 of 18
Elapsed time is 0.300958 seconds.
Completed SNW_VFI_MAIN;SNW_MP_PARAM=default_small;SNW_MP_CONTROL=default_base</code></pre>
</div>
<div id="small-param-results-define-frames-2" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Small Param Results Define Frames</h3>
<p>Define the matrix dimensions names and dimension vector values. Policy
and Value Functions share the same ND dimensional structure.</p>
<pre><code>% Grids:
age_grid = [19, 22:5:97, 100];
agrid = mp_param(&#39;agrid&#39;)&#39;;
eta_H_grid = mp_param(&#39;eta_H_grid&#39;)&#39;;
eta_S_grid = mp_param(&#39;eta_S_grid&#39;)&#39;;
ar_st_eta_HS_grid = string(cellstr([num2str(eta_H_grid&#39;, &#39;hz=%3.2f;&#39;), num2str(eta_S_grid&#39;, &#39;wz=%3.2f&#39;)]));
edu_grid = [0,1];
marry_grid = [0,1];
kids_grid = (1:1:mp_param(&#39;n_kidsgrid&#39;))&#39;;
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
cl_mp_datasetdesc = {};
cl_mp_datasetdesc{1} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;age&#39;, age_grid});
cl_mp_datasetdesc{2} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;savings&#39;, agrid});
cl_mp_datasetdesc{3} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;Hshock&#39;, eta_H_grid});
cl_mp_datasetdesc{4} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;edu&#39;, edu_grid});
cl_mp_datasetdesc{5} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;marry&#39;, marry_grid});
cl_mp_datasetdesc{6} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;kids&#39;, kids_grid});</code></pre>
</div>
<div id="analyze-savings-and-shocks-3" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Analyze Savings and Shocks</h3>
<p>First, analyze Savings Levels and Shocks, Aggregate Over All Others, and
do various other calculations.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Savings States, a&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log</code></pre>
<p>MEAN(VAL(A,Z)), MEAN(AP(A,Z)), MEAN(C(A,Z))</p>
<p>Tabulate value and policies along savings and shocks:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [1,4,5,6,3,2];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(A,Z))&quot;, V_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_Hshock__0_91976    mean_Hshock__0_45988    mean_Hshock_0    mean_Hshock_0_45988    mean_Hshock_0_91976
    _____    _________    ____________________    ____________________    _____________    ___________________    ___________________

      1              0           -7.2503                 -5.2835             -3.7134             -2.4567                -1.4584      
      2      0.0097656           -7.1324                 -5.1969             -3.6417             -2.3926                -1.3985      
      3       0.078125           -6.4761                 -4.7107             -3.2467             -2.0451                -1.0782      
      4        0.26367           -5.3284                 -3.8496             -2.5707             -1.4781                -0.5735      
      5          0.625            -3.966                 -2.8108             -1.7735            -0.84485                 -0.042      
      6         1.2207            -2.597                 -1.7598            -0.95324            -0.21705                0.45594      
      7         2.1094           -1.3566                -0.78465            -0.19312             0.37681                0.90585      
      8         3.3496          -0.30963                0.066182             0.47754             0.90413                 1.3121      
      9              5           0.53291                  0.7744              1.0517              1.3565                 1.6684      
     10         7.1191            1.1909                  1.3448              1.5289              1.7407                 1.9718      
     11         9.7656            1.6974                  1.7957              1.9172              2.0626                 2.2291      
     12         12.998            2.0855                  2.1488              2.2293              2.3287                  2.447      
     13         16.875            2.3829                  2.4244              2.4781              2.5462                   2.63      
     14         21.455            2.6121                  2.6396              2.6759              2.7229                 2.7823      
     15         26.797              2.79                  2.8086              2.8335              2.8663                 2.9087      
     16         32.959            2.9295                  2.9423              2.9596              2.9828                 3.0132      
     17             40            3.0397                  3.0487               3.061              3.0775                 3.0996      
     18         47.979            3.1277                  3.1342              3.1429              3.1549                 3.1711      
     19         56.953            3.1987                  3.2033              3.2097              3.2185                 3.2305      
     20         66.982            3.2563                  3.2597              3.2645               3.271                   3.28      
     21         78.125            3.3036                  3.3062              3.3097              3.3146                 3.3214      
     22         90.439            3.3427                  3.3446              3.3473              3.3511                 3.3562      
     23         103.98            3.3753                  3.3768              3.3788              3.3817                 3.3857      
     24         118.82            3.4026                  3.4038              3.4054              3.4076                 3.4107      
     25            135            3.4257                  3.4266              3.4279              3.4296                  3.432      

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(A,Z))&quot;, ap_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_Hshock__0_91976    mean_Hshock__0_45988    mean_Hshock_0    mean_Hshock_0_45988    mean_Hshock_0_91976
    _____    _________    ____________________    ____________________    _____________    ___________________    ___________________

      1              0         0.0031715                0.018272             0.06218             0.16375                 0.3592      
      2      0.0097656         0.0041856                 0.02014            0.065449              0.1682                0.36424      
      3       0.078125            0.0195                0.043246            0.094774             0.20231                0.40176      
      4        0.26367           0.11997                 0.14608             0.20791             0.31671                0.51981      
      5          0.625           0.37091                 0.40356              0.4536             0.57742                0.77042      
      6         1.2207           0.81324                 0.85499             0.90105              1.0031                  1.227      
      7         2.1094             1.495                  1.5366              1.6037              1.6661                 1.8872      
      8         3.3496            2.4456                  2.4842                2.56              2.6441                 2.7827      
      9              5            3.7173                  3.7541              3.8276              3.9479                 4.0455      
     10         7.1191            5.3706                  5.4067              5.4784              5.6081                 5.7575      
     11         9.7656             7.409                   7.445              7.5165              7.6487                 7.8451      
     12         12.998             9.829                  9.8609              9.9322              10.066                 10.286      
     13         16.875            12.836                  12.867               12.93              13.062                 13.295      
     14         21.455            16.418                  16.447               16.51              16.632                 16.867      
     15         26.797            20.467                  20.493              20.551               20.67                 20.893      
     16         32.959            25.147                  25.172              25.226              25.335                  25.55      
     17             40            30.496                  30.527              30.586              30.695                 30.896      
     18         47.979             36.57                  36.598               36.66              36.779                 36.984      
     19         56.953            43.556                  43.586              43.646              43.757                  43.97      
     20         66.982             51.34                   51.37              51.434              51.553                  51.76      
     21         78.125            59.622                  59.655              59.719              59.839                 60.054      
     22         90.439            68.907                  68.939              69.003              69.124                 69.343      
     23         103.98             79.38                   79.41               79.47              79.586                 79.801      
     24         118.82            90.679                  90.711              90.776              90.898                  91.11      
     25            135            102.99                  103.02              103.08              103.19                 103.41      </code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(A,Z))”, cons_VFI, true, [“mean”], 4, 1, cl_mp_datasetdesc, ar_permute);</p>
<pre><code>xxx  MEAN(C(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_Hshock__0_91976    mean_Hshock__0_45988    mean_Hshock_0    mean_Hshock_0_45988    mean_Hshock_0_91976
    _____    _________    ____________________    ____________________    _____________    ___________________    ___________________

      1              0          0.47551                 0.59993              0.77031             1.0006                 1.3228       
      2      0.0097656          0.48595                 0.60949              0.77845             1.0076                 1.3292       
      3       0.078125           0.5508                  0.6664              0.82902             1.0533                 1.3714       
      4        0.26367          0.66781                 0.78066              0.93266             1.1554                 1.4697       
      5          0.625             0.84                 0.94566               1.1089             1.3162                 1.6403       
      6         1.2207           1.0944                  1.1901               1.3565              1.585                 1.8778       
      7         2.1094           1.4504                  1.5453               1.6898             1.9573                 2.2524       
      8         3.3496           1.9462                  2.0432               2.1782             2.4231                    2.8       
      9              5            2.597                   2.695               2.8314             3.0393                 3.4566       
     10         7.1191           3.4097                  3.5079               3.6454             3.8432                  4.208       
     11         9.7656            4.449                  4.5467               4.6839             4.8786                 5.1957       
     12         12.998           5.7861                  5.8876               6.0245             6.2175                   6.51       
     13         16.875           7.2831                  7.3861               7.5301             7.7248                 8.0041       
     14         21.455           9.0219                  9.1255               9.2698             9.4736                  9.751       
     15         26.797           11.176                  11.283               11.433             11.639                 11.928       
     16         32.959           13.652                   13.76               13.913             14.129                 14.426       
     17             40           16.478                   16.58               16.728             16.944                 17.255       
     18         47.979           19.667                  19.772               19.917             20.123                 20.429       
     19         56.953           23.101                  23.202                23.35             23.564                 23.862       
     20         66.982            26.96                  27.062               27.205              27.41                 27.715       
     21         78.125           31.613                  31.712               31.855              32.06                 32.356       
     22         90.439           36.623                  36.724               36.866             37.069                 37.362       
     23         103.98           41.873                  41.975               42.122             42.331                 42.627       
     24         118.82           47.794                  47.894               48.036             48.239                 48.537       
     25            135           54.264                  54.368               54.515             54.725                 55.022       </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(a,z))&#39;};
ff_graph_grid((tb_az_v{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_0.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_1.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(a,z))&#39;};
ff_graph_grid((tb_az_ap{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_2.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_3.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(a,z))&#39;};
ff_graph_grid((tb_az_c{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_4.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_5.png" width="500" /></p>
</div>
<div id="analyze-kids-and-marriage-and-age-3" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Analyze Kids and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;k0M0&quot;, &quot;K1M0&quot;, &quot;K2M0&quot;, &quot;k0M1&quot;, &quot;K1M1&quot;, &quot;K2M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = { &#39;o&#39;, &#39;d&#39; ,&#39;s&#39;, &#39;o&#39;, &#39;d&#39;, &#39;s&#39;};
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(KM,J)), MEAN(AP(KM,J)), MEAN(C(KM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,4,1,6,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(KM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0        2.6201         2.7665         2.8454         2.8242         2.7343         2.5925         2.4093         2.1887          1.931          1.6397         1.3094        0.91011        0.18888        0.24771           0.283        0.30206       0.32571         0.35623  
      2       2        0        1.5887         1.8727         2.0791         2.1577         2.1527         2.0791         1.9505          1.773         1.5479          1.2772        0.95858        0.54733       -0.29212       -0.17317       -0.089052      -0.026785      0.028751        0.089565  
      3       3        0        1.0708         1.3439         1.5546         1.6415         1.6452         1.5844         1.4708         1.3088          1.098         0.83746        0.52001       0.086127        -0.8896       -0.67761        -0.50092       -0.36015      -0.24305        -0.11505  
      4       1        1         2.395         2.5572         2.6553         2.6638          2.609         2.5055         2.3632         2.1861         1.9747          1.7338         1.4633         1.1525        0.71172        0.66795         0.61273        0.56858       0.54226         0.52711  
      5       2        1        1.6234         1.8656         2.0481         2.1297         2.1416         2.0949         2.0003         1.8627         1.6838           1.468         1.2188        0.92303        0.49152        0.47911         0.45323        0.43217       0.42177         0.42208  
      6       3        1        1.2806         1.5046         1.6784         1.7562          1.766         1.7235         1.6383         1.5143         1.3519          1.1548        0.92574        0.65088        0.23887        0.27088         0.28663        0.30071       0.31591         0.34335  

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(KM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0         34.74         34.523         34.415         34.265         34.042         33.736         33.323         32.771         32.022         31.123         30.487         29.283          26.72         24.328         20.919           16.7         11.022            0      
      2       2        0        34.413         34.138         33.952         33.709         33.376         32.947         32.406         31.713         30.965         30.449         29.517         27.896         25.782          23.09         19.762         15.453         10.142            0      
      3       3        0        34.001         33.777         33.635         33.423         33.115         32.697         32.156         31.457         30.818         30.321         29.356         27.744         25.713         23.075         19.828         15.604         10.375            0      
      4       1        1        34.621         34.408         34.308          34.16         33.941         33.635         33.226         32.676         31.932          31.05         30.432          29.24          26.59         24.175         20.732         16.551         10.903            0      
      5       2        1        34.473         34.246         34.109         33.911         33.625         33.244         32.753         32.118         31.289         30.645         29.919         28.474         26.145         23.441         20.059         15.929         10.341            0      
      6       3        1        34.106         33.916         33.813         33.643         33.381         33.017         32.532         31.894         31.094         30.539         29.759         28.268         26.061         23.363         20.018         15.932          10.43            0      </code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(KM,J))”, cons_VFI, true, [“mean”], 3, 1, cl_mp_datasetdesc, ar_permute);</p>
<pre><code>xxx  MEAN(C(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0         6.778         7.0757         7.3697         7.6652         7.9826         8.3391         8.7685         9.3138         10.038         10.894         11.464         12.573         14.382         16.774         20.183         24.402          30.08          41.102   
      2       2        0        7.1055         7.4611         7.8334         8.2212         8.6487         9.1272          9.685         10.372         11.096         11.569         12.434         13.959         15.319         18.012          21.34         25.649          30.96          41.102   
      3       3        0        7.5174         7.8216         8.1497         8.5069           8.91         9.3774         9.9354         10.627         11.242         11.696         12.595         14.112         15.389         18.027         21.274         25.498         30.727          41.102   
      4       1        1        7.1206         7.4352         7.7476         8.0644         8.4009         8.7779         9.2242         9.7861         10.523         11.378         11.944         13.051         14.815          17.24         20.692         24.881         30.536          41.446   
      5       2        1        7.2345         7.5595         7.9048         8.2677         8.6677         9.1164         9.6413         10.286         11.105          11.72         12.392          13.75         15.262         17.976         21.367         25.505           31.1          41.448   
      6       3        1        7.5771         7.8633         8.1717         8.5043         8.8779         9.3081         9.8249         10.469         11.259         11.783         12.507         13.909         15.358         18.066         21.421         25.515         31.025          41.461   </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(KM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(KM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_6.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_7.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(KM,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_8.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_9.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(KM,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_10.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_11.png" width="500" /></p>
</div>
<div id="analyze-education-and-marriage-and-age-3" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Analyze Education and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;E0M0&quot;, &quot;E1M0&quot;, &quot;E0M1&quot;, &quot;E1M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = {&#39;*&#39;, &#39;p&#39;, &#39;*&#39;,&#39;p&#39; };
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(EKM,J)), MEAN(AP(EKM,J)), MEAN(C(EKM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,6,1,4,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(EKM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0        1.4646         1.6636         1.8129         1.8698         1.8591         1.7896         1.6692         1.5014         1.2869         1.0278         0.72021        0.32546       -0.48695         -0.3269       -0.20224      -0.10927       -0.029757       0.05665   
      2       1       0        2.0551         2.3251         2.5065         2.5458         2.4958         2.3811         2.2178         2.0122         1.7644         1.4751          1.1385        0.70358       -0.17495       -0.075141     -0.0024121      0.052689         0.10403       0.16384   
      3       0       1        1.4539         1.6452         1.7914         1.8602         1.8706         1.8301         1.7457         1.6207         1.4564         1.2576          1.0272        0.75454        0.35173         0.37012        0.37037       0.37078         0.37545       0.39098   
      4       1       1        2.0788         2.3064         2.4632         2.5062         2.4738         2.3859         2.2555          2.088         1.8839         1.6469           1.378          1.063        0.60968         0.57517        0.53136       0.49686         0.47784       0.47072   

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(EKM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0        34.471         34.227         34.028         33.781         33.465         33.068         32.564         31.912         31.207         30.562           29.7         28.199         26.062         23.491         20.165         15.913          10.51            0      
      2       1       0        34.298         34.065         33.974         33.817         33.557         33.186         32.693         32.049          31.33           30.7         29.874         28.416         26.082         23.504         20.174         15.925         10.516            0      
      3       0       1        34.505         34.289          34.12         33.903         33.618         33.255         32.789         32.178         31.383         30.689         29.963         28.562         26.274         23.673          20.29         16.151          10.57            0      
      4       1       1        34.294         34.091         34.033         33.907         33.681         33.343         32.885         32.281         31.493           30.8          30.11         28.759         26.257         23.646         20.249         16.124         10.546            0      

% Consumption Choices
tb_az_c = ff_summ_nd_array(&quot;MEAN(C(EKM,J))&quot;, cons_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(C(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0         7.047         7.3391          7.647          7.982         8.3628         8.8022         9.3272         9.9811         10.669         11.276         12.079         13.499         15.022         17.592         20.918         25.171         30.573          41.083   
      2       1       0        7.2203         7.5665         7.9215         8.2802         8.6647         9.0936         9.5988         10.228         10.915         11.496          12.25         13.596         15.038         17.617         20.946         25.195         30.604           41.12   
      3       0       1        7.1855          7.465         7.7602         8.0826         8.4489         8.8704         9.3732             10         10.792          11.46         12.137         13.465         15.083         17.693         21.084         25.231         30.817          41.394   
      4       1       1         7.436         7.7737         8.1225          8.475         8.8488         9.2645         9.7537         10.361         11.133         11.794         12.424         13.676         15.207         17.829         21.236          25.37         30.957           41.51   </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(EM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(EM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_12.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_13.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(EK,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_14.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_15.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(EK,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_16.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_images/figure_17.png" width="500" /></p>

</div>
</div>
<div id="small-test-exact-solution-spousal-shocks" class="section level2">
<h2><span class="header-section-number">3.4</span> Small Test Exact Solution Spousal Shocks</h2>
<p>This is the example vignette for function:
<a href="https://github.com/FanWangEcon/PrjOptiSNW/tree/master/PrjOptiSNW/svalpol/snw_vfi_main_bisec_vec.m"><strong>snw_vfi_main_bisec_vec</strong></a>
from the <a href="https://fanwangecon.github.io/PrjOptiSNW/"><strong>PrjOptiSNW
Package</strong></a><strong>.</strong> This function
solves for policy function with vectorized bisection. Small Solution
Analysis, husband 5 shocks, wife 3 shocks.</p>
<div id="test-snw_vfi_main-defaults-small-2" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Test SNW_VFI_MAIN Defaults Small</h3>
<p>Call the function with default parameters.</p>
<pre><code>mp_param = snw_mp_param(&#39;default_small53&#39;);
[V_VFI,ap_VFI,cons_VFI,mp_valpol_more] = snw_vfi_main_bisec_vec(mp_param);

SNW_VFI_MAIN: Finished Age Group:18 of 18
SNW_VFI_MAIN: Finished Age Group:17 of 18
SNW_VFI_MAIN: Finished Age Group:16 of 18
SNW_VFI_MAIN: Finished Age Group:15 of 18
SNW_VFI_MAIN: Finished Age Group:14 of 18
SNW_VFI_MAIN: Finished Age Group:13 of 18
SNW_VFI_MAIN: Finished Age Group:12 of 18
SNW_VFI_MAIN: Finished Age Group:11 of 18
SNW_VFI_MAIN: Finished Age Group:10 of 18
SNW_VFI_MAIN: Finished Age Group:9 of 18
SNW_VFI_MAIN: Finished Age Group:8 of 18
SNW_VFI_MAIN: Finished Age Group:7 of 18
SNW_VFI_MAIN: Finished Age Group:6 of 18
SNW_VFI_MAIN: Finished Age Group:5 of 18
SNW_VFI_MAIN: Finished Age Group:4 of 18
SNW_VFI_MAIN: Finished Age Group:3 of 18
SNW_VFI_MAIN: Finished Age Group:2 of 18
SNW_VFI_MAIN: Finished Age Group:1 of 18
Elapsed time is 4.405878 seconds.
Completed SNW_VFI_MAIN;SNW_MP_PARAM=default_small53;SNW_MP_CONTROL=default_base</code></pre>
</div>
<div id="small-param-results-define-frames-3" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Small Param Results Define Frames</h3>
<p>Define the matrix dimensions names and dimension vector values. Policy
and Value Functions share the same ND dimensional structure.</p>
<pre><code>% Grids:
age_grid = [19, 22:5:97, 100];
agrid = mp_param(&#39;agrid&#39;)&#39;;
eta_H_grid = mp_param(&#39;eta_H_grid&#39;)&#39;;
eta_S_grid = mp_param(&#39;eta_S_grid&#39;)&#39;;
ar_st_eta_HS_grid = string(cellstr([num2str(eta_H_grid&#39;, &#39;hz=%3.2f;&#39;), num2str(eta_S_grid&#39;, &#39;wz=%3.2f&#39;)]));
edu_grid = [0,1];
marry_grid = [0,1];
kids_grid = (1:1:mp_param(&#39;n_kidsgrid&#39;))&#39;;
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
cl_mp_datasetdesc = {};
cl_mp_datasetdesc{1} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;age&#39;, age_grid});
cl_mp_datasetdesc{2} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;savings&#39;, agrid});
cl_mp_datasetdesc{3} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;eta&#39;, 1:length(eta_H_grid)});
cl_mp_datasetdesc{4} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;edu&#39;, edu_grid});
cl_mp_datasetdesc{5} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;marry&#39;, marry_grid});
cl_mp_datasetdesc{6} = containers.Map({&#39;name&#39;, &#39;labval&#39;}, {&#39;kids&#39;, kids_grid});</code></pre>
</div>
<div id="analyze-savings-and-shocks-4" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Analyze Savings and Shocks</h3>
<p>First, analyze Savings Levels and Shocks, Aggregate Over All Others, and
do various other calculations.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Savings States, a&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;it_legend_select&#39;) = 9; % how many shock legends to show
mp_support_graph(&#39;cl_colors&#39;) = &#39;jet&#39;;</code></pre>
<p>MEAN(VAL(A,Z)), MEAN(AP(A,Z)), MEAN(C(A,Z))</p>
<p>Tabulate value and policies along savings and shocks:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [1,4,5,6,3,2];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(A,Z))&quot;, V_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_eta_1    mean_eta_2    mean_eta_3    mean_eta_4    mean_eta_5    mean_eta_6    mean_eta_7    mean_eta_8    mean_eta_9    mean_eta_10    mean_eta_11    mean_eta_12    mean_eta_13    mean_eta_14    mean_eta_15
    _____    _________    __________    __________    __________    __________    __________    __________    __________    __________    __________    ___________    ___________    ___________    ___________    ___________    ___________

      1              0       -7.882       -5.7348        -4.085       -2.8085       -1.8188       -7.0297      -5.0815        -3.5426       -2.3256       -1.3675         -5.9023       -4.1923        -2.8271        -1.7305       -0.85468  
      2      0.0097656      -7.7212       -5.6181       -3.9885       -2.7215       -1.7365       -6.9116      -4.9947         -3.471       -2.2616       -1.3076         -5.8033       -4.1192         -2.766        -1.6755       -0.80315  
      3       0.078125      -6.8428       -4.9741       -3.4642       -2.2559       -1.3014       -6.2511      -4.5066        -3.0759       -1.9145       -0.9877         -5.2557        -3.713        -2.4342        -1.3825       -0.53296  
      4        0.26367      -5.4385       -3.9243       -2.6322       -1.5472      -0.66003       -5.0899      -3.6407         -2.398       -1.3463      -0.48112         -4.2987        -2.999        -1.8746       -0.91426       -0.11748  
      5          0.625      -3.9212       -2.7733       -1.7454      -0.83276     -0.049731       -3.7236      -2.6047        -1.6051      -0.71478      0.051174          -3.153       -2.1311        -1.2152       -0.39344         0.3172  
      6         1.2207      -2.4938       -1.6768      -0.89179      -0.17035       0.48277       -2.3765      -1.5744       -0.80356     -0.098483       0.54278         -1.9836       -1.2402       -0.52544        0.13193        0.73192  
      7         2.1094      -1.2492      -0.69701      -0.12719       0.42663       0.94331       -1.1762      -0.6323      -0.070618       0.47399       0.98068         -0.9101      -0.40151        0.12341        0.63376         1.1135  
      8         3.3496     -0.21896       0.14154         0.536       0.94666        1.3467      -0.17291      0.18329        0.57297       0.97868        1.3718       0.0057962       0.34224        0.70909         1.0906         1.4637  
      9              5      0.60263       0.83385        1.0995        1.3921        1.6958       0.63191      0.86101          1.124        1.4137        1.7137         0.75041       0.96951         1.2197         1.4939         1.7781  
     10         7.1191        1.242        1.3897        1.5663        1.7699        1.9935        1.2607       1.4074         1.5827        1.7846        2.0063          1.3385        1.4806         1.6492         1.8423         2.0531  
     11         9.7656       1.7339        1.8287        1.9458         2.086         2.247        1.7458       1.8402         1.9567         2.096        2.2559          1.7966         1.889         2.0023         2.1369         2.2903  
     12         12.998       2.1109        2.1725        2.2505        2.3468        2.4616        2.1187       2.1801         2.2578        2.3536        2.4677          2.1519        2.2126         2.2888         2.3823         2.4928  
     13         16.875       2.4005        2.4411        2.4935        2.5599        2.6414        2.4057       2.4462         2.4984        2.5646        2.6457          2.4278         2.468         2.5197         2.5846         2.6639  
     14         21.455       2.6243        2.6513         2.687         2.733        2.7911        2.6277       2.6548         2.6904        2.7363        2.7941          2.6426        2.6697          2.705         2.7504         2.8073  
     15         26.797       2.7986         2.817        2.8415        2.8737        2.9153        2.8009       2.8193         2.8438         2.876        2.9175          2.8111        2.8296         2.8541          2.886         2.9269  
     16         32.959       2.9355        2.9482        2.9654        2.9882        3.0181        2.9371       2.9499          2.967        2.9898        3.0197          2.9442         2.957         2.9742         2.9969         3.0266  
     17             40       3.0441         3.053        3.0651        3.0815        3.1033        3.0452       3.0542         3.0663        3.0827        3.1044          3.0502        3.0592         3.0715         3.0878         3.1095  
     18         47.979       3.1309        3.1373         3.146        3.1579        3.1739        3.1317       3.1381         3.1469        3.1588        3.1747          3.1353        3.1418         3.1506         3.1625         3.1784  
     19         56.953        3.201        3.2056         3.212        3.2207        3.2326        3.2016       3.2062         3.2126        3.2214        3.2332          3.2041        3.2089         3.2153         3.2241          3.236  
     20         66.982        3.258        3.2614        3.2662        3.2727        3.2816        3.2585       3.2619         3.2666        3.2731         3.282          3.2604        3.2639         3.2687         3.2752         3.2841  
     21         78.125       3.3049        3.3074         3.311        3.3159        3.3226        3.3052       3.3078         3.3113        3.3162         3.323          3.3066        3.3093         3.3129         3.3178         3.3246  
     22         90.439       3.3437        3.3456        3.3483         3.352        3.3572        3.3439       3.3459         3.3486        3.3523        3.3575           3.345         3.347         3.3497         3.3535         3.3587  
     23         103.98       3.3761        3.3775        3.3796        3.3824        3.3864        3.3762       3.3777         3.3798        3.3826        3.3866          3.3771        3.3786         3.3807         3.3836         3.3876  
     24         118.82       3.4032        3.4044        3.4059        3.4082        3.4113        3.4034       3.4045         3.4061        3.4083        3.4114           3.404        3.4052         3.4068          3.409         3.4122  
     25            135       3.4262        3.4271        3.4283        3.4301        3.4325        3.4263       3.4272         3.4284        3.4302        3.4326          3.4268        3.4277          3.429         3.4307         3.4332  

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(A,Z))&quot;, ap_VFI, true, [&quot;mean&quot;], 4, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_eta_1    mean_eta_2    mean_eta_3    mean_eta_4    mean_eta_5    mean_eta_6    mean_eta_7    mean_eta_8    mean_eta_9    mean_eta_10    mean_eta_11    mean_eta_12    mean_eta_13    mean_eta_14    mean_eta_15
    _____    _________    __________    __________    __________    __________    __________    __________    __________    __________    __________    ___________    ___________    ___________    ___________    ___________    ___________

      1              0    0.0019699      0.012569      0.042745      0.11279       0.27641      0.0053954      0.019987       0.05868      0.14689        0.32825        0.21925        0.25075        0.31417        0.43336        0.64028  
      2      0.0097656    0.0026822      0.013934      0.045039      0.11613       0.28116      0.0068403      0.022181      0.062036      0.15118        0.33333        0.22307        0.25509        0.31942        0.43928        0.64651  
      3       0.078125     0.012725      0.028983      0.063429      0.14286       0.31616       0.026742      0.046973      0.090372      0.18539        0.36972        0.25598        0.29205        0.35901        0.48157        0.69104  
      4        0.26367     0.086315       0.10163       0.14743      0.23696       0.42136         0.1257       0.14449       0.19816      0.29464        0.48553        0.37607        0.41297        0.48452        0.60612        0.81971  
      5          0.625      0.30688       0.32748       0.37158      0.48022       0.66179        0.36452        0.3901       0.43505      0.54768        0.73597        0.63601        0.67014        0.73236        0.86738         1.0776  
      6         1.2207      0.71364       0.74681       0.79866      0.90672        1.1008         0.7942       0.82954       0.87454       0.9703         1.1811         1.0715         1.1213         1.1816         1.2985         1.5271  
      7         2.1094         1.38        1.4122         1.473       1.5674        1.7516         1.4621        1.4983        1.5617       1.6356         1.8288         1.7289         1.7796         1.8609         1.9683         2.1913  
      8         3.3496       2.3237        2.3547        2.4215       2.5241        2.6817         2.4018        2.4372        2.5081       2.6069         2.7313         2.6763         2.7136         2.7898         2.9092         3.1151  
      9              5       3.5866        3.6174        3.6852       3.8049        3.9657          3.665        3.7004        3.7724       3.8966         4.0143         3.9381         3.9696         4.0293         4.1449          4.328  
     10         7.1191       5.2284         5.258        5.3256       5.4521         5.645         5.3076        5.3431        5.4151       5.5462         5.7217         5.6026         5.6373         5.6932         5.7922         5.9642  
     11         9.7656       7.2439        7.2717        7.3376       7.4667        7.6795         7.3275        7.3621        7.4339       7.5676         7.7802         7.6699          7.711         7.7752          7.875         8.0346  
     12         12.998        9.683        9.7074        9.7687       9.8969        10.122          9.757        9.7859         9.855       9.9891         10.218         10.092         10.135         10.209         10.323         10.489  
     13         16.875        12.69        12.713        12.768       12.888        13.118         12.761        12.789         12.85       12.978         13.214         13.068         13.115         13.192         13.318         13.508  
     14         21.455       16.245        16.267        16.322       16.434        16.656         16.326        16.353        16.412       16.531         16.763          16.65         16.697         16.778         16.911          17.12  
     15         26.797       20.297        20.314        20.362       20.471        20.681         20.374        20.396         20.45       20.566         20.785         20.721         20.764          20.84         20.977           21.2  
     16         32.959       24.972        24.994         25.04       25.136        25.339          25.05        25.073        25.122       25.226         25.437         25.392         25.435         25.509         25.638         25.866  
     17             40       30.336         30.36        30.416       30.523        30.708         30.406        30.435        30.496       30.602         30.796          30.72         30.763         30.838         30.972         31.193  
     18         47.979       36.418        36.442        36.497       36.607        36.811         36.485        36.511        36.569       36.686         36.891         36.793         36.835         36.908         37.039         37.269  
     19         56.953       43.405        43.428         43.48       43.586        43.789         43.471        43.499        43.556       43.665         43.875         43.763         43.808         43.883          44.01         44.234  
     20         66.982       51.176        51.202         51.26        51.37        51.568         51.247        51.276        51.336       51.451         51.655         51.559         51.606         51.685          51.82         52.045  
     21         78.125       59.419        59.447        59.507       59.624        59.834         59.503        59.534        59.598       59.718          59.93         59.869         59.914         59.992          60.13         60.365  
     22         90.439       68.737        68.762        68.819       68.932        69.146         68.808        68.837        68.899       69.018         69.236          69.14         69.186         69.264         69.398         69.629  
     23         103.98       79.211        79.236        79.291       79.402        79.606         79.282        79.311        79.371       79.483         79.695         79.593         79.639         79.716          79.85          80.08  
     24         118.82       90.517        90.543        90.601       90.715        90.921         90.585        90.615        90.678       90.797         91.008         90.885         90.932         91.012          91.15         91.383  
     25            135       102.82        102.85         102.9       103.01        103.22          102.9        102.92        102.98       103.09          103.3          103.2         103.24         103.32         103.45         103.68  </code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(A,Z))”, cons_VFI, true, [“mean”], 4, 1, cl_mp_datasetdesc, ar_permute);</p>
<pre><code>xxx  MEAN(C(A,Z))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group     savings     mean_eta_1    mean_eta_2    mean_eta_3    mean_eta_4    mean_eta_5    mean_eta_6    mean_eta_7    mean_eta_8    mean_eta_9    mean_eta_10    mean_eta_11    mean_eta_12    mean_eta_13    mean_eta_14    mean_eta_15
    _____    _________    __________    __________    __________    __________    __________    __________    __________    __________    __________    ___________    ___________    ___________    ___________    ___________    ___________

      1              0     0.36263       0.48831       0.66884       0.92666        1.2761       0.47329       0.59821       0.77381        1.0175        1.3538         0.73979        0.86456        1.0333         1.2652         1.5967   
      2      0.0097656     0.37339        0.4984       0.67798       0.93473        1.2828        0.4833       0.60745       0.78187        1.0246        1.3601         0.74739        0.87163        1.0395         1.2707         1.6018   
      3       0.078125     0.44367       0.56349       0.73958       0.98789        1.3276       0.54356       0.66267       0.83342        1.0702        1.4034         0.79446        0.91453        1.0796         1.3081          1.637   
      4        0.26367     0.58796       0.70825       0.87262        1.1106         1.439       0.66208       0.78225       0.94242        1.1775         1.504         0.89136         1.0103        1.1706         1.3998         1.7245   
      5          0.625      0.7912       0.90541        1.0708        1.2892        1.6202       0.84639       0.95912        1.1275         1.346        1.6748          1.0537         1.1749        1.3441         1.5596         1.8874   
      6         1.2207       1.082        1.1826        1.3394        1.5577        1.8756        1.1134        1.2155        1.3831        1.6178        1.9237          1.3136         1.4185        1.5891         1.8223         2.1314   
      7         2.1094      1.4544        1.5549        1.7017        1.9328          2.26        1.4833        1.5836        1.7319        1.9878        2.3107          1.6926         1.7959        1.9448         2.1869         2.5011   
      8         3.3496       1.958        2.0586        2.1984        2.4204        2.7735          1.99        2.0903        2.2301        2.4603        2.8514          2.1901         2.3061        2.4594         2.6889         3.0197   
      9              5      2.6182        2.7182        2.8561        3.0601        3.4093        2.6493        2.7487        2.8866        3.0906        3.4877          2.8492         2.9704        3.1396         3.3724         3.7255   
     10         7.1191      3.4432        3.5437        3.6809        3.8773        4.1937        3.4728        3.5715        3.7087        3.9051        4.2438          3.6495         3.7671        3.9394         4.1882         4.5519   
     11         9.7656      4.5057        4.6075        4.7459         4.939        5.2349        4.5305        4.6296        4.7665        4.9597        5.2607          4.6588         4.7695        4.9332         5.1806         5.5563   
     12         12.998       5.824        5.9289        6.0713        6.2649        6.5482        5.8581        5.9626        6.1017         6.294        6.5783          5.9934         6.1014        6.2552          6.488         6.8565   
     13         16.875       7.322        7.4281        7.5761        7.7778        8.0549         7.359        7.4639        7.6109        7.8086        8.0848          7.5208         7.6251        7.7755         7.9962         8.3406   
     14         21.455      9.0868        9.1934         9.342        9.5513        9.8361        9.1139          9.22        9.3678        9.5751        9.8553          9.2581         9.3622        9.5083         9.7217         10.047   
     15         26.797      11.239        11.351        11.506        11.717        12.014         11.27         11.38        11.533        11.743        12.037          11.391         11.499         11.65         11.859          12.17   
     16         32.959       13.72        13.826        13.983        14.207        14.511        13.749        13.859        14.016        14.238        14.539          13.875         13.983        14.135         14.352         14.658   
     17             40       16.53        16.635        16.782        16.996        17.316        16.568        16.671        16.818        17.037        17.354          16.722          16.83        16.981         17.193         17.506   
     18         47.979      19.712        19.817        19.964        20.174        20.477        19.752        19.859        20.008        20.215        20.522          19.912         20.021        20.174         20.389         20.693   
     19         56.953      23.144         23.25          23.4        23.614        23.917        23.185         23.29         23.44        23.655        23.957          23.361         23.467        23.618         23.836         24.146   
     20         66.982      27.016        27.118        27.263        27.473        27.781        27.053        27.156        27.303        27.512         27.82          27.207         27.312        27.459         27.669         27.978   
     21         78.125      31.708        31.809        31.951        32.154        32.451        31.731        31.833        31.976        32.181         32.48          31.833         31.939        32.087         32.295         32.593   
     22         90.439      36.685        36.789        36.934        37.141        37.433        36.721        36.825         36.97        37.176        37.469          36.857         36.962         37.11         37.322         37.623   
     23         103.98      41.935        42.038        42.186        42.395        42.696        41.971        42.075        42.222        42.434        42.734          42.127         42.232        42.381         42.593         42.896   
     24         118.82      47.848        47.951        48.095        48.301        48.601        47.887         47.99        48.134         48.34         48.64          48.054         48.159        48.305         48.512         48.812   
     25            135      54.325        54.429        54.577        54.788        55.087         54.36        54.466        54.615        54.827        55.127          54.525         54.632        54.784         54.997         55.297   </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(a,z))&#39;};
ff_graph_grid((tb_az_v{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_0.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_1.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(a,z))&#39;};
ff_graph_grid((tb_az_ap{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_2.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_3.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(a,z)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(a,z))&#39;};
ff_graph_grid((tb_az_c{1:end, 3:end})&#39;, ar_st_eta_HS_grid, agrid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_4.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_5.png" width="500" /></p>
</div>
<div id="analyze-kids-and-marriage-and-age-4" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Analyze Kids and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;k0M0&quot;, &quot;K1M0&quot;, &quot;K2M0&quot;, &quot;k0M1&quot;, &quot;K1M1&quot;, &quot;K2M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = { &#39;o&#39;, &#39;d&#39; ,&#39;s&#39;, &#39;o&#39;, &#39;d&#39;, &#39;s&#39;};
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(KM,J)), MEAN(AP(KM,J)), MEAN(C(KM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,4,1,6,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(KM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0        2.6201         2.7665         2.8454         2.8242         2.7343         2.5925         2.4093         2.1887          1.931          1.6397         1.3094        0.91011        0.18888        0.24771           0.283        0.30206       0.32571         0.35623  
      2       2        0        1.5887         1.8727         2.0791         2.1577         2.1527         2.0791         1.9505          1.773         1.5479          1.2772        0.95858        0.54733       -0.29212       -0.17317       -0.089052      -0.026785      0.028751        0.089565  
      3       3        0        1.0708         1.3439         1.5546         1.6415         1.6452         1.5844         1.4708         1.3088          1.098         0.83746        0.52001       0.086127        -0.8896       -0.67761        -0.50092       -0.36015      -0.24305        -0.11505  
      4       1        1        2.6802         2.8229         2.9077         2.9056         2.8417         2.7296         2.5785         2.3912         2.1675          1.9122         1.6252         1.2944        0.79944        0.71954         0.64019        0.57858       0.54307          0.5242  
      5       2        1        1.9461          2.164         2.3286         2.3959         2.3955         2.3375         2.2316         2.0819         1.8892          1.6577         1.3909         1.0741        0.58196        0.53294         0.48184        0.44136       0.42154         0.41824  
      6       3        1         1.615         1.8161         1.9731         2.0371         2.0352         1.9819         1.8856         1.7493         1.5729          1.3596          1.112        0.81549        0.33988        0.33083         0.31786        0.30967       0.31365         0.33666  

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(KM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0         34.74         34.523         34.415         34.265         34.042         33.736         33.323         32.771         32.022         31.123         30.487         29.283          26.72         24.328         20.919           16.7         11.022            0      
      2       2        0        34.413         34.138         33.952         33.709         33.376         32.947         32.406         31.713         30.965         30.449         29.517         27.896         25.782          23.09         19.762         15.453         10.142            0      
      3       3        0        34.001         33.777         33.635         33.423         33.115         32.697         32.156         31.457         30.818         30.321         29.356         27.744         25.713         23.075         19.828         15.604         10.375            0      
      4       1        1        34.626         34.419         34.323         34.185         33.976         33.682         33.284         32.749         32.019         31.162         30.545         29.373         26.663         24.191         20.748         16.543         10.898            0      
      5       2        1        34.477         34.253         34.116         33.923         33.642         33.267         32.784         32.157         31.344         30.717         29.992         28.559         26.197         23.453         20.072         15.911         10.348            0      
      6       3        1        34.101         33.913         33.809         33.641         33.384         33.024         32.545         31.916         31.133         30.587         29.811         28.325         26.119         23.382         20.039         15.923         10.435            0      </code></pre>

<p>% Consumption Choices
tb_az_c = ff_summ_nd_array(“MEAN(C(KM,J))”, cons_VFI, true, [“mean”], 3, 1, cl_mp_datasetdesc, ar_permute);</p>
<pre><code>xxx  MEAN(C(KM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    kids    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ____    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       1        0         6.778         7.0757         7.3697         7.6652         7.9826         8.3391         8.7685         9.3138         10.038         10.894         11.464         12.573         14.382         16.774         20.183         24.402          30.08          41.102   
      2       2        0        7.1055         7.4611         7.8334         8.2212         8.6487         9.1272          9.685         10.372         11.096         11.569         12.434         13.959         15.319         18.012          21.34         25.649          30.96          41.102   
      3       3        0        7.5174         7.8216         8.1497         8.5069           8.91         9.3774         9.9354         10.627         11.242         11.696         12.595         14.112         15.389         18.027         21.274         25.498         30.727          41.102   
      4       1        1        7.3063         7.6329         7.9639         8.2916          8.638         9.0211         9.4728         10.037         10.774         11.618         12.195         13.291             15          17.49         20.949         25.169         30.828          41.738   
      5       2        1        7.3917         7.7297         8.0937         8.4696         8.8812          9.339          9.871         10.521         11.336         11.946         12.626          13.98         15.469         18.231         21.628         25.804         31.381          41.741   
      6       3        1        7.7233         8.0217         8.3477         8.6932         9.0766         9.5155         10.038         10.687          11.47         11.995         12.724         14.129         15.569         18.324         21.684         25.816         31.318          41.766   </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(KM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(KM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_6.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_7.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(KM,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_8.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_9.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(KM,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(KM,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_10.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_11.png" width="500" /></p>
</div>
<div id="analyze-education-and-marriage-and-age-4" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Analyze Education and Marriage and Age</h3>
<p>Aggregating over education, savings, and shocks, what are the
differential effects of Marriage and Age.</p>
<pre><code>% Generate some Data
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
ar_row_grid = [&quot;E0M0&quot;, &quot;E1M0&quot;, &quot;E0M1&quot;, &quot;E1M1&quot;];
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Age&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = true; % do not log
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = {&#39;*&#39;, &#39;p&#39;, &#39;*&#39;,&#39;p&#39; };
mp_support_graph(&#39;cl_colors&#39;) = {&#39;red&#39;, &#39;red&#39;, &#39;blue&#39;, &#39;blue&#39;};</code></pre>
<p>MEAN(VAL(EKM,J)), MEAN(AP(EKM,J)), MEAN(C(EKM,J))</p>
<p>Tabulate value and policies:</p>
<pre><code>% Set
% NaN(n_jgrid,n_agrid,n_etagrid,n_educgrid,n_marriedgrid,n_kidsgrid);
ar_permute = [2,3,6,1,4,5];
% Value Function
tb_az_v = ff_summ_nd_array(&quot;MEAN(VAL(EKM,J))&quot;, V_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(VAL(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0        1.4646         1.6636         1.8129         1.8698         1.8591         1.7896         1.6692         1.5014         1.2869         1.0278         0.72021        0.32546       -0.48695         -0.3269       -0.20224      -0.10927       -0.029757       0.05665   
      2       1       0        2.0551         2.3251         2.5065         2.5458         2.4958         2.3811         2.2178         2.0122         1.7644         1.4751          1.1385        0.70358       -0.17495       -0.075141     -0.0024121      0.052689         0.10403       0.16384   
      3       0       1         1.795         1.9657         2.0955         2.1504         2.1481         2.0956         1.9991         1.8608         1.6812         1.4649          1.2149        0.91773        0.45173         0.42965        0.40277       0.38207         0.37614       0.38732   
      4       1       1        2.3659         2.5697         2.7107         2.7421         2.7001         2.6037         2.4647         2.2875         2.0718         1.8214          1.5371         1.2049        0.69579          0.6259        0.55715       0.50434         0.47603       0.46541   

% Aprime Choice
tb_az_ap = ff_summ_nd_array(&quot;MEAN(AP(EKM,J))&quot;, ap_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(AP(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0        34.471         34.227         34.028         33.781         33.465         33.068         32.564         31.912         31.207         30.562           29.7         28.199         26.062         23.491         20.165         15.913          10.51            0      
      2       1       0        34.298         34.065         33.974         33.817         33.557         33.186         32.693         32.049          31.33           30.7         29.874         28.416         26.082         23.504         20.174         15.925         10.516            0      
      3       0       1        34.499         34.288         34.123          33.91         33.632         33.274         32.815         32.213         31.432         30.754          30.03         28.636         26.327         23.685         20.294         16.141         10.568            0      
      4       1       1        34.304         34.102         34.042         33.923         33.703         33.375         32.927         32.334         31.565          30.89         30.203         28.868         26.326         23.666         20.278          16.11         10.553            0      

% Consumption Choices
tb_az_c = ff_summ_nd_array(&quot;MEAN(C(EKM,J))&quot;, cons_VFI, true, [&quot;mean&quot;], 3, 1, cl_mp_datasetdesc, ar_permute);

xxx  MEAN(C(EKM,J))  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group    edu    marry    mean_age_19    mean_age_22    mean_age_27    mean_age_32    mean_age_37    mean_age_42    mean_age_47    mean_age_52    mean_age_57    mean_age_62    mean_age_67    mean_age_72    mean_age_77    mean_age_82    mean_age_87    mean_age_92    mean_age_97    mean_age_100
    _____    ___    _____    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________

      1       0       0         7.047         7.3391          7.647          7.982         8.3628         8.8022         9.3272         9.9811         10.669         11.276         12.079         13.499         15.022         17.592         20.918         25.171         30.573          41.083   
      2       1       0        7.2203         7.5665         7.9215         8.2802         8.6647         9.0936         9.5988         10.228         10.915         11.496          12.25         13.596         15.038         17.617         20.946         25.195         30.604           41.12   
      3       0       1        7.3401         7.6271         7.9338         8.2659         8.6401         9.0694         9.5788         10.209         10.998         11.661         12.345         13.673         15.262          17.92         21.325         25.492         31.078          41.657   
      4       1       1        7.6075         7.9624         8.3364         8.7038         9.0904         9.5144         10.009         10.621         11.389         12.045         12.685         13.928         15.429          18.11         21.516         25.701         31.274           41.84   </code></pre>
<p>Graph Mean Values:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(value(EM,J)), a=age, z=kids+marry&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(value(EM,J))&#39;};
ff_graph_grid((tb_az_v{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_12.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_13.png" width="500" /></p>
<p>Graph Mean Savings Choices:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(APRIME(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(APRIME(EK,J))&#39;};
ff_graph_grid((tb_az_ap{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_14.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_15.png" width="500" /></p>
<p>Graph Mean Consumption:</p>
<pre><code>mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;MEAN(C(EK,J)), a=x, z=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;MEAN(C(EK,J))&#39;};
ff_graph_grid((tb_az_c{1:end, 4:end}), ar_row_grid, age_grid, mp_support_graph);</code></pre>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_16.png" width="500" /></p>
<p><img src="img/snwx_vfi_test_bisec_vec_spousalshock_images/figure_17.png" width="500" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="solving-the-dynamic-life-cycle-problem.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="solution-with-unemployment.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["SNW-Dynamic-Life-Cycle-and-Welfare-Checks-Code-Companion.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
